const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/FavoritesModal-CLch8tIR.js","assets/mui-BS7ftOUA.js","assets/vendor-eVk5PToZ.js","assets/utils-DVma4InU.js","assets/SettingsModal-BIkqhNf6.js","assets/QuranSearch-DC1niB5n.js"])))=>i.map(i=>d[i]);
import{R as e,j as t,A as n,a as r,T as a,B as i,C as o,b as s,c as u,I as l,d as c,W as h,e as d,f,g as m,E as p,r as y,S as g,D as b,h as v,i as x,u as w,P as k,k as j,l as _,m as A,n as S,o as C,p as I,L as T,q as P,M as E,F as N,s as O,t as M,v as K,w as R,x as F,y as D,z as B,G as q,H as z,J as U,K as $,N as L,O as W,Q as H,U as Y,V,X as Q,Y as G,Z as X,_ as J,$ as Z,a0 as ee,a1 as te,a2 as ne,a3 as re,a4 as ae,a5 as ie,a6 as oe,a7 as se}from"./mui-BS7ftOUA.js";import{a as ue,g as le,c as ce}from"./vendor-eVk5PToZ.js";import{a as he}from"./utils-DVma4InU.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const de={},fe=function(e,t,n){let r=Promise.resolve();if(t&&t.length>0){let e=function(e){return Promise.all(e.map(e=>Promise.resolve(e).then(e=>({status:"fulfilled",value:e}),e=>({status:"rejected",reason:e}))))};document.getElementsByTagName("link");const n=document.querySelector("meta[property=csp-nonce]"),a=(null==n?void 0:n.nonce)||(null==n?void 0:n.getAttribute("nonce"));r=e(t.map(e=>{if((e=function(e){return"/"+e}(e))in de)return;de[e]=!0;const t=e.endsWith(".css"),n=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${n}`))return;const r=document.createElement("link");return r.rel=t?"stylesheet":"modulepreload",t||(r.as="script"),r.crossOrigin="",r.href=e,a&&r.setAttribute("nonce",a),document.head.appendChild(r),t?new Promise((t,n)=>{r.addEventListener("load",t),r.addEventListener("error",()=>n(new Error(`Unable to preload CSS for ${e}`)))}):void 0}))}function a(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return r.then(t=>{for(const e of t||[])"rejected"===e.status&&a(e.reason);return e().catch(a)})};var me,pe={};const ye=le(function(){if(me)return pe;me=1;var e=ue();return pe.createRoot=e.createRoot,pe.hydrateRoot=e.hydrateRoot,pe}()),ge=({error:y,onRetry:g,onDismiss:b,retryCount:v=0,maxRetries:x=3,isRetrying:w=!1,showDetails:k=!1})=>{const[j,_]=e.useState(!1);if(!y)return null;const A=(e=>{const n=((null==e?void 0:e.message)||e||"Unknown error").toLowerCase();return n.includes("network")||n.includes("fetch")?{type:"network",severity:"warning",icon:t.jsx(h,{}),title:"Connection Issue",message:"Unable to connect to the server. Please check your internet connection.",action:"Retry Connection",canRetry:!0}:n.includes("server")||n.includes("500")?{type:"server",severity:"error",icon:t.jsx(d,{}),title:"Server Error",message:"The server is temporarily unavailable. Please try again in a moment.",action:"Try Again",canRetry:!0}:n.includes("ayah")||n.includes("hadith")?{type:"content",severity:"info",icon:t.jsx(f,{}),title:"Content Loading Issue",message:"Unable to load Islamic content. Trying to reconnect...",action:"Reload Content",canRetry:!0}:n.includes("background")||n.includes("image")?{type:"image",severity:"warning",icon:t.jsx(m,{}),title:"Background Image Issue",message:"Unable to load background image. Using fallback image.",action:"Try New Image",canRetry:!0}:n.includes("rate limit")||n.includes("429")?{type:"ratelimit",severity:"warning",icon:t.jsx(m,{}),title:"Rate Limit Reached",message:"Too many requests. Please wait a moment before trying again.",action:"Wait and Retry",canRetry:!0,waitTime:60}:{type:"generic",severity:"error",icon:t.jsx(p,{}),title:"Something Went Wrong",message:"An unexpected error occurred. Please try refreshing the page.",action:"Retry",canRetry:!0}})(y);return A.canRetry,t.jsxs(n,{severity:A.severity,variant:"filled",sx:{backgroundColor:`${A.severity}.main`,backdropFilter:"blur(10px)",boxShadow:"0 8px 30px rgba(0, 0, 0, 0.15)",borderRadius:2,minWidth:"300px",maxWidth:"500px",mx:"auto","& .MuiAlert-icon":{fontSize:"1.5rem"}},icon:A.icon,action:b&&t.jsx(l,{size:"small",onClick:b,sx:{color:"white"},children:t.jsx(c,{fontSize:"small"})}),children:[t.jsx(r,{sx:{fontWeight:600},children:A.title}),t.jsx(a,{variant:"body2",sx:{mb:1},children:A.message}),v>0&&t.jsxs(i,{display:"flex",alignItems:"center",gap:1,mb:1,children:[t.jsx(o,{size:"small",label:`Attempt ${v}/${x}`,sx:{backgroundColor:"rgba(255, 255, 255, 0.2)",color:"white",fontSize:"0.75rem"}}),v>=x&&t.jsx(a,{variant:"caption",sx:{color:"rgba(255, 255, 255, 0.8)"},children:"Maximum retries reached"})]}),A.waitTime&&t.jsxs(a,{variant:"caption",sx:{color:"rgba(255, 255, 255, 0.8)"},children:["Please wait ",A.waitTime," seconds before retrying"]}),k&&t.jsxs(i,{children:[t.jsxs(s,{size:"small",onClick:()=>_(!j),sx:{color:"rgba(255, 255, 255, 0.8)",p:0,mt:1},children:[j?"Hide":"Show"," Details"]}),t.jsx(u,{in:j,children:t.jsx(i,{sx:{mt:1,p:1,backgroundColor:"rgba(0, 0, 0, 0.2)",borderRadius:1,fontFamily:"monospace",fontSize:"0.75rem",color:"rgba(255, 255, 255, 0.9)",wordBreak:"break-all"},children:"object"==typeof y?JSON.stringify(y,null,2):y})})]})]})};var be,ve={exports:{}};const xe=le((be||(be=1,ve.exports=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)},t=function(){return(t=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)};function n(e,t,n){for(var r,a=0,i=t.length;a<i;a++)!r&&a in t||((r=r||Array.prototype.slice.call(t,0,a))[a]=t[a]);return e.concat(r||Array.prototype.slice.call(t))}var r="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:ce,a=Object.keys,i=Array.isArray;function o(e,t){return"object"!=typeof t||a(t).forEach(function(n){e[n]=t[n]}),e}"undefined"==typeof Promise||r.Promise||(r.Promise=Promise);var s=Object.getPrototypeOf,u={}.hasOwnProperty;function l(e,t){return u.call(e,t)}function c(e,t){"function"==typeof t&&(t=t(s(e))),("undefined"==typeof Reflect?a:Reflect.ownKeys)(t).forEach(function(n){d(e,n,t[n])})}var h=Object.defineProperty;function d(e,t,n,r){h(e,t,o(n&&l(n,"get")&&"function"==typeof n.get?{get:n.get,set:n.set,configurable:!0}:{value:n,configurable:!0,writable:!0},r))}function f(e){return{from:function(t){return e.prototype=Object.create(t.prototype),d(e.prototype,"constructor",e),{extend:c.bind(null,e.prototype)}}}}var m=Object.getOwnPropertyDescriptor,p=[].slice;function y(e,t,n){return p.call(e,t,n)}function g(e,t){return t(e)}function b(e){if(!e)throw new Error("Assertion Failed")}function v(e){r.setImmediate?setImmediate(e):setTimeout(e,0)}function x(e,t){if("string"==typeof t&&l(e,t))return e[t];if(!t)return e;if("string"!=typeof t){for(var n=[],r=0,a=t.length;r<a;++r){var i=x(e,t[r]);n.push(i)}return n}var o=t.indexOf(".");if(-1!==o){var s=e[t.substr(0,o)];return null==s?void 0:x(s,t.substr(o+1))}}function w(e,t,n){if(e&&void 0!==t&&(!("isFrozen"in Object)||!Object.isFrozen(e)))if("string"!=typeof t&&"length"in t){b("string"!=typeof n&&"length"in n);for(var r=0,a=t.length;r<a;++r)w(e,t[r],n[r])}else{var o,s,u=t.indexOf(".");-1!==u?(o=t.substr(0,u),""===(s=t.substr(u+1))?void 0===n?i(e)&&!isNaN(parseInt(o))?e.splice(o,1):delete e[o]:e[o]=n:w(u=(u=e[o])&&l(e,o)?u:e[o]={},s,n)):void 0===n?i(e)&&!isNaN(parseInt(t))?e.splice(t,1):delete e[t]:e[t]=n}}function k(e){var t,n={};for(t in e)l(e,t)&&(n[t]=e[t]);return n}var j=[].concat;function _(e){return j.apply([],e)}var A="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(_([8,16,32,64].map(function(e){return["Int","Uint","Float"].map(function(t){return t+e+"Array"})}))).filter(function(e){return r[e]}),S=new Set(A.map(function(e){return r[e]})),C=null;function I(e){return C=new WeakMap,e=function e(t){if(!t||"object"!=typeof t)return t;var n=C.get(t);if(n)return n;if(i(t)){n=[],C.set(t,n);for(var r=0,a=t.length;r<a;++r)n.push(e(t[r]))}else if(S.has(t.constructor))n=t;else{var o,u=s(t);for(o in n=u===Object.prototype?{}:Object.create(u),C.set(t,n),t)l(t,o)&&(n[o]=e(t[o]))}return n}(e),C=null,e}var T={}.toString;function P(e){return T.call(e).slice(8,-1)}var E="undefined"!=typeof Symbol?Symbol.iterator:"@@iterator",N="symbol"==typeof E?function(e){var t;return null!=e&&(t=e[E])&&t.apply(e)}:function(){return null};function O(e,t){return 0<=(t=e.indexOf(t))&&e.splice(t,1),0<=t}var M={};function K(e){var t,n,r,a;if(1===arguments.length){if(i(e))return e.slice();if(this===M&&"string"==typeof e)return[e];if(a=N(e)){for(n=[];!(r=a.next()).done;)n.push(r.value);return n}if(null==e)return[e];if("number"!=typeof(t=e.length))return[e];for(n=new Array(t);t--;)n[t]=e[t];return n}for(t=arguments.length,n=new Array(t);t--;)n[t]=arguments[t];return n}var R="undefined"!=typeof Symbol?function(e){return"AsyncFunction"===e[Symbol.toStringTag]}:function(){return!1},F=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(se=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"]),D={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function B(e,t){this.name=e,this.message=t}function q(e,t){return e+". Errors: "+Object.keys(t).map(function(e){return t[e].toString()}).filter(function(e,t,n){return n.indexOf(e)===t}).join("\n")}function z(e,t,n,r){this.failures=t,this.failedKeys=r,this.successCount=n,this.message=q(e,t)}function U(e,t){this.name="BulkError",this.failures=Object.keys(t).map(function(e){return t[e]}),this.failuresByPos=t,this.message=q(e,this.failures)}f(B).from(Error).extend({toString:function(){return this.name+": "+this.message}}),f(z).from(B),f(U).from(B);var $=F.reduce(function(e,t){return e[t]=t+"Error",e},{}),L=B,W=F.reduce(function(e,t){var n=t+"Error";function r(e,r){this.name=n,e?"string"==typeof e?(this.message="".concat(e).concat(r?"\n "+r:""),this.inner=r||null):"object"==typeof e&&(this.message="".concat(e.name," ").concat(e.message),this.inner=e):(this.message=D[t]||n,this.inner=null)}return f(r).from(L),e[t]=r,e},{});W.Syntax=SyntaxError,W.Type=TypeError,W.Range=RangeError;var H=se.reduce(function(e,t){return e[t+"Error"]=W[t],e},{}),Y=F.reduce(function(e,t){return-1===["Syntax","Type","Range"].indexOf(t)&&(e[t+"Error"]=W[t]),e},{});function V(){}function Q(e){return e}function G(e,t){return null==e||e===Q?t:function(n){return t(e(n))}}function X(e,t){return function(){e.apply(this,arguments),t.apply(this,arguments)}}function J(e,t){return e===V?t:function(){var n=e.apply(this,arguments);void 0!==n&&(arguments[0]=n);var r=this.onsuccess,a=this.onerror;this.onsuccess=null,this.onerror=null;var i=t.apply(this,arguments);return r&&(this.onsuccess=this.onsuccess?X(r,this.onsuccess):r),a&&(this.onerror=this.onerror?X(a,this.onerror):a),void 0!==i?i:n}}function Z(e,t){return e===V?t:function(){e.apply(this,arguments);var n=this.onsuccess,r=this.onerror;this.onsuccess=this.onerror=null,t.apply(this,arguments),n&&(this.onsuccess=this.onsuccess?X(n,this.onsuccess):n),r&&(this.onerror=this.onerror?X(r,this.onerror):r)}}function ee(e,t){return e===V?t:function(n){var r=e.apply(this,arguments);o(n,r);var a=this.onsuccess,i=this.onerror;return this.onsuccess=null,this.onerror=null,n=t.apply(this,arguments),a&&(this.onsuccess=this.onsuccess?X(a,this.onsuccess):a),i&&(this.onerror=this.onerror?X(i,this.onerror):i),void 0===r?void 0===n?void 0:n:o(r,n)}}function te(e,t){return e===V?t:function(){return!1!==t.apply(this,arguments)&&e.apply(this,arguments)}}function ne(e,t){return e===V?t:function(){var n=e.apply(this,arguments);if(n&&"function"==typeof n.then){for(var r=this,a=arguments.length,i=new Array(a);a--;)i[a]=arguments[a];return n.then(function(){return t.apply(r,i)})}return t.apply(this,arguments)}}Y.ModifyError=z,Y.DexieError=B,Y.BulkError=U;var re="undefined"!=typeof location&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function ae(e){re=e}var ie={},oe=100,se=(A="undefined"==typeof Promise?[]:function(){var e=Promise.resolve();if("undefined"==typeof crypto||!crypto.subtle)return[e,s(e),e];var t=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[t,s(t),e]}())[0],ue=(F=A[1],A=A[2],F=F&&F.then,se&&se.constructor),le=!!A,he=function(e,t){ve.push([e,t]),fe&&(queueMicrotask(Te),fe=!1)},de=!0,fe=!0,me=[],pe=[],ye=Q,ge={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:V,pgp:!1,env:{},finalize:V},be=ge,ve=[],xe=0,we=[];function ke(e){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");this._listeners=[],this._lib=!1;var t=this._PSD=be;if("function"!=typeof e){if(e!==ie)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(!1===this._state&&Ae(this,this._value))}this._state=null,this._value=null,++t.ref,function e(t,n){try{n(function(n){if(null===t._state){if(n===t)throw new TypeError("A promise cannot be resolved with itself.");var r=t._lib&&Pe();n&&"function"==typeof n.then?e(t,function(e,t){n instanceof ke?n._then(e,t):n.then(e,t)}):(t._state=!0,t._value=n,Se(t)),r&&Ee()}},Ae.bind(null,t))}catch(r){Ae(t,r)}}(this,e)}var je={get:function(){var e=be,t=Be;function n(n,r){var a=this,i=!e.global&&(e!==be||t!==Be),o=i&&!$e(),s=new ke(function(t,s){Ce(a,new _e(Qe(n,e,i,o),Qe(r,e,i,o),t,s,e))});return this._consoleTask&&(s._consoleTask=this._consoleTask),s}return n.prototype=ie,n},set:function(e){d(this,"then",e&&e.prototype===ie?je:{get:function(){return e},set:je.set})}};function _e(e,t,n,r,a){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.resolve=n,this.reject=r,this.psd=a}function Ae(e,t){var n,r;pe.push(t),null===e._state&&(n=e._lib&&Pe(),t=ye(t),e._state=!1,e._value=t,r=e,me.some(function(e){return e._value===r._value})||me.push(r),Se(e),n&&Ee())}function Se(e){var t=e._listeners;e._listeners=[];for(var n=0,r=t.length;n<r;++n)Ce(e,t[n]);var a=e._PSD;--a.ref||a.finalize(),0===xe&&(++xe,he(function(){0==--xe&&Ne()},[]))}function Ce(e,t){if(null!==e._state){var n=e._state?t.onFulfilled:t.onRejected;if(null===n)return(e._state?t.resolve:t.reject)(e._value);++t.psd.ref,++xe,he(Ie,[n,e,t])}else e._listeners.push(t)}function Ie(e,t,n){try{var r,a=t._value;!t._state&&pe.length&&(pe=[]),r=re&&t._consoleTask?t._consoleTask.run(function(){return e(a)}):e(a),t._state||-1!==pe.indexOf(a)||function(e){for(var t=me.length;t;)if(me[--t]._value===e._value)return me.splice(t,1)}(t),n.resolve(r)}catch(i){n.reject(i)}finally{0==--xe&&Ne(),--n.psd.ref||n.psd.finalize()}}function Te(){Ve(ge,function(){Pe()&&Ee()})}function Pe(){var e=de;return fe=de=!1,e}function Ee(){var e,t,n;do{for(;0<ve.length;)for(e=ve,ve=[],n=e.length,t=0;t<n;++t){var r=e[t];r[0].apply(null,r[1])}}while(0<ve.length);fe=de=!0}function Ne(){var e=me;me=[],e.forEach(function(e){e._PSD.onunhandled.call(null,e._value,e)});for(var t=we.slice(0),n=t.length;n;)t[--n]()}function Oe(e){return new ke(ie,!1,e)}function Me(e,t){var n=be;return function(){var r=Pe(),a=be;try{return He(n,!0),e.apply(this,arguments)}catch(i){t&&t(i)}finally{He(a,!1),r&&Ee()}}}c(ke.prototype,{then:je,_then:function(e,t){Ce(this,new _e(null,null,e,t,be))},catch:function(e){if(1===arguments.length)return this.then(null,e);var t=e,n=arguments[1];return"function"==typeof t?this.then(null,function(e){return(e instanceof t?n:Oe)(e)}):this.then(null,function(e){return(e&&e.name===t?n:Oe)(e)})},finally:function(e){return this.then(function(t){return ke.resolve(e()).then(function(){return t})},function(t){return ke.resolve(e()).then(function(){return Oe(t)})})},timeout:function(e,t){var n=this;return e<1/0?new ke(function(r,a){var i=setTimeout(function(){return a(new W.Timeout(t))},e);n.then(r,a).finally(clearTimeout.bind(null,i))}):this}}),"undefined"!=typeof Symbol&&Symbol.toStringTag&&d(ke.prototype,Symbol.toStringTag,"Dexie.Promise"),ge.env=Ye(),c(ke,{all:function(){var e=K.apply(null,arguments).map(Le);return new ke(function(t,n){0===e.length&&t([]);var r=e.length;e.forEach(function(a,i){return ke.resolve(a).then(function(n){e[i]=n,--r||t(e)},n)})})},resolve:function(e){return e instanceof ke?e:e&&"function"==typeof e.then?new ke(function(t,n){e.then(t,n)}):new ke(ie,!0,e)},reject:Oe,race:function(){var e=K.apply(null,arguments).map(Le);return new ke(function(t,n){e.map(function(e){return ke.resolve(e).then(t,n)})})},PSD:{get:function(){return be},set:function(e){return be=e}},totalEchoes:{get:function(){return Be}},newPSD:ze,usePSD:Ve,scheduler:{get:function(){return he},set:function(e){he=e}},rejectionMapper:{get:function(){return ye},set:function(e){ye=e}},follow:function(e,t){return new ke(function(n,r){return ze(function(t,n){var r=be;r.unhandleds=[],r.onunhandled=n,r.finalize=X(function(){var e,r=this;e=function(){0===r.unhandleds.length?t():n(r.unhandleds[0])},we.push(function t(){e(),we.splice(we.indexOf(t),1)}),++xe,he(function(){0==--xe&&Ne()},[])},r.finalize),e()},t,n,r)})}}),ue&&(ue.allSettled&&d(ke,"allSettled",function(){var e=K.apply(null,arguments).map(Le);return new ke(function(t){0===e.length&&t([]);var n=e.length,r=new Array(n);e.forEach(function(e,a){return ke.resolve(e).then(function(e){return r[a]={status:"fulfilled",value:e}},function(e){return r[a]={status:"rejected",reason:e}}).then(function(){return--n||t(r)})})})}),ue.any&&"undefined"!=typeof AggregateError&&d(ke,"any",function(){var e=K.apply(null,arguments).map(Le);return new ke(function(t,n){0===e.length&&n(new AggregateError([]));var r=e.length,a=new Array(r);e.forEach(function(e,i){return ke.resolve(e).then(function(e){return t(e)},function(e){a[i]=e,--r||n(new AggregateError(a))})})})}),ue.withResolvers&&(ke.withResolvers=ue.withResolvers));var Ke={awaits:0,echoes:0,id:0},Re=0,Fe=[],De=0,Be=0,qe=0;function ze(e,t,n,r){var a=be,i=Object.create(a);return i.parent=a,i.ref=0,i.global=!1,i.id=++qe,ge.env,i.env=le?{Promise:ke,PromiseProp:{value:ke,configurable:!0,writable:!0},all:ke.all,race:ke.race,allSettled:ke.allSettled,any:ke.any,resolve:ke.resolve,reject:ke.reject}:{},t&&o(i,t),++a.ref,i.finalize=function(){--this.parent.ref||this.parent.finalize()},r=Ve(i,e,n,r),0===i.ref&&i.finalize(),r}function Ue(){return Ke.id||(Ke.id=++Re),++Ke.awaits,Ke.echoes+=oe,Ke.id}function $e(){return!!Ke.awaits&&(0==--Ke.awaits&&(Ke.id=0),Ke.echoes=Ke.awaits*oe,!0)}function Le(e){return Ke.echoes&&e&&e.constructor===ue?(Ue(),e.then(function(e){return $e(),e},function(e){return $e(),Xe(e)})):e}function We(){var e=Fe[Fe.length-1];Fe.pop(),He(e,!1)}function He(e,t){var n,a=be;(t?!Ke.echoes||De++&&e===be:!De||--De&&e===be)||queueMicrotask(t?function(e){++Be,Ke.echoes&&0!=--Ke.echoes||(Ke.echoes=Ke.awaits=Ke.id=0),Fe.push(be),He(e,!0)}.bind(null,e):We),e!==be&&(be=e,a===ge&&(ge.env=Ye()),le&&(n=ge.env.Promise,t=e.env,(a.global||e.global)&&(Object.defineProperty(r,"Promise",t.PromiseProp),n.all=t.all,n.race=t.race,n.resolve=t.resolve,n.reject=t.reject,t.allSettled&&(n.allSettled=t.allSettled),t.any&&(n.any=t.any))))}function Ye(){var e=r.Promise;return le?{Promise:e,PromiseProp:Object.getOwnPropertyDescriptor(r,"Promise"),all:e.all,race:e.race,allSettled:e.allSettled,any:e.any,resolve:e.resolve,reject:e.reject}:{}}function Ve(e,t,n,r,a){var i=be;try{return He(e,!0),t(n,r,a)}finally{He(i,!1)}}function Qe(e,t,n,r){return"function"!=typeof e?e:function(){var a=be;n&&Ue(),He(t,!0);try{return e.apply(this,arguments)}finally{He(a,!1),r&&queueMicrotask($e)}}}function Ge(e){Promise===ue&&0===Ke.echoes?0===De?e():enqueueNativeMicroTask(e):setTimeout(e,0)}-1===(""+F).indexOf("[native code]")&&(Ue=$e=V);var Xe=ke.reject,Je=String.fromCharCode(65535),Ze="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",et="String expected.",tt=[],nt="__dbnames",rt="readonly",at="readwrite";function it(e,t){return e?t?function(){return e.apply(this,arguments)&&t.apply(this,arguments)}:e:t}var ot={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function st(e){return"string"!=typeof e||/\./.test(e)?function(e){return e}:function(t){return void 0===t[e]&&e in t&&delete(t=I(t))[e],t}}function ut(){throw W.Type()}function lt(e,t){try{var n=ct(e),r=ct(t);if(n!==r)return"Array"===n?1:"Array"===r?-1:"binary"===n?1:"binary"===r?-1:"string"===n?1:"string"===r?-1:"Date"===n?1:"Date"!==r?NaN:-1;switch(n){case"number":case"Date":case"string":return t<e?1:e<t?-1:0;case"binary":return function(e,t){for(var n=e.length,r=t.length,a=n<r?n:r,i=0;i<a;++i)if(e[i]!==t[i])return e[i]<t[i]?-1:1;return n===r?0:n<r?-1:1}(ht(e),ht(t));case"Array":return function(e,t){for(var n=e.length,r=t.length,a=n<r?n:r,i=0;i<a;++i){var o=lt(e[i],t[i]);if(0!==o)return o}return n===r?0:n<r?-1:1}(e,t)}}catch(a){}return NaN}function ct(e){var t=typeof e;return"object"!=t?t:ArrayBuffer.isView(e)||"ArrayBuffer"===(e=P(e))?"binary":e}function ht(e){return e instanceof Uint8Array?e:ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e)}var dt=(ft.prototype._trans=function(e,t,n){var r=this._tx||be.trans,a=this.name,i=re&&"undefined"!=typeof console&&console.createTask&&void 0;function o(e,n,r){if(!r.schema[a])throw new W.NotFound("Table "+a+" not part of transaction");return t(r.idbtrans,r)}var s=Pe();try{var u=r&&r.db._novip===this.db._novip?r===be.trans?r._promise(e,o,n):ze(function(){return r._promise(e,o,n)},{trans:r,transless:be.transless||be}):function e(t,n,r,a){if(t.idbdb&&(t._state.openComplete||be.letThrough||t._vip)){var i=t._createTransaction(n,r,t._dbSchema);try{i.create(),t._state.PR1398_maxLoop=3}catch(o){return o.name===$.InvalidState&&t.isOpen()&&0<--t._state.PR1398_maxLoop?(t.close({disableAutoOpen:!1}),t.open().then(function(){return e(t,n,r,a)})):Xe(o)}return i._promise(n,function(e,t){return ze(function(){return be.trans=i,a(e,t,i)})}).then(function(e){if("readwrite"===n)try{i.idbtrans.commit()}catch(t){}return"readonly"===n?e:i._completion.then(function(){return e})})}if(t._state.openComplete)return Xe(new W.DatabaseClosed(t._state.dbOpenError));if(!t._state.isBeingOpened){if(!t._state.autoOpen)return Xe(new W.DatabaseClosed);t.open().catch(V)}return t._state.dbReadyPromise.then(function(){return e(t,n,r,a)})}(this.db,e,[this.name],o);return i&&(u._consoleTask=i,u=u.catch(function(e){return Xe(e)})),u}finally{s&&Ee()}},ft.prototype.get=function(e,t){var n=this;return e&&e.constructor===Object?this.where(e).first(t):null==e?Xe(new W.Type("Invalid argument to Table.get()")):this._trans("readonly",function(t){return n.core.get({trans:t,key:e}).then(function(e){return n.hook.reading.fire(e)})}).then(t)},ft.prototype.where=function(e){if("string"==typeof e)return new this.db.WhereClause(this,e);if(i(e))return new this.db.WhereClause(this,"[".concat(e.join("+"),"]"));var t=a(e);if(1===t.length)return this.where(t[0]).equals(e[t[0]]);var n=this.schema.indexes.concat(this.schema.primKey).filter(function(e){if(e.compound&&t.every(function(t){return 0<=e.keyPath.indexOf(t)})){for(var n=0;n<t.length;++n)if(-1===t.indexOf(e.keyPath[n]))return!1;return!0}return!1}).sort(function(e,t){return e.keyPath.length-t.keyPath.length})[0];if(n&&this.db._maxKey!==Je){var r=n.keyPath.slice(0,t.length);return this.where(r).equals(r.map(function(t){return e[t]}))}var o=this.schema.idxByName;function s(e,t){return 0===lt(e,t)}r=(u=t.reduce(function(t,n){var r=t[0],a=t[1],u=(t=o[n],e[n]);return[r||t,r||!t?it(a,t&&t.multi?function(e){return e=x(e,n),i(e)&&e.some(function(e){return s(u,e)})}:function(e){return s(u,x(e,n))}):a]},[null,null]))[0];var u=u[1];return r?this.where(r.name).equals(e[r.keyPath]).filter(u):n?this.filter(u):this.where(t).equals("")},ft.prototype.filter=function(e){return this.toCollection().and(e)},ft.prototype.count=function(e){return this.toCollection().count(e)},ft.prototype.offset=function(e){return this.toCollection().offset(e)},ft.prototype.limit=function(e){return this.toCollection().limit(e)},ft.prototype.each=function(e){return this.toCollection().each(e)},ft.prototype.toArray=function(e){return this.toCollection().toArray(e)},ft.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},ft.prototype.orderBy=function(e){return new this.db.Collection(new this.db.WhereClause(this,i(e)?"[".concat(e.join("+"),"]"):e))},ft.prototype.reverse=function(){return this.toCollection().reverse()},ft.prototype.mapToClass=function(t){var n,r=this.db,a=this.name;function i(){return null!==n&&n.apply(this,arguments)||this}(this.schema.mappedClass=t).prototype instanceof ut&&(function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}(i,n=t),Object.defineProperty(i.prototype,"db",{get:function(){return r},enumerable:!1,configurable:!0}),i.prototype.table=function(){return a},t=i);for(var o=new Set,u=t.prototype;u;u=s(u))Object.getOwnPropertyNames(u).forEach(function(e){return o.add(e)});function l(e){if(!e)return e;var n,r=Object.create(t.prototype);for(n in e)if(!o.has(n))try{r[n]=e[n]}catch(a){}return r}return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=l,this.hook("reading",l),t},ft.prototype.defineClass=function(){return this.mapToClass(function(e){o(this,e)})},ft.prototype.add=function(e,t){var n=this,r=this.schema.primKey,a=r.auto,i=r.keyPath,o=e;return i&&a&&(o=st(i)(e)),this._trans("readwrite",function(e){return n.core.mutate({trans:e,type:"add",keys:null!=t?[t]:null,values:[o]})}).then(function(e){return e.numFailures?ke.reject(e.failures[0]):e.lastResult}).then(function(t){if(i)try{w(e,i,t)}catch(n){}return t})},ft.prototype.update=function(e,t){return"object"!=typeof e||i(e)?this.where(":id").equals(e).modify(t):void 0===(e=x(e,this.schema.primKey.keyPath))?Xe(new W.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(e).modify(t)},ft.prototype.put=function(e,t){var n=this,r=this.schema.primKey,a=r.auto,i=r.keyPath,o=e;return i&&a&&(o=st(i)(e)),this._trans("readwrite",function(e){return n.core.mutate({trans:e,type:"put",values:[o],keys:null!=t?[t]:null})}).then(function(e){return e.numFailures?ke.reject(e.failures[0]):e.lastResult}).then(function(t){if(i)try{w(e,i,t)}catch(n){}return t})},ft.prototype.delete=function(e){var t=this;return this._trans("readwrite",function(n){return t.core.mutate({trans:n,type:"delete",keys:[e]})}).then(function(e){return e.numFailures?ke.reject(e.failures[0]):void 0})},ft.prototype.clear=function(){var e=this;return this._trans("readwrite",function(t){return e.core.mutate({trans:t,type:"deleteRange",range:ot})}).then(function(e){return e.numFailures?ke.reject(e.failures[0]):void 0})},ft.prototype.bulkGet=function(e){var t=this;return this._trans("readonly",function(n){return t.core.getMany({keys:e,trans:n}).then(function(e){return e.map(function(e){return t.hook.reading.fire(e)})})})},ft.prototype.bulkAdd=function(e,t,n){var r=this,a=Array.isArray(t)?t:void 0,i=(n=n||(a?void 0:t))?n.allKeys:void 0;return this._trans("readwrite",function(t){var n=(s=r.schema.primKey).auto;if((s=s.keyPath)&&a)throw new W.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(a&&a.length!==e.length)throw new W.InvalidArgument("Arguments objects and keys must have the same length");var o=e.length,s=s&&n?e.map(st(s)):e;return r.core.mutate({trans:t,type:"add",keys:a,values:s,wantResults:i}).then(function(e){var t=e.numFailures,n=e.results,a=e.lastResult;if(e=e.failures,0===t)return i?n:a;throw new U("".concat(r.name,".bulkAdd(): ").concat(t," of ").concat(o," operations failed"),e)})})},ft.prototype.bulkPut=function(e,t,n){var r=this,a=Array.isArray(t)?t:void 0,i=(n=n||(a?void 0:t))?n.allKeys:void 0;return this._trans("readwrite",function(t){var n=(s=r.schema.primKey).auto;if((s=s.keyPath)&&a)throw new W.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(a&&a.length!==e.length)throw new W.InvalidArgument("Arguments objects and keys must have the same length");var o=e.length,s=s&&n?e.map(st(s)):e;return r.core.mutate({trans:t,type:"put",keys:a,values:s,wantResults:i}).then(function(e){var t=e.numFailures,n=e.results,a=e.lastResult;if(e=e.failures,0===t)return i?n:a;throw new U("".concat(r.name,".bulkPut(): ").concat(t," of ").concat(o," operations failed"),e)})})},ft.prototype.bulkUpdate=function(e){var t=this,n=this.core,r=e.map(function(e){return e.key}),a=e.map(function(e){return e.changes}),i=[];return this._trans("readwrite",function(o){return n.getMany({trans:o,keys:r,cache:"clone"}).then(function(s){var u=[],l=[];e.forEach(function(e,n){var r=e.key,a=e.changes,o=s[n];if(o){for(var c=0,h=Object.keys(a);c<h.length;c++){var d=h[c],f=a[d];if(d===t.schema.primKey.keyPath){if(0!==lt(f,r))throw new W.Constraint("Cannot update primary key in bulkUpdate()")}else w(o,d,f)}i.push(n),u.push(r),l.push(o)}});var c=u.length;return n.mutate({trans:o,type:"put",keys:u,values:l,updates:{keys:r,changeSpecs:a}}).then(function(e){var n=e.numFailures,r=e.failures;if(0===n)return c;for(var a=0,o=Object.keys(r);a<o.length;a++){var s,u=o[a],l=i[Number(u)];null!=l&&(s=r[u],delete r[u],r[l]=s)}throw new U("".concat(t.name,".bulkUpdate(): ").concat(n," of ").concat(c," operations failed"),r)})})})},ft.prototype.bulkDelete=function(e){var t=this,n=e.length;return this._trans("readwrite",function(n){return t.core.mutate({trans:n,type:"delete",keys:e})}).then(function(e){var r=e.numFailures,a=e.lastResult;if(e=e.failures,0===r)return a;throw new U("".concat(t.name,".bulkDelete(): ").concat(r," of ").concat(n," operations failed"),e)})},ft);function ft(){}function mt(e){function t(t,r){if(r){for(var a=arguments.length,i=new Array(a-1);--a;)i[a-1]=arguments[a];return n[t].subscribe.apply(null,i),e}if("string"==typeof t)return n[t]}var n={};t.addEventType=s;for(var r=1,o=arguments.length;r<o;++r)s(arguments[r]);return t;function s(e,r,o){if("object"!=typeof e){var u;r=r||te;var l={subscribers:[],fire:o=o||V,subscribe:function(e){-1===l.subscribers.indexOf(e)&&(l.subscribers.push(e),l.fire=r(l.fire,e))},unsubscribe:function(e){l.subscribers=l.subscribers.filter(function(t){return t!==e}),l.fire=l.subscribers.reduce(r,o)}};return n[e]=t[e]=l}a(u=e).forEach(function(e){var t=u[e];if(i(t))s(e,u[e][0],u[e][1]);else{if("asap"!==t)throw new W.InvalidArgument("Invalid event config");var n=s(e,Q,function(){for(var e=arguments.length,t=new Array(e);e--;)t[e]=arguments[e];n.subscribers.forEach(function(e){v(function(){e.apply(null,t)})})})}})}}function pt(e,t){return f(t).from({prototype:e}),t}function yt(e,t){return!(e.filter||e.algorithm||e.or)&&(t?e.justLimit:!e.replayFilter)}function gt(e,t){e.filter=it(e.filter,t)}function bt(e,t,n){var r=e.replayFilter;e.replayFilter=r?function(){return it(r(),t())}:t,e.justLimit=n&&!r}function vt(e,t){if(e.isPrimKey)return t.primaryKey;var n=t.getIndexByKeyPath(e.index);if(!n)throw new W.Schema("KeyPath "+e.index+" on object store "+t.name+" is not indexed");return n}function xt(e,t,n){var r=vt(e,t.schema);return t.openCursor({trans:n,values:!e.keysOnly,reverse:"prev"===e.dir,unique:!!e.unique,query:{index:r,range:e.range}})}function wt(e,t,n,r){var a=e.replayFilter?it(e.filter,e.replayFilter()):e.filter;if(e.or){var i={},o=function(e,n,r){var o,s;a&&!a(n,r,function(e){return n.stop(e)},function(e){return n.fail(e)})||("[object ArrayBuffer]"==(s=""+(o=n.primaryKey))&&(s=""+new Uint8Array(o)),l(i,s)||(i[s]=!0,t(e,n,r)))};return Promise.all([e.or._iterate(o,n),kt(xt(e,r,n),e.algorithm,o,!e.keysOnly&&e.valueMapper)])}return kt(xt(e,r,n),it(e.algorithm,a),t,!e.keysOnly&&e.valueMapper)}function kt(e,t,n,r){var a=Me(r?function(e,t,a){return n(r(e),t,a)}:n);return e.then(function(e){if(e)return e.start(function(){var n=function(){return e.continue()};t&&!t(e,function(e){return n=e},function(t){e.stop(t),n=V},function(t){e.fail(t),n=V})||a(e.value,e,function(e){return n=e}),n()})})}var jt=(_t.prototype.execute=function(e){var t=this["@@propmod"];if(void 0!==t.add){var r=t.add;if(i(r))return n(n([],i(e)?e:[],!0),r).sort();if("number"==typeof r)return(Number(e)||0)+r;if("bigint"==typeof r)try{return BigInt(e)+r}catch(o){return BigInt(0)+r}throw new TypeError("Invalid term ".concat(r))}if(void 0!==t.remove){var a=t.remove;if(i(a))return i(e)?e.filter(function(e){return!a.includes(e)}).sort():[];if("number"==typeof a)return Number(e)-a;if("bigint"==typeof a)try{return BigInt(e)-a}catch(o){return BigInt(0)-a}throw new TypeError("Invalid subtrahend ".concat(a))}return(r=null===(r=t.replacePrefix)||void 0===r?void 0:r[0])&&"string"==typeof e&&e.startsWith(r)?t.replacePrefix[1]+e.substring(r.length):e},_t);function _t(e){this["@@propmod"]=e}var At=(St.prototype._read=function(e,t){var n=this._ctx;return n.error?n.table._trans(null,Xe.bind(null,n.error)):n.table._trans("readonly",e).then(t)},St.prototype._write=function(e){var t=this._ctx;return t.error?t.table._trans(null,Xe.bind(null,t.error)):t.table._trans("readwrite",e,"locked")},St.prototype._addAlgorithm=function(e){var t=this._ctx;t.algorithm=it(t.algorithm,e)},St.prototype._iterate=function(e,t){return wt(this._ctx,e,t,this._ctx.table.core)},St.prototype.clone=function(e){var t=Object.create(this.constructor.prototype),n=Object.create(this._ctx);return e&&o(n,e),t._ctx=n,t},St.prototype.raw=function(){return this._ctx.valueMapper=null,this},St.prototype.each=function(e){var t=this._ctx;return this._read(function(n){return wt(t,e,n,t.table.core)})},St.prototype.count=function(e){var t=this;return this._read(function(e){var n=t._ctx,r=n.table.core;if(yt(n,!0))return r.count({trans:e,query:{index:vt(n,r.schema),range:n.range}}).then(function(e){return Math.min(e,n.limit)});var a=0;return wt(n,function(){return++a,!1},e,r).then(function(){return a})}).then(e)},St.prototype.sortBy=function(e,t){var n=e.split(".").reverse(),r=n[0],a=n.length-1;function i(e,t){return t?i(e[n[t]],t-1):e[r]}var o="next"===this._ctx.dir?1:-1;function s(e,t){return lt(i(e,a),i(t,a))*o}return this.toArray(function(e){return e.sort(s)}).then(t)},St.prototype.toArray=function(e){var t=this;return this._read(function(e){var n=t._ctx;if("next"===n.dir&&yt(n,!0)&&0<n.limit){var r=n.valueMapper,a=vt(n,n.table.core.schema);return n.table.core.query({trans:e,limit:n.limit,values:!0,query:{index:a,range:n.range}}).then(function(e){return e=e.result,r?e.map(r):e})}var i=[];return wt(n,function(e){return i.push(e)},e,n.table.core).then(function(){return i})},e)},St.prototype.offset=function(e){var t=this._ctx;return e<=0||(t.offset+=e,yt(t)?bt(t,function(){var t=e;return function(e,n){return 0===t||(1===t?--t:n(function(){e.advance(t),t=0}),!1)}}):bt(t,function(){var t=e;return function(){return--t<0}})),this},St.prototype.limit=function(e){return this._ctx.limit=Math.min(this._ctx.limit,e),bt(this._ctx,function(){var t=e;return function(e,n,r){return--t<=0&&n(r),0<=t}},!0),this},St.prototype.until=function(e,t){return gt(this._ctx,function(n,r,a){return!e(n.value)||(r(a),t)}),this},St.prototype.first=function(e){return this.limit(1).toArray(function(e){return e[0]}).then(e)},St.prototype.last=function(e){return this.reverse().first(e)},St.prototype.filter=function(e){var t;return gt(this._ctx,function(t){return e(t.value)}),(t=this._ctx).isMatch=it(t.isMatch,e),this},St.prototype.and=function(e){return this.filter(e)},St.prototype.or=function(e){return new this.db.WhereClause(this._ctx.table,e,this)},St.prototype.reverse=function(){return this._ctx.dir="prev"===this._ctx.dir?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},St.prototype.desc=function(){return this.reverse()},St.prototype.eachKey=function(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each(function(t,n){e(n.key,n)})},St.prototype.eachUniqueKey=function(e){return this._ctx.unique="unique",this.eachKey(e)},St.prototype.eachPrimaryKey=function(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each(function(t,n){e(n.primaryKey,n)})},St.prototype.keys=function(e){var t=this._ctx;t.keysOnly=!t.isMatch;var n=[];return this.each(function(e,t){n.push(t.key)}).then(function(){return n}).then(e)},St.prototype.primaryKeys=function(e){var t=this._ctx;if("next"===t.dir&&yt(t,!0)&&0<t.limit)return this._read(function(e){var n=vt(t,t.table.core.schema);return t.table.core.query({trans:e,values:!1,limit:t.limit,query:{index:n,range:t.range}})}).then(function(e){return e.result}).then(e);t.keysOnly=!t.isMatch;var n=[];return this.each(function(e,t){n.push(t.primaryKey)}).then(function(){return n}).then(e)},St.prototype.uniqueKeys=function(e){return this._ctx.unique="unique",this.keys(e)},St.prototype.firstKey=function(e){return this.limit(1).keys(function(e){return e[0]}).then(e)},St.prototype.lastKey=function(e){return this.reverse().firstKey(e)},St.prototype.distinct=function(){var e;if(!(e=(e=this._ctx).index&&e.table.schema.idxByName[e.index])||!e.multi)return this;var t={};return gt(this._ctx,function(e){var n=e.primaryKey.toString();return e=l(t,n),t[n]=!0,!e}),this},St.prototype.modify=function(e){var t=this,n=this._ctx;return this._write(function(r){var i,o,s;s="function"==typeof e?e:(i=a(e),o=i.length,function(t){for(var n=!1,r=0;r<o;++r){var a=i[r],s=e[a],u=x(t,a);s instanceof jt?(w(t,a,s.execute(u)),n=!0):u!==s&&(w(t,a,s),n=!0)}return n});var u,l=n.table.core,c=(u=l.schema.primaryKey).outbound,h=u.extractKey,d=200;function f(e,t){var n=t.failures;t=t.numFailures,p+=e-t;for(var r=0,i=a(n);r<i.length;r++){var o=i[r];m.push(n[o])}}(u=t.db._options.modifyChunkSize)&&(d="object"==typeof u?u[l.name]||u["*"]||200:u);var m=[],p=0,y=[];return t.clone().primaryKeys().then(function(t){function a(n){var o=Math.min(d,t.length-n);return l.getMany({trans:r,keys:t.slice(n,n+o),cache:"immutable"}).then(function(u){for(var m=[],p=[],y=c?[]:null,g=[],b=0;b<o;++b){var v=u[b],x={value:I(v),primKey:t[n+b]};!1!==s.call(x,x.value,x)&&(null==x.value?g.push(t[n+b]):c||0===lt(h(v),h(x.value))?(p.push(x.value),c&&y.push(t[n+b])):(g.push(t[n+b]),m.push(x.value)))}return Promise.resolve(0<m.length&&l.mutate({trans:r,type:"add",values:m}).then(function(e){for(var t in e.failures)g.splice(parseInt(t),1);f(m.length,e)})).then(function(){return(0<p.length||i&&"object"==typeof e)&&l.mutate({trans:r,type:"put",keys:y,values:p,criteria:i,changeSpec:"function"!=typeof e&&e,isAdditionalChunk:0<n}).then(function(e){return f(p.length,e)})}).then(function(){return(0<g.length||i&&e===Ct)&&l.mutate({trans:r,type:"delete",keys:g,criteria:i,isAdditionalChunk:0<n}).then(function(e){return f(g.length,e)})}).then(function(){return t.length>n+o&&a(n+d)})})}var i=yt(n)&&n.limit===1/0&&("function"!=typeof e||e===Ct)&&{index:n.index,range:n.range};return a(0).then(function(){if(0<m.length)throw new z("Error modifying one or more objects",m,p,y);return t.length})})})},St.prototype.delete=function(){var e=this._ctx,t=e.range;return yt(e)&&(e.isPrimKey||3===t.type)?this._write(function(n){var r=e.table.core.schema.primaryKey,a=t;return e.table.core.count({trans:n,query:{index:r,range:a}}).then(function(t){return e.table.core.mutate({trans:n,type:"deleteRange",range:a}).then(function(e){var n=e.failures;if(e.lastResult,e.results,e=e.numFailures)throw new z("Could not delete some values",Object.keys(n).map(function(e){return n[e]}),t-e);return t-e})})}):this.modify(Ct)},St);function St(){}var Ct=function(e,t){return t.value=null};function It(e,t){return e<t?-1:e===t?0:1}function Tt(e,t){return t<e?-1:e===t?0:1}function Pt(e,t,n){return(e=e instanceof Kt?new e.Collection(e):e)._ctx.error=new(n||TypeError)(t),e}function Et(e){return new e.Collection(e,function(){return Mt("")}).limit(0)}function Nt(e,t,n,r){var a,i,o,s,u,l,c,h=n.length;if(!n.every(function(e){return"string"==typeof e}))return Pt(e,et);function d(e){a="next"===e?function(e){return e.toUpperCase()}:function(e){return e.toLowerCase()},i="next"===e?function(e){return e.toLowerCase()}:function(e){return e.toUpperCase()},o="next"===e?It:Tt;var t=n.map(function(e){return{lower:i(e),upper:a(e)}}).sort(function(e,t){return o(e.lower,t.lower)});s=t.map(function(e){return e.upper}),u=t.map(function(e){return e.lower}),c="next"===(l=e)?"":r}d("next"),(e=new e.Collection(e,function(){return Ot(s[0],u[h-1]+r)}))._ondirectionchange=function(e){d(e)};var f=0;return e._addAlgorithm(function(e,n,r){var a=e.key;if("string"!=typeof a)return!1;var d=i(a);if(t(d,u,f))return!0;for(var m=null,p=f;p<h;++p){var y=function(e,t,n,r,a,i){for(var o=Math.min(e.length,r.length),s=-1,u=0;u<o;++u){var l=t[u];if(l!==r[u])return a(e[u],n[u])<0?e.substr(0,u)+n[u]+n.substr(u+1):a(e[u],r[u])<0?e.substr(0,u)+r[u]+n.substr(u+1):0<=s?e.substr(0,s)+t[s]+n.substr(s+1):null;a(e[u],l)<0&&(s=u)}return o<r.length&&"next"===i?e+n.substr(e.length):o<e.length&&"prev"===i?e.substr(0,n.length):s<0?null:e.substr(0,s)+r[s]+n.substr(s+1)}(a,d,s[p],u[p],o,l);null===y&&null===m?f=p+1:(null===m||0<o(m,y))&&(m=y)}return n(null!==m?function(){e.continue(m+c)}:r),!1}),e}function Ot(e,t,n,r){return{type:2,lower:e,upper:t,lowerOpen:n,upperOpen:r}}function Mt(e){return{type:1,lower:e,upper:e}}var Kt=(Object.defineProperty(Rt.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),Rt.prototype.between=function(e,t,n,r){n=!1!==n,r=!0===r;try{return 0<this._cmp(e,t)||0===this._cmp(e,t)&&(n||r)&&(!n||!r)?Et(this):new this.Collection(this,function(){return Ot(e,t,!n,!r)})}catch(a){return Pt(this,Ze)}},Rt.prototype.equals=function(e){return null==e?Pt(this,Ze):new this.Collection(this,function(){return Mt(e)})},Rt.prototype.above=function(e){return null==e?Pt(this,Ze):new this.Collection(this,function(){return Ot(e,void 0,!0)})},Rt.prototype.aboveOrEqual=function(e){return null==e?Pt(this,Ze):new this.Collection(this,function(){return Ot(e,void 0,!1)})},Rt.prototype.below=function(e){return null==e?Pt(this,Ze):new this.Collection(this,function(){return Ot(void 0,e,!1,!0)})},Rt.prototype.belowOrEqual=function(e){return null==e?Pt(this,Ze):new this.Collection(this,function(){return Ot(void 0,e)})},Rt.prototype.startsWith=function(e){return"string"!=typeof e?Pt(this,et):this.between(e,e+Je,!0,!0)},Rt.prototype.startsWithIgnoreCase=function(e){return""===e?this.startsWith(e):Nt(this,function(e,t){return 0===e.indexOf(t[0])},[e],Je)},Rt.prototype.equalsIgnoreCase=function(e){return Nt(this,function(e,t){return e===t[0]},[e],"")},Rt.prototype.anyOfIgnoreCase=function(){var e=K.apply(M,arguments);return 0===e.length?Et(this):Nt(this,function(e,t){return-1!==t.indexOf(e)},e,"")},Rt.prototype.startsWithAnyOfIgnoreCase=function(){var e=K.apply(M,arguments);return 0===e.length?Et(this):Nt(this,function(e,t){return t.some(function(t){return 0===e.indexOf(t)})},e,Je)},Rt.prototype.anyOf=function(){var e=this,t=K.apply(M,arguments),n=this._cmp;try{t.sort(n)}catch(i){return Pt(this,Ze)}if(0===t.length)return Et(this);var r=new this.Collection(this,function(){return Ot(t[0],t[t.length-1])});r._ondirectionchange=function(r){n="next"===r?e._ascending:e._descending,t.sort(n)};var a=0;return r._addAlgorithm(function(e,r,i){for(var o=e.key;0<n(o,t[a]);)if(++a===t.length)return r(i),!1;return 0===n(o,t[a])||(r(function(){e.continue(t[a])}),!1)}),r},Rt.prototype.notEqual=function(e){return this.inAnyRange([[-1/0,e],[e,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},Rt.prototype.noneOf=function(){var e=K.apply(M,arguments);if(0===e.length)return new this.Collection(this);try{e.sort(this._ascending)}catch(n){return Pt(this,Ze)}var t=e.reduce(function(e,t){return e?e.concat([[e[e.length-1][1],t]]):[[-1/0,t]]},null);return t.push([e[e.length-1],this.db._maxKey]),this.inAnyRange(t,{includeLowers:!1,includeUppers:!1})},Rt.prototype.inAnyRange=function(e,t){var n=this,r=this._cmp,a=this._ascending,i=this._descending,o=this._min,s=this._max;if(0===e.length)return Et(this);if(!e.every(function(e){return void 0!==e[0]&&void 0!==e[1]&&a(e[0],e[1])<=0}))return Pt(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",W.InvalidArgument);var u,l=!t||!1!==t.includeLowers,c=t&&!0===t.includeUppers,h=a;function d(e,t){return h(e[0],t[0])}try{(u=e.reduce(function(e,t){for(var n=0,a=e.length;n<a;++n){var i=e[n];if(r(t[0],i[1])<0&&0<r(t[1],i[0])){i[0]=o(i[0],t[0]),i[1]=s(i[1],t[1]);break}}return n===a&&e.push(t),e},[])).sort(d)}catch(g){return Pt(this,Ze)}var f=0,m=c?function(e){return 0<a(e,u[f][1])}:function(e){return 0<=a(e,u[f][1])},p=l?function(e){return 0<i(e,u[f][0])}:function(e){return 0<=i(e,u[f][0])},y=m;return(e=new this.Collection(this,function(){return Ot(u[0][0],u[u.length-1][1],!l,!c)}))._ondirectionchange=function(e){h="next"===e?(y=m,a):(y=p,i),u.sort(d)},e._addAlgorithm(function(e,t,r){for(var i,o=e.key;y(o);)if(++f===u.length)return t(r),!1;return!m(i=o)&&!p(i)||(0===n._cmp(o,u[f][1])||0===n._cmp(o,u[f][0])||t(function(){h===a?e.continue(u[f][0]):e.continue(u[f][1])}),!1)}),e},Rt.prototype.startsWithAnyOf=function(){var e=K.apply(M,arguments);return e.every(function(e){return"string"==typeof e})?0===e.length?Et(this):this.inAnyRange(e.map(function(e){return[e,e+Je]})):Pt(this,"startsWithAnyOf() only works with strings")},Rt);function Rt(){}function Ft(e){return Me(function(t){return Dt(t),e(t.target.error),!1})}function Dt(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault()}var Bt="storagemutated",qt="x-storagemutated-1",zt=mt(null,Bt),Ut=($t.prototype._lock=function(){return b(!be.global),++this._reculock,1!==this._reculock||be.global||(be.lockOwnerFor=this),this},$t.prototype._unlock=function(){if(b(!be.global),0==--this._reculock)for(be.global||(be.lockOwnerFor=null);0<this._blockedFuncs.length&&!this._locked();){var e=this._blockedFuncs.shift();try{Ve(e[1],e[0])}catch(t){}}return this},$t.prototype._locked=function(){return this._reculock&&be.lockOwnerFor!==this},$t.prototype.create=function(e){var t=this;if(!this.mode)return this;var n=this.db.idbdb,r=this.db._state.dbOpenError;if(b(!this.idbtrans),!e&&!n)switch(r&&r.name){case"DatabaseClosedError":throw new W.DatabaseClosed(r);case"MissingAPIError":throw new W.MissingAPI(r.message,r);default:throw new W.OpenFailed(r)}if(!this.active)throw new W.TransactionInactive;return b(null===this._completion._state),(e=this.idbtrans=e||(this.db.core||n).transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})).onerror=Me(function(n){Dt(n),t._reject(e.error)}),e.onabort=Me(function(n){Dt(n),t.active&&t._reject(new W.Abort(e.error)),t.active=!1,t.on("abort").fire(n)}),e.oncomplete=Me(function(){t.active=!1,t._resolve(),"mutatedParts"in e&&zt.storagemutated.fire(e.mutatedParts)}),this},$t.prototype._promise=function(e,t,n){var r=this;if("readwrite"===e&&"readwrite"!==this.mode)return Xe(new W.ReadOnly("Transaction is readonly"));if(!this.active)return Xe(new W.TransactionInactive);if(this._locked())return new ke(function(a,i){r._blockedFuncs.push([function(){r._promise(e,t,n).then(a,i)},be])});if(n)return ze(function(){var e=new ke(function(e,n){r._lock();var a=t(e,n,r);a&&a.then&&a.then(e,n)});return e.finally(function(){return r._unlock()}),e._lib=!0,e});var a=new ke(function(e,n){var a=t(e,n,r);a&&a.then&&a.then(e,n)});return a._lib=!0,a},$t.prototype._root=function(){return this.parent?this.parent._root():this},$t.prototype.waitFor=function(e){var t,n=this._root(),r=ke.resolve(e);n._waitingFor?n._waitingFor=n._waitingFor.then(function(){return r}):(n._waitingFor=r,n._waitingQueue=[],t=n.idbtrans.objectStore(n.storeNames[0]),function e(){for(++n._spinCount;n._waitingQueue.length;)n._waitingQueue.shift()();n._waitingFor&&(t.get(-1/0).onsuccess=e)}());var a=n._waitingFor;return new ke(function(e,t){r.then(function(t){return n._waitingQueue.push(Me(e.bind(null,t)))},function(e){return n._waitingQueue.push(Me(t.bind(null,e)))}).finally(function(){n._waitingFor===a&&(n._waitingFor=null)})})},$t.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new W.Abort))},$t.prototype.table=function(e){var t=this._memoizedTables||(this._memoizedTables={});if(l(t,e))return t[e];var n=this.schema[e];if(!n)throw new W.NotFound("Table "+e+" not part of transaction");return(n=new this.db.Table(e,n,this)).core=this.db.core.table(e),t[e]=n},$t);function $t(){}function Lt(e,t,n,r,a,i,o){return{name:e,keyPath:t,unique:n,multi:r,auto:a,compound:i,src:(n&&!o?"&":"")+(r?"*":"")+(a?"++":"")+Wt(t)}}function Wt(e){return"string"==typeof e?e:e?"["+[].join.call(e,"+")+"]":""}function Ht(e,t,n){return{name:e,primKey:t,indexes:n,mappedClass:null,idxByName:(r=function(e){return[e.name,e]},n.reduce(function(e,t,n){return(n=r(t,n))&&(e[n[0]]=n[1]),e},{}))};var r}var Yt=function(e){try{return e.only([[]]),Yt=function(){return[[]]},[[]]}catch(t){return Yt=function(){return Je},Je}};function Vt(e){return null==e?function(){}:"string"==typeof e?1===(t=e).split(".").length?function(e){return e[t]}:function(e){return x(e,t)}:function(t){return x(t,e)};var t}function Qt(e){return[].slice.call(e)}var Gt=0;function Xt(e){return null==e?":id":"string"==typeof e?e:"[".concat(e.join("+"),"]")}function Jt(e,t,n){function r(e){if(3===e.type)return null;if(4===e.type)throw new Error("Cannot convert never type to IDBKeyRange");var n=e.lower,r=e.upper,a=e.lowerOpen;return e=e.upperOpen,void 0===n?void 0===r?null:t.upperBound(r,!!e):void 0===r?t.lowerBound(n,!!a):t.bound(n,r,!!a,!!e)}function a(e){var t,n=e.name;return{name:n,schema:e,mutate:function(e){var t=e.trans,a=e.type,i=e.keys,o=e.values,s=e.range;return new Promise(function(e,u){e=Me(e);var l=t.objectStore(n),c=null==l.keyPath,h="put"===a||"add"===a;if(!h&&"delete"!==a&&"deleteRange"!==a)throw new Error("Invalid operation type: "+a);var d,f=(i||o||{length:1}).length;if(i&&o&&i.length!==o.length)throw new Error("Given keys array must have same length as given values array.");if(0===f)return e({numFailures:0,failures:{},results:[],lastResult:void 0});function m(e){++g,Dt(e)}var p=[],y=[],g=0;if("deleteRange"===a){if(4===s.type)return e({numFailures:g,failures:y,results:[],lastResult:void 0});3===s.type?p.push(d=l.clear()):p.push(d=l.delete(r(s)))}else{var b=(c=h?c?[o,i]:[o,null]:[i,null])[0],v=c[1];if(h)for(var x=0;x<f;++x)p.push(d=v&&void 0!==v[x]?l[a](b[x],v[x]):l[a](b[x])),d.onerror=m;else for(x=0;x<f;++x)p.push(d=l[a](b[x])),d.onerror=m}function w(t){t=t.target.result,p.forEach(function(e,t){return null!=e.error&&(y[t]=e.error)}),e({numFailures:g,failures:y,results:"delete"===a?i:p.map(function(e){return e.result}),lastResult:t})}d.onerror=function(e){m(e),w(e)},d.onsuccess=w})},getMany:function(e){var t=e.trans,r=e.keys;return new Promise(function(e,a){e=Me(e);for(var i,o=t.objectStore(n),s=r.length,u=new Array(s),l=0,c=0,h=function(t){t=t.target,u[t._pos]=t.result,++c===l&&e(u)},d=Ft(a),f=0;f<s;++f)null!=r[f]&&((i=o.get(r[f]))._pos=f,i.onsuccess=h,i.onerror=d,++l);0===l&&e(u)})},get:function(e){var t=e.trans,r=e.key;return new Promise(function(e,a){e=Me(e);var i=t.objectStore(n).get(r);i.onsuccess=function(t){return e(t.target.result)},i.onerror=Ft(a)})},query:(t=l,function(e){return new Promise(function(a,i){a=Me(a);var o,s,u,l=e.trans,c=e.values,h=e.limit,d=e.query,f=h===1/0?void 0:h,m=d.index;if(d=d.range,l=l.objectStore(n),m=m.isPrimaryKey?l:l.index(m.name),d=r(d),0===h)return a({result:[]});t?((f=c?m.getAll(d,f):m.getAllKeys(d,f)).onsuccess=function(e){return a({result:e.target.result})},f.onerror=Ft(i)):(o=0,s=!c&&"openKeyCursor"in m?m.openKeyCursor(d):m.openCursor(d),u=[],s.onsuccess=function(e){var t=s.result;return t?(u.push(c?t.value:t.primaryKey),++o===h?a({result:u}):void t.continue()):a({result:u})},s.onerror=Ft(i))})}),openCursor:function(e){var t=e.trans,a=e.values,i=e.query,o=e.reverse,s=e.unique;return new Promise(function(e,u){e=Me(e);var l=i.index,c=i.range,h=t.objectStore(n),d=(h=l.isPrimaryKey?h:h.index(l.name),l=o?s?"prevunique":"prev":s?"nextunique":"next",!a&&"openKeyCursor"in h?h.openKeyCursor(r(c),l):h.openCursor(r(c),l));d.onerror=Ft(u),d.onsuccess=Me(function(n){var r,a,i,o,s=d.result;s?(s.___id=++Gt,s.done=!1,r=s.continue.bind(s),a=(a=s.continuePrimaryKey)&&a.bind(s),i=s.advance.bind(s),o=function(){throw new Error("Cursor not stopped")},s.trans=t,s.stop=s.continue=s.continuePrimaryKey=s.advance=function(){throw new Error("Cursor not started")},s.fail=Me(u),s.next=function(){var e=this,t=1;return this.start(function(){return t--?e.continue():e.stop()}).then(function(){return e})},s.start=function(e){function t(){if(d.result)try{e()}catch(t){s.fail(t)}else s.done=!0,s.start=function(){throw new Error("Cursor behind last entry")},s.stop()}var n=new Promise(function(e,t){e=Me(e),d.onerror=Ft(t),s.fail=t,s.stop=function(t){s.stop=s.continue=s.continuePrimaryKey=s.advance=o,e(t)}});return d.onsuccess=Me(function(e){d.onsuccess=t,t()}),s.continue=r,s.continuePrimaryKey=a,s.advance=i,t(),n},e(s)):e(null)},u)})},count:function(e){var t=e.query,a=e.trans,i=t.index,o=t.range;return new Promise(function(e,t){var s=a.objectStore(n),u=i.isPrimaryKey?s:s.index(i.name);(u=(s=r(o))?u.count(s):u.count()).onsuccess=Me(function(t){return e(t.target.result)}),u.onerror=Ft(t)})}}}n=(s=n,u=Qt((o=e).objectStoreNames),c={schema:{name:o.name,tables:u.map(function(e){return s.objectStore(e)}).map(function(e){var t=e.keyPath,n=e.autoIncrement,r=i(t),a={};return n={name:e.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:null==t,compound:r,keyPath:t,autoIncrement:n,unique:!0,extractKey:Vt(t)},indexes:Qt(e.indexNames).map(function(t){return e.index(t)}).map(function(e){var t=e.name,n=e.unique,r=e.multiEntry;return e=e.keyPath,r={name:t,compound:i(e),keyPath:e,unique:n,multiEntry:r,extractKey:Vt(e)},a[Xt(e)]=r}),getIndexByKeyPath:function(e){return a[Xt(e)]}},a[":id"]=n.primaryKey,null!=t&&(a[Xt(t)]=n.primaryKey),n})},hasGetAll:0<u.length&&"getAll"in s.objectStore(u[0])&&!("undefined"!=typeof navigator&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}).schema;var o,s,u,l=c.hasGetAll,c=n.tables.map(a),h={};return c.forEach(function(e){return h[e.name]=e}),{stack:"dbcore",transaction:e.transaction.bind(e),table:function(e){if(!h[e])throw new Error("Table '".concat(e,"' not found"));return h[e]},MIN_KEY:-1/0,MAX_KEY:Yt(t),schema:n}}function Zt(e,n,r,a){var i=r.IDBKeyRange;return r.indexedDB,{dbcore:(a=Jt(n,i,a),e.dbcore.reduce(function(e,n){return n=n.create,t(t({},e),n(e))},a))}}function en(e,t){var n=t.db;t=Zt(e._middlewares,n,e._deps,t),e.core=t.dbcore,e.tables.forEach(function(t){var n=t.name;e.core.schema.tables.some(function(e){return e.name===n})&&(t.core=e.core.table(n),e[n]instanceof e.Table&&(e[n].core=t.core))})}function tn(e,t,n,r){n.forEach(function(n){var a=r[n];t.forEach(function(t){var r=function e(t,n){return m(t,n)||(t=s(t))&&e(t,n)}(t,n);(!r||"value"in r&&void 0===r.value)&&(t===e.Transaction.prototype||t instanceof e.Transaction?d(t,n,{get:function(){return this.table(n)},set:function(e){h(this,n,{value:e,writable:!0,configurable:!0,enumerable:!0})}}):t[n]=new e.Table(n,a))})})}function nn(e,t){t.forEach(function(t){for(var n in t)t[n]instanceof e.Table&&delete t[n]})}function rn(e,t){return e._cfg.version-t._cfg.version}function an(e,t,n,r){var i=e._dbSchema;n.objectStoreNames.contains("$meta")&&!i.$meta&&(i.$meta=Ht("$meta",fn("")[0],[]),e._storeNames.push("$meta"));var o=e._createTransaction("readwrite",e._storeNames,i);o.create(n),o._completion.catch(r);var s=o._reject.bind(o),u=be.transless||be;ze(function(){return be.trans=o,be.transless=u,0!==t?(en(e,n),l=t,((r=o).storeNames.includes("$meta")?r.table("$meta").get("version").then(function(e){return null!=e?e:l}):ke.resolve(l)).then(function(t){return i=t,s=o,u=n,l=[],t=(r=e)._versions,c=r._dbSchema=hn(0,r.idbdb,u),0!==(t=t.filter(function(e){return e._cfg.version>=i})).length?(t.forEach(function(e){l.push(function(){var t=c,n=e._cfg.dbschema;dn(r,t,u),dn(r,n,u),c=r._dbSchema=n;var o=sn(t,n);o.add.forEach(function(e){un(u,e[0],e[1].primKey,e[1].indexes)}),o.change.forEach(function(e){if(e.recreate)throw new W.Upgrade("Not yet support for changing primary key");var t=u.objectStore(e.name);e.add.forEach(function(e){return cn(t,e)}),e.change.forEach(function(e){t.deleteIndex(e.name),cn(t,e)}),e.del.forEach(function(e){return t.deleteIndex(e)})});var l=e._cfg.contentUpgrade;if(l&&e._cfg.version>i){en(r,u),s._memoizedTables={};var h=k(n);o.del.forEach(function(e){h[e]=t[e]}),nn(r,[r.Transaction.prototype]),tn(r,[r.Transaction.prototype],a(h),h),s.schema=h;var d,f=R(l);return f&&Ue(),o=ke.follow(function(){var e;(d=l(s))&&f&&(e=$e.bind(null,null),d.then(e,e))}),d&&"function"==typeof d.then?ke.resolve(d):o.then(function(){return d})}}),l.push(function(t){var n,a,i=e._cfg.dbschema;n=i,a=t,[].slice.call(a.db.objectStoreNames).forEach(function(e){return null==n[e]&&a.db.deleteObjectStore(e)}),nn(r,[r.Transaction.prototype]),tn(r,[r.Transaction.prototype],r._storeNames,r._dbSchema),s.schema=r._dbSchema}),l.push(function(t){r.idbdb.objectStoreNames.contains("$meta")&&(Math.ceil(r.idbdb.version/10)===e._cfg.version?(r.idbdb.deleteObjectStore("$meta"),delete r._dbSchema.$meta,r._storeNames=r._storeNames.filter(function(e){return"$meta"!==e})):t.objectStore("$meta").put(e._cfg.version,"version"))})}),function e(){return l.length?ke.resolve(l.shift()(s.idbtrans)).then(e):ke.resolve()}().then(function(){ln(c,u)})):ke.resolve();var r,i,s,u,l,c}).catch(s)):(a(i).forEach(function(e){un(n,e,i[e].primKey,i[e].indexes)}),en(e,n),void ke.follow(function(){return e.on.populate.fire(o)}).catch(s));var r,l})}function on(e,t){ln(e._dbSchema,t),t.db.version%10!=0||t.objectStoreNames.contains("$meta")||t.db.createObjectStore("$meta").add(Math.ceil(t.db.version/10-1),"version");var n=hn(0,e.idbdb,t);dn(e,e._dbSchema,t);for(var r=0,a=sn(n,e._dbSchema).change;r<a.length;r++){var i=function(e){if(e.change.length||e.recreate)return{value:void 0};var n=t.objectStore(e.name);e.add.forEach(function(e){cn(n,e)})}(a[r]);if("object"==typeof i)return i.value}}function sn(e,t){var n,r={del:[],add:[],change:[]};for(n in e)t[n]||r.del.push(n);for(n in t){var a=e[n],i=t[n];if(a){var o={name:n,def:i,recreate:!1,del:[],add:[],change:[]};if(""+(a.primKey.keyPath||"")!=""+(i.primKey.keyPath||"")||a.primKey.auto!==i.primKey.auto)o.recreate=!0,r.change.push(o);else{var s=a.idxByName,u=i.idxByName,l=void 0;for(l in s)u[l]||o.del.push(l);for(l in u){var c=s[l],h=u[l];c?c.src!==h.src&&o.change.push(h):o.add.push(h)}(0<o.del.length||0<o.add.length||0<o.change.length)&&r.change.push(o)}}else r.add.push([n,i])}return r}function un(e,t,n,r){var a=e.db.createObjectStore(t,n.keyPath?{keyPath:n.keyPath,autoIncrement:n.auto}:{autoIncrement:n.auto});return r.forEach(function(e){return cn(a,e)}),a}function ln(e,t){a(e).forEach(function(n){t.db.objectStoreNames.contains(n)||un(t,n,e[n].primKey,e[n].indexes)})}function cn(e,t){e.createIndex(t.name,t.keyPath,{unique:t.unique,multiEntry:t.multi})}function hn(e,t,n){var r={};return y(t.objectStoreNames,0).forEach(function(e){for(var t=n.objectStore(e),a=Lt(Wt(s=t.keyPath),s||"",!0,!1,!!t.autoIncrement,s&&"string"!=typeof s,!0),i=[],o=0;o<t.indexNames.length;++o){var s=(u=t.index(t.indexNames[o])).keyPath,u=Lt(u.name,s,!!u.unique,!!u.multiEntry,!1,s&&"string"!=typeof s,!1);i.push(u)}r[e]=Ht(e,a,i)}),r}function dn(e,t,n){for(var a=n.db.objectStoreNames,i=0;i<a.length;++i){var o=a[i],s=n.objectStore(o);e._hasGetAll="getAll"in s;for(var u=0;u<s.indexNames.length;++u){var l=s.indexNames[u],c=s.index(l).keyPath,h="string"==typeof c?c:"["+y(c).join("+")+"]";!t[o]||(c=t[o].idxByName[h])&&(c.name=l,delete t[o].idxByName[h],t[o].idxByName[l]=c)}}"undefined"!=typeof navigator&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&r.WorkerGlobalScope&&r instanceof r.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(e._hasGetAll=!1)}function fn(e){return e.split(",").map(function(e,t){var n=(e=e.trim()).replace(/([&*]|\+\+)/g,""),r=/^\[/.test(n)?n.match(/^\[(.*)\]$/)[1].split("+"):n;return Lt(n,r||null,/\&/.test(e),/\*/.test(e),/\+\+/.test(e),i(r),0===t)})}var mn=(pn.prototype._parseStoresSpec=function(e,t){a(e).forEach(function(n){if(null!==e[n]){var r=fn(e[n]),a=r.shift();if(a.unique=!0,a.multi)throw new W.Schema("Primary key cannot be multi-valued");r.forEach(function(e){if(e.auto)throw new W.Schema("Only primary key can be marked as autoIncrement (++)");if(!e.keyPath)throw new W.Schema("Index must have a name and cannot be an empty string")}),t[n]=Ht(n,a,r)}})},pn.prototype.stores=function(e){var t=this.db;this._cfg.storesSource=this._cfg.storesSource?o(this._cfg.storesSource,e):e,e=t._versions;var n={},r={};return e.forEach(function(e){o(n,e._cfg.storesSource),r=e._cfg.dbschema={},e._parseStoresSpec(n,r)}),t._dbSchema=r,nn(t,[t._allTables,t,t.Transaction.prototype]),tn(t,[t._allTables,t,t.Transaction.prototype,this._cfg.tables],a(r),r),t._storeNames=a(r),this},pn.prototype.upgrade=function(e){return this._cfg.contentUpgrade=ne(this._cfg.contentUpgrade||V,e),this},pn);function pn(){}function yn(e,t){var n=e._dbNamesDB;return n||(n=e._dbNamesDB=new tr(nt,{addons:[],indexedDB:e,IDBKeyRange:t})).version(1).stores({dbnames:"name"}),n.table("dbnames")}function gn(e){return e&&"function"==typeof e.databases}function bn(e){return ze(function(){return be.letThrough=!0,e()})}function vn(e){return!("from"in e)}var xn=function(e,t){if(!this){var n=new xn;return e&&"d"in e&&o(n,e),n}o(this,arguments.length?{d:1,from:e,to:1<arguments.length?t:e}:{d:0})};function wn(e,t,n){var r=lt(t,n);if(!isNaN(r)){if(0<r)throw RangeError();if(vn(e))return o(e,{from:t,to:n,d:1});var a=e.l;if(r=e.r,lt(n,e.from)<0)return a?wn(a,t,n):e.l={from:t,to:n,d:1,l:null,r:null},An(e);if(0<lt(t,e.to))return r?wn(r,t,n):e.r={from:t,to:n,d:1,l:null,r:null},An(e);lt(t,e.from)<0&&(e.from=t,e.l=null,e.d=r?r.d+1:1),0<lt(n,e.to)&&(e.to=n,e.r=null,e.d=e.l?e.l.d+1:1),n=!e.r,a&&!e.l&&kn(e,a),r&&n&&kn(e,r)}}function kn(e,t){vn(t)||function e(t,n){var r=n.from,a=n.to,i=n.l;n=n.r,wn(t,r,a),i&&e(t,i),n&&e(t,n)}(e,t)}function jn(e,t){var n=_n(t),r=n.next();if(r.done)return!1;for(var a=r.value,i=_n(e),o=i.next(a.from),s=o.value;!r.done&&!o.done;){if(lt(s.from,a.to)<=0&&0<=lt(s.to,a.from))return!0;lt(a.from,s.from)<0?a=(r=n.next(s.from)).value:s=(o=i.next(a.from)).value}return!1}function _n(e){var t=vn(e)?null:{s:0,n:e};return{next:function(e){for(var n=0<arguments.length;t;)switch(t.s){case 0:if(t.s=1,n)for(;t.n.l&&lt(e,t.n.from)<0;)t={up:t,n:t.n.l,s:1};else for(;t.n.l;)t={up:t,n:t.n.l,s:1};case 1:if(t.s=2,!n||lt(e,t.n.to)<=0)return{value:t.n,done:!1};case 2:if(t.n.r){t.s=3,t={up:t,n:t.n.r,s:0};continue}case 3:t=t.up}return{done:!0}}}}function An(e){var n,r,a=((null===(n=e.r)||void 0===n?void 0:n.d)||0)-((null===(r=e.l)||void 0===r?void 0:r.d)||0),i=1<a?"r":a<-1?"l":"";i&&(n="r"==i?"l":"r",r=t({},e),a=e[i],e.from=a.from,e.to=a.to,e[i]=a[i],r[i]=a[n],(e[n]=r).d=Sn(r)),e.d=Sn(e)}function Sn(e){var t=e.r;return e=e.l,(t?e?Math.max(t.d,e.d):t.d:e?e.d:0)+1}function Cn(e,t){return a(t).forEach(function(n){e[n]?kn(e[n],t[n]):e[n]=function e(t){var n,r,a={};for(n in t)l(t,n)&&(r=t[n],a[n]=!r||"object"!=typeof r||S.has(r.constructor)?r:e(r));return a}(t[n])}),e}function In(e,t){return e.all||t.all||Object.keys(e).some(function(n){return t[n]&&jn(t[n],e[n])})}c(xn.prototype,((F={add:function(e){return kn(this,e),this},addKey:function(e){return wn(this,e,e),this},addKeys:function(e){var t=this;return e.forEach(function(e){return wn(t,e,e)}),this},hasKey:function(e){var t=_n(this).next(e).value;return t&&lt(t.from,e)<=0&&0<=lt(t.to,e)}})[E]=function(){return _n(this)},F));var Tn={},Pn={},En=!1;function Nn(e){Cn(Pn,e),En||(En=!0,setTimeout(function(){En=!1,On(Pn,!(Pn={}))},0))}function On(e,t){void 0===t&&(t=!1);var n=new Set;if(e.all)for(var r=0,a=Object.values(Tn);r<a.length;r++)Mn(o=a[r],e,n,t);else for(var i in e){var o,s=/^idb\:\/\/(.*)\/(.*)\//.exec(i);s&&(i=s[1],s=s[2],(o=Tn["idb://".concat(i,"/").concat(s)])&&Mn(o,e,n,t))}n.forEach(function(e){return e()})}function Mn(e,t,n,r){for(var a=[],i=0,o=Object.entries(e.queries.query);i<o.length;i++){for(var s=o[i],u=s[0],l=[],c=0,h=s[1];c<h.length;c++){var d=h[c];In(t,d.obsSet)?d.subscribers.forEach(function(e){return n.add(e)}):r&&l.push(d)}r&&a.push([u,l])}if(r)for(var f=0,m=a;f<m.length;f++){var p=m[f];u=p[0],l=p[1],e.queries.query[u]=l}}function Kn(e){var t=e._state,n=e._deps.indexedDB;if(t.isBeingOpened||e.idbdb)return t.dbReadyPromise.then(function(){return t.dbOpenError?Xe(t.dbOpenError):e});t.isBeingOpened=!0,t.dbOpenError=null,t.openComplete=!1;var r=t.openCanceller,i=Math.round(10*e.verno),o=!1;function s(){if(t.openCanceller!==r)throw new W.DatabaseClosed("db.open() was cancelled")}function u(){return new ke(function(r,l){if(s(),!n)throw new W.MissingAPI;var c=e.name,f=t.autoSchema||!i?n.open(c):n.open(c,i);if(!f)throw new W.MissingAPI;f.onerror=Ft(l),f.onblocked=Me(e._fireOnBlocked),f.onupgradeneeded=Me(function(r){var a;h=f.transaction,t.autoSchema&&!e._options.allowEmptyDB?(f.onerror=Dt,h.abort(),f.result.close(),(a=n.deleteDatabase(c)).onsuccess=a.onerror=Me(function(){l(new W.NoSuchDatabase("Database ".concat(c," doesnt exist")))})):(h.onerror=Ft(l),r=r.oldVersion>Math.pow(2,62)?0:r.oldVersion,d=r<1,e.idbdb=f.result,o&&on(e,h),an(e,r/10,h,l))},l),f.onsuccess=Me(function(){h=null;var n,s,l,m,p,g=e.idbdb=f.result,b=y(g.objectStoreNames);if(0<b.length)try{var v=g.transaction(1===(m=b).length?m[0]:m,"readonly");if(t.autoSchema)s=g,l=v,(n=e).verno=s.version/10,l=n._dbSchema=hn(0,s,l),n._storeNames=y(s.objectStoreNames,0),tn(n,[n._allTables],a(l),l);else if(dn(e,e._dbSchema,v),((p=sn(hn(0,(p=e).idbdb,v),p._dbSchema)).add.length||p.change.some(function(e){return e.add.length||e.change.length}))&&!o)return g.close(),i=g.version+1,o=!0,r(u());en(e,v)}catch(x){}tt.push(e),g.onversionchange=Me(function(n){t.vcFired=!0,e.on("versionchange").fire(n)}),g.onclose=Me(function(t){e.on("close").fire(t)}),d&&(p=e._deps,v=c,g=p.indexedDB,p=p.IDBKeyRange,gn(g)||v===nt||yn(g,p).put({name:v}).catch(V)),r()},l)}).catch(function(e){switch(null==e?void 0:e.name){case"UnknownError":if(0<t.PR1398_maxLoop)return t.PR1398_maxLoop--,u();break;case"VersionError":if(0<i)return i=0,u()}return ke.reject(e)})}var l,c=t.dbReadyResolve,h=null,d=!1;return ke.race([r,("undefined"==typeof navigator?ke.resolve():!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(e){function t(){return indexedDB.databases().finally(e)}l=setInterval(t,100),t()}).finally(function(){return clearInterval(l)}):Promise.resolve()).then(u)]).then(function(){return s(),t.onReadyBeingFired=[],ke.resolve(bn(function(){return e.on.ready.fire(e.vip)})).then(function n(){if(0<t.onReadyBeingFired.length){var r=t.onReadyBeingFired.reduce(ne,V);return t.onReadyBeingFired=[],ke.resolve(bn(function(){return r(e.vip)})).then(n)}})}).finally(function(){t.openCanceller===r&&(t.onReadyBeingFired=null,t.isBeingOpened=!1)}).catch(function(n){t.dbOpenError=n;try{h&&h.abort()}catch(a){}return r===t.openCanceller&&e._close(),Xe(n)}).finally(function(){t.openComplete=!0,c()}).then(function(){var t;return d&&(t={},e.tables.forEach(function(n){n.schema.indexes.forEach(function(r){r.name&&(t["idb://".concat(e.name,"/").concat(n.name,"/").concat(r.name)]=new xn(-1/0,[[[]]]))}),t["idb://".concat(e.name,"/").concat(n.name,"/")]=t["idb://".concat(e.name,"/").concat(n.name,"/:dels")]=new xn(-1/0,[[[]]])}),zt(Bt).fire(t),On(t,!0)),e})}function Rn(e){function t(t){return e.next(t)}var n=a(t),r=a(function(t){return e.throw(t)});function a(e){return function(t){var a=e(t);return t=a.value,a.done?t:t&&"function"==typeof t.then?t.then(n,r):i(t)?Promise.all(t).then(n,r):n(t)}}return a(t)()}function Fn(e,t,n){for(var r=i(e)?e.slice():[e],a=0;a<n;++a)r.push(t);return r}var Dn={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(e){return t(t({},e),{table:function(n){var r=e.table(n),a=r.schema,i={},o=[];function s(e,n,r){var a=Xt(e),u=i[a]=i[a]||[],l=null==e?0:"string"==typeof e?1:e.length,c=0<n;return c=t(t({},r),{name:c?"".concat(a,"(virtual-from:").concat(r.name,")"):r.name,lowLevelIndex:r,isVirtual:c,keyTail:n,keyLength:l,extractKey:Vt(e),unique:!c&&r.unique}),u.push(c),c.isPrimaryKey||o.push(c),1<l&&s(2===l?e[0]:e.slice(0,l-1),n+1,r),u.sort(function(e,t){return e.keyTail-t.keyTail}),c}n=s(a.primaryKey.keyPath,0,a.primaryKey),i[":id"]=[n];for(var u=0,l=a.indexes;u<l.length;u++){var c=l[u];s(c.keyPath,0,c)}function h(n){var r,a=n.query.index;return a.isVirtual?t(t({},n),{query:{index:a.lowLevelIndex,range:(r=n.query.range,a=a.keyTail,{type:1===r.type?2:r.type,lower:Fn(r.lower,r.lowerOpen?e.MAX_KEY:e.MIN_KEY,a),lowerOpen:!0,upper:Fn(r.upper,r.upperOpen?e.MIN_KEY:e.MAX_KEY,a),upperOpen:!0})}}):n}return t(t({},r),{schema:t(t({},a),{primaryKey:n,indexes:o,getIndexByKeyPath:function(e){return(e=i[Xt(e)])&&e[0]}}),count:function(e){return r.count(h(e))},query:function(e){return r.query(h(e))},openCursor:function(t){var n=t.query.index,a=n.keyTail,i=n.isVirtual,o=n.keyLength;return i?r.openCursor(h(t)).then(function(e){return e&&s(e)}):r.openCursor(t);function s(n){return Object.create(n,{continue:{value:function(r){null!=r?n.continue(Fn(r,t.reverse?e.MAX_KEY:e.MIN_KEY,a)):t.unique?n.continue(n.key.slice(0,o).concat(t.reverse?e.MIN_KEY:e.MAX_KEY,a)):n.continue()}},continuePrimaryKey:{value:function(t,r){n.continuePrimaryKey(Fn(t,e.MAX_KEY,a),r)}},primaryKey:{get:function(){return n.primaryKey}},key:{get:function(){var e=n.key;return 1===o?e[0]:e.slice(0,o)}},value:{get:function(){return n.value}}})}}})}})}};function Bn(e,t,n,r){return n=n||{},r=r||"",a(e).forEach(function(a){var i,o,s;l(t,a)?(i=e[a],o=t[a],"object"==typeof i&&"object"==typeof o&&i&&o?(s=P(i))!==P(o)?n[r+a]=t[a]:"Object"===s?Bn(i,o,n,r+a+"."):i!==o&&(n[r+a]=t[a]):i!==o&&(n[r+a]=t[a])):n[r+a]=void 0}),a(t).forEach(function(a){l(e,a)||(n[r+a]=t[a])}),n}function qn(e,t){return"delete"===t.type?t.keys:t.keys||t.values.map(e.extractKey)}var zn={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(e){return t(t({},e),{table:function(r){var a=e.table(r),i=a.schema.primaryKey;return t(t({},a),{mutate:function(e){var o=be.trans,s=o.table(r).hook,u=s.deleting,c=s.creating,h=s.updating;switch(e.type){case"add":if(c.fire===V)break;return o._promise("readwrite",function(){return d(e)},!0);case"put":if(c.fire===V&&h.fire===V)break;return o._promise("readwrite",function(){return d(e)},!0);case"delete":if(u.fire===V)break;return o._promise("readwrite",function(){return d(e)},!0);case"deleteRange":if(u.fire===V)break;return o._promise("readwrite",function(){return function e(n,r,o){return a.query({trans:n,values:!1,query:{index:i,range:r},limit:o}).then(function(a){var i=a.result;return d({type:"delete",keys:i,trans:n}).then(function(a){return 0<a.numFailures?Promise.reject(a.failures[0]):i.length<o?{failures:[],numFailures:0,lastResult:void 0}:e(n,t(t({},r),{lower:i[i.length-1],lowerOpen:!0}),o)})})}(e.trans,e.range,1e4)},!0)}return a.mutate(e);function d(e){var r,o,s,d=be.trans,f=e.keys||qn(i,e);if(!f)throw new Error("Keys missing");return"delete"!==(e="add"===e.type||"put"===e.type?t(t({},e),{keys:f}):t({},e)).type&&(e.values=n([],e.values)),e.keys&&(e.keys=n([],e.keys)),r=a,s=f,("add"===(o=e).type?Promise.resolve([]):r.getMany({trans:o.trans,keys:s,cache:"immutable"})).then(function(t){var n=f.map(function(n,r){var a,o,s,f=t[r],m={onerror:null,onsuccess:null};return"delete"===e.type?u.fire.call(m,n,f,d):"add"===e.type||void 0===f?(a=c.fire.call(m,n,e.values[r],d),null==n&&null!=a&&(e.keys[r]=n=a,i.outbound||w(e.values[r],i.keyPath,n))):(a=Bn(f,e.values[r]),(o=h.fire.call(m,a,n,f,d))&&(s=e.values[r],Object.keys(o).forEach(function(e){l(s,e)?s[e]=o[e]:w(s,e,o[e])}))),m});return a.mutate(e).then(function(r){for(var a=r.failures,i=r.results,o=r.numFailures,s=(r=r.lastResult,0);s<f.length;++s){var u=(i||f)[s],l=n[s];null==u?l.onerror&&l.onerror(a[s]):l.onsuccess&&l.onsuccess("put"===e.type&&t[s]?e.values[s]:u)}return{failures:a,results:i,numFailures:o,lastResult:r}}).catch(function(e){return n.forEach(function(t){return t.onerror&&t.onerror(e)}),Promise.reject(e)})})}}})}})}};function Un(e,t,n){try{if(!t)return null;if(t.keys.length<e.length)return null;for(var r=[],a=0,i=0;a<t.keys.length&&i<e.length;++a)0===lt(t.keys[a],e[i])&&(r.push(n?I(t.values[a]):t.values[a]),++i);return r.length===e.length?r:null}catch(o){return null}}var $n={stack:"dbcore",level:-1,create:function(e){return{table:function(n){var r=e.table(n);return t(t({},r),{getMany:function(e){if(!e.cache)return r.getMany(e);var t=Un(e.keys,e.trans._cache,"clone"===e.cache);return t?ke.resolve(t):r.getMany(e).then(function(t){return e.trans._cache={keys:e.keys,values:"clone"===e.cache?I(t):t},t})},mutate:function(e){return"add"!==e.type&&(e.trans._cache=null),r.mutate(e)}})}}}};function Ln(e,t){return"readonly"===e.trans.mode&&!!e.subscr&&!e.trans.explicit&&"disabled"!==e.trans.db._options.cache&&!t.schema.primaryKey.outbound}function Wn(e,t){switch(e){case"query":return t.values&&!t.unique;case"get":case"getMany":case"count":case"openCursor":return!1}}var Hn={stack:"dbcore",level:0,name:"Observability",create:function(e){var n=e.schema.name,r=new xn(e.MIN_KEY,e.MAX_KEY);return t(t({},e),{transaction:function(t,n,r){if(be.subscr&&"readonly"!==n)throw new W.ReadOnly("Readwrite transaction in liveQuery context. Querier source: ".concat(be.querier));return e.transaction(t,n,r)},table:function(o){var s=e.table(o),u=s.schema,l=u.primaryKey,c=u.indexes,h=l.extractKey,d=l.outbound,f=l.autoIncrement&&c.filter(function(e){return e.compound&&e.keyPath.includes(l.keyPath)}),m=t(t({},s),{mutate:function(t){function a(e){return e="idb://".concat(n,"/").concat(o,"/").concat(e),p[e]||(p[e]=new xn)}var c,h,d,m=t.trans,p=t.mutatedParts||(t.mutatedParts={}),y=a(""),g=a(":dels"),b=t.type,v=(w="deleteRange"===t.type?[t.range]:"delete"===t.type?[t.keys]:t.values.length<50?[qn(l,t).filter(function(e){return e}),t.values]:[])[0],x=w[1],w=t.trans._cache;return i(v)?(y.addKeys(v),(w="delete"===b||v.length===x.length?Un(v,w):null)||g.addKeys(v),(w||x)&&(c=a,h=w,d=x,u.indexes.forEach(function(e){var t=c(e.name||"");function n(t){return null!=t?e.extractKey(t):null}function r(n){return e.multiEntry&&i(n)?n.forEach(function(e){return t.addKey(e)}):t.addKey(n)}(h||d).forEach(function(e,t){var a=h&&n(h[t]);0!==lt(a,t=d&&n(d[t]))&&(null!=a&&r(a),null!=t&&r(t))})}))):v?(x={from:null!==(x=v.lower)&&void 0!==x?x:e.MIN_KEY,to:null!==(x=v.upper)&&void 0!==x?x:e.MAX_KEY},g.add(x),y.add(x)):(y.add(r),g.add(r),u.indexes.forEach(function(e){return a(e.name).add(r)})),s.mutate(t).then(function(e){return!v||"add"!==t.type&&"put"!==t.type||(y.addKeys(e.results),f&&f.forEach(function(n){for(var r=t.values.map(function(e){return n.extractKey(e)}),i=n.keyPath.findIndex(function(e){return e===l.keyPath}),o=0,s=e.results.length;o<s;++o)r[o][i]=e.results[o];a(n.name).addKeys(r)})),m.mutatedParts=Cn(m.mutatedParts||{},p),e})}}),p={get:function(e){return[l,new xn(e.key)]},getMany:function(e){return[l,(new xn).addKeys(e.keys)]},count:c=function(t){t=(n=t.query).index;var n=n.range;return[t,new xn(null!==(t=n.lower)&&void 0!==t?t:e.MIN_KEY,null!==(n=n.upper)&&void 0!==n?n:e.MAX_KEY)]},query:c,openCursor:c};return a(p).forEach(function(e){m[e]=function(a){var i=!!(m=be.subscr),u=Ln(be,s)&&Wn(e,a)?a.obsSet={}:m;if(i){var l=function(e){return e="idb://".concat(n,"/").concat(o,"/").concat(e),u[e]||(u[e]=new xn)},c=l(""),f=l(":dels"),m=(i=(m=p[e](a))[0],m[1]);if(("query"===e&&i.isPrimaryKey&&!a.values?f:l(i.name||"")).add(m),!i.isPrimaryKey){if("count"!==e){var y="query"===e&&d&&a.values&&s.query(t(t({},a),{values:!1}));return s[e].apply(this,arguments).then(function(t){if("query"===e){if(d&&a.values)return y.then(function(e){return e=e.result,c.addKeys(e),t});var n=a.values?t.result.map(h):t.result;(a.values?c:f).addKeys(n)}else if("openCursor"===e){var r=t,i=a.values;return r&&Object.create(r,{key:{get:function(){return f.addKey(r.primaryKey),r.key}},primaryKey:{get:function(){var e=r.primaryKey;return f.addKey(e),e}},value:{get:function(){return i&&c.addKey(r.primaryKey),r.value}}})}return t})}f.add(r)}}return s[e].apply(this,arguments)}}),m}})}};function Yn(e,n,r){if(0===r.numFailures)return n;if("deleteRange"===n.type)return null;var a=n.keys?n.keys.length:"values"in n&&n.values?n.values.length:1;return r.numFailures===a?null:(n=t({},n),i(n.keys)&&(n.keys=n.keys.filter(function(e,t){return!(t in r.failures)})),"values"in n&&i(n.values)&&(n.values=n.values.filter(function(e,t){return!(t in r.failures)})),n)}function Vn(e,t){return n=e,(void 0===(r=t).lower||(r.lowerOpen?0<lt(n,r.lower):0<=lt(n,r.lower)))&&(void 0===t.upper||(t.upperOpen?lt(e,t.upper)<0:lt(e,t.upper)<=0));var n,r}function Qn(e,t,n,r,a,o){if(!n||0===n.length)return e;var s=t.query.index,u=s.multiEntry,l=t.query.range,c=r.schema.primaryKey.extractKey,h=s.extractKey,d=(s.lowLevelIndex||s).extractKey;return(n=n.reduce(function(e,n){var r=e,a=[];if("add"===n.type||"put"===n.type)for(var o=new xn,s=n.values.length-1;0<=s;--s){var d,f=n.values[s],m=c(f);o.hasKey(m)||(d=h(f),(u&&i(d)?d.some(function(e){return Vn(e,l)}):Vn(d,l))&&(o.addKey(m),a.push(f)))}switch(n.type){case"add":var p=(new xn).addKeys(t.values?e.map(function(e){return c(e)}):e);r=e.concat(t.values?a.filter(function(e){return e=c(e),!p.hasKey(e)&&(p.addKey(e),!0)}):a.map(function(e){return c(e)}).filter(function(e){return!p.hasKey(e)&&(p.addKey(e),!0)}));break;case"put":var y=(new xn).addKeys(n.values.map(function(e){return c(e)}));r=e.filter(function(e){return!y.hasKey(t.values?c(e):e)}).concat(t.values?a:a.map(function(e){return c(e)}));break;case"delete":var g=(new xn).addKeys(n.keys);r=e.filter(function(e){return!g.hasKey(t.values?c(e):e)});break;case"deleteRange":var b=n.range;r=e.filter(function(e){return!Vn(c(e),b)})}return r},e))===e?e:(n.sort(function(e,t){return lt(d(e),d(t))||lt(c(e),c(t))}),t.limit&&t.limit<1/0&&(n.length>t.limit?n.length=t.limit:e.length===t.limit&&n.length<t.limit&&(a.dirty=!0)),o?Object.freeze(n):n)}function Gn(e,t){return 0===lt(e.lower,t.lower)&&0===lt(e.upper,t.upper)&&!!e.lowerOpen==!!t.lowerOpen&&!!e.upperOpen==!!t.upperOpen}function Xn(e,t){return function(e,t,n,r){if(void 0===e)return void 0!==t?-1:0;if(void 0===t)return 1;if(0===(t=lt(e,t))){if(n&&r)return 0;if(n)return 1;if(r)return-1}return t}(e.lower,t.lower,e.lowerOpen,t.lowerOpen)<=0&&0<=function(e,t,n,r){if(void 0===e)return void 0!==t?1:0;if(void 0===t)return-1;if(0===(t=lt(e,t))){if(n&&r)return 0;if(n)return-1;if(r)return 1}return t}(e.upper,t.upper,e.upperOpen,t.upperOpen)}function Jn(e,t,n,r){e.subscribers.add(n),r.addEventListener("abort",function(){var r,a;e.subscribers.delete(n),0===e.subscribers.size&&(r=e,a=t,setTimeout(function(){0===r.subscribers.size&&O(a,r)},3e3))})}var Zn={stack:"dbcore",level:0,name:"Cache",create:function(e){var n=e.schema.name;return t(t({},e),{transaction:function(t,r,a){var i,o,s=e.transaction(t,r,a);return"readwrite"===r&&(o=(i=new AbortController).signal,a=function(a){return function(){if(i.abort(),"readwrite"===r){for(var o=new Set,u=0,l=t;u<l.length;u++){var c=l[u],h=Tn["idb://".concat(n,"/").concat(c)];if(h){var d=e.table(c),f=h.optimisticOps.filter(function(e){return e.trans===s});if(s._explicit&&a&&s.mutatedParts)for(var m=0,p=Object.values(h.queries.query);m<p.length;m++)for(var y=0,g=(x=p[m]).slice();y<g.length;y++)In((w=g[y]).obsSet,s.mutatedParts)&&(O(x,w),w.subscribers.forEach(function(e){return o.add(e)}));else if(0<f.length){h.optimisticOps=h.optimisticOps.filter(function(e){return e.trans!==s});for(var b=0,v=Object.values(h.queries.query);b<v.length;b++)for(var x,w,k,j=0,_=(x=v[b]).slice();j<_.length;j++)null!=(w=_[j]).res&&s.mutatedParts&&(a&&!w.dirty?(k=Object.isFrozen(w.res),k=Qn(w.res,w.req,f,d,w,k),w.dirty?(O(x,w),w.subscribers.forEach(function(e){return o.add(e)})):k!==w.res&&(w.res=k,w.promise=ke.resolve({result:k}))):(w.dirty&&O(x,w),w.subscribers.forEach(function(e){return o.add(e)})))}}}o.forEach(function(e){return e()})}}},s.addEventListener("abort",a(!1),{signal:o}),s.addEventListener("error",a(!1),{signal:o}),s.addEventListener("complete",a(!0),{signal:o})),s},table:function(r){var a=e.table(r),i=a.schema.primaryKey;return t(t({},a),{mutate:function(e){var o=be.trans;if(i.outbound||"disabled"===o.db._options.cache||o.explicit||"readwrite"!==o.idbtrans.mode)return a.mutate(e);var s=Tn["idb://".concat(n,"/").concat(r)];return s?(o=a.mutate(e),"add"!==e.type&&"put"!==e.type||!(50<=e.values.length||qn(i,e).some(function(e){return null==e}))?(s.optimisticOps.push(e),e.mutatedParts&&Nn(e.mutatedParts),o.then(function(t){0<t.numFailures&&(O(s.optimisticOps,e),(t=Yn(0,e,t))&&s.optimisticOps.push(t),e.mutatedParts&&Nn(e.mutatedParts))}),o.catch(function(){O(s.optimisticOps,e),e.mutatedParts&&Nn(e.mutatedParts)})):o.then(function(n){var r=Yn(0,t(t({},e),{values:e.values.map(function(e,r){var a;return n.failures[r]||w(e=null!==(a=i.keyPath)&&void 0!==a&&a.includes(".")?I(e):t({},e),i.keyPath,n.results[r]),e})}),n);s.optimisticOps.push(r),queueMicrotask(function(){return e.mutatedParts&&Nn(e.mutatedParts)})}),o):a.mutate(e)},query:function(e){if(!Ln(be,a)||!Wn("query",e))return a.query(e);var t="immutable"===(null===(s=be.trans)||void 0===s?void 0:s.db._options.cache),i=(l=be).requery,o=l.signal,s=function(e,t,n,r){var a=Tn["idb://".concat(e,"/").concat(t)];if(!a)return[];if(!(t=a.queries[n]))return[null,!1,a,null];var i=t[(r.query?r.query.index.name:null)||""];if(!i)return[null,!1,a,null];switch(n){case"query":var o=i.find(function(e){return e.req.limit===r.limit&&e.req.values===r.values&&Gn(e.req.query.range,r.query.range)});return o?[o,!0,a,i]:[i.find(function(e){return("limit"in e.req?e.req.limit:1/0)>=r.limit&&(!r.values||e.req.values)&&Xn(e.req.query.range,r.query.range)}),!1,a,i];case"count":return[o=i.find(function(e){return Gn(e.req.query.range,r.query.range)}),!!o,a,i]}}(n,r,"query",e),u=s[0],l=s[1],c=s[2],h=s[3];return u&&l?u.obsSet=e.obsSet:(l=a.query(e).then(function(e){var n=e.result;if(u&&(u.res=n),t){for(var r=0,a=n.length;r<a;++r)Object.freeze(n[r]);Object.freeze(n)}else e.result=I(n);return e}).catch(function(e){return h&&u&&O(h,u),Promise.reject(e)}),u={obsSet:e.obsSet,promise:l,subscribers:new Set,type:"query",req:e,dirty:!1},h?h.push(u):(h=[u],(c=c||(Tn["idb://".concat(n,"/").concat(r)]={queries:{query:{},count:{}},objs:new Map,optimisticOps:[],unsignaledParts:{}})).queries.query[e.query.index.name||""]=h)),Jn(u,h,i,o),u.promise.then(function(n){return{result:Qn(n.result,e,null==c?void 0:c.optimisticOps,a,u,t)}})}})}})}};function er(e,t){return new Proxy(e,{get:function(e,n,r){return"db"===n?t:Reflect.get(e,n,r)}})}var tr=(nr.prototype.version=function(e){if(isNaN(e)||e<.1)throw new W.Type("Given version is not a positive number");if(e=Math.round(10*e)/10,this.idbdb||this._state.isBeingOpened)throw new W.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,e);var t=this._versions,n=t.filter(function(t){return t._cfg.version===e})[0];return n||(n=new this.Version(e),t.push(n),t.sort(rn),n.stores({}),this._state.autoSchema=!1,n)},nr.prototype._whenReady=function(e){var t=this;return this.idbdb&&(this._state.openComplete||be.letThrough||this._vip)?e():new ke(function(e,n){if(t._state.openComplete)return n(new W.DatabaseClosed(t._state.dbOpenError));if(!t._state.isBeingOpened){if(!t._state.autoOpen)return void n(new W.DatabaseClosed);t.open().catch(V)}t._state.dbReadyPromise.then(e,n)}).then(e)},nr.prototype.use=function(e){var t=e.stack,n=e.create,r=e.level,a=e.name;return a&&this.unuse({stack:t,name:a}),(e=this._middlewares[t]||(this._middlewares[t]=[])).push({stack:t,create:n,level:null==r?10:r,name:a}),e.sort(function(e,t){return e.level-t.level}),this},nr.prototype.unuse=function(e){var t=e.stack,n=e.name,r=e.create;return t&&this._middlewares[t]&&(this._middlewares[t]=this._middlewares[t].filter(function(e){return r?e.create!==r:!!n&&e.name!==n})),this},nr.prototype.open=function(){var e=this;return Ve(ge,function(){return Kn(e)})},nr.prototype._close=function(){var e=this._state,t=tt.indexOf(this);if(0<=t&&tt.splice(t,1),this.idbdb){try{this.idbdb.close()}catch(n){}this.idbdb=null}e.isBeingOpened||(e.dbReadyPromise=new ke(function(t){e.dbReadyResolve=t}),e.openCanceller=new ke(function(t,n){e.cancelOpen=n}))},nr.prototype.close=function(e){var t=(void 0===e?{disableAutoOpen:!0}:e).disableAutoOpen;e=this._state,t?(e.isBeingOpened&&e.cancelOpen(new W.DatabaseClosed),this._close(),e.autoOpen=!1,e.dbOpenError=new W.DatabaseClosed):(this._close(),e.autoOpen=this._options.autoOpen||e.isBeingOpened,e.openComplete=!1,e.dbOpenError=null)},nr.prototype.delete=function(e){var t=this;void 0===e&&(e={disableAutoOpen:!0});var n=0<arguments.length&&"object"!=typeof arguments[0],r=this._state;return new ke(function(a,i){function o(){t.close(e);var n=t._deps.indexedDB.deleteDatabase(t.name);n.onsuccess=Me(function(){var e,n,r;e=t._deps,n=t.name,r=e.indexedDB,e=e.IDBKeyRange,gn(r)||n===nt||yn(r,e).delete(n).catch(V),a()}),n.onerror=Ft(i),n.onblocked=t._fireOnBlocked}if(n)throw new W.InvalidArgument("Invalid closeOptions argument to db.delete()");r.isBeingOpened?r.dbReadyPromise.then(o):o()})},nr.prototype.backendDB=function(){return this.idbdb},nr.prototype.isOpen=function(){return null!==this.idbdb},nr.prototype.hasBeenClosed=function(){var e=this._state.dbOpenError;return e&&"DatabaseClosed"===e.name},nr.prototype.hasFailed=function(){return null!==this._state.dbOpenError},nr.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(nr.prototype,"tables",{get:function(){var e=this;return a(this._allTables).map(function(t){return e._allTables[t]})},enumerable:!1,configurable:!0}),nr.prototype.transaction=function(){var e=function(e,t,n){var r=arguments.length;if(r<2)throw new W.InvalidArgument("Too few arguments");for(var a=new Array(r-1);--r;)a[r-1]=arguments[r];return n=a.pop(),[e,_(a),n]}.apply(this,arguments);return this._transaction.apply(this,e)},nr.prototype._transaction=function(e,t,n){var r=this,a=be.trans;a&&a.db===this&&-1===e.indexOf("!")||(a=null);var i,o,s=-1!==e.indexOf("?");e=e.replace("!","").replace("?","");try{if(o=t.map(function(e){if("string"!=typeof(e=e instanceof r.Table?e.name:e))throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return e}),"r"==e||e===rt)i=rt;else{if("rw"!=e&&e!=at)throw new W.InvalidArgument("Invalid transaction mode: "+e);i=at}if(a){if(a.mode===rt&&i===at){if(!s)throw new W.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");a=null}a&&o.forEach(function(e){if(a&&-1===a.storeNames.indexOf(e)){if(!s)throw new W.SubTransaction("Table "+e+" not included in parent transaction.");a=null}}),s&&a&&!a.active&&(a=null)}}catch(l){return a?a._promise(null,function(e,t){t(l)}):Xe(l)}var u=function e(t,n,r,a,i){return ke.resolve().then(function(){var o=be.transless||be,s=t._createTransaction(n,r,t._dbSchema,a);if(s.explicit=!0,o={trans:s,transless:o},a)s.idbtrans=a.idbtrans;else try{s.create(),s.idbtrans._explicit=!0,t._state.PR1398_maxLoop=3}catch(c){return c.name===$.InvalidState&&t.isOpen()&&0<--t._state.PR1398_maxLoop?(t.close({disableAutoOpen:!1}),t.open().then(function(){return e(t,n,r,null,i)})):Xe(c)}var u,l=R(i);return l&&Ue(),o=ke.follow(function(){var e;(u=i.call(s,s))&&(l?(e=$e.bind(null,null),u.then(e,e)):"function"==typeof u.next&&"function"==typeof u.throw&&(u=Rn(u)))},o),(u&&"function"==typeof u.then?ke.resolve(u).then(function(e){return s.active?e:Xe(new W.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):o.then(function(){return u})).then(function(e){return a&&s._resolve(),s._completion.then(function(){return e})}).catch(function(e){return s._reject(e),Xe(e)})})}.bind(null,this,i,o,a,n);return a?a._promise(i,u,"lock"):be.trans?Ve(be.transless,function(){return r._whenReady(u)}):this._whenReady(u)},nr.prototype.table=function(e){if(!l(this._allTables,e))throw new W.InvalidTable("Table ".concat(e," does not exist"));return this._allTables[e]},nr);function nr(e,n){var r=this;this._middlewares={},this.verno=0;var a=nr.dependencies;this._options=n=t({addons:nr.addons,autoOpen:!0,indexedDB:a.indexedDB,IDBKeyRange:a.IDBKeyRange,cache:"cloned"},n),this._deps={indexedDB:n.indexedDB,IDBKeyRange:n.IDBKeyRange},a=n.addons,this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;var i,o,s,u,l,c={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:V,dbReadyPromise:null,cancelOpen:V,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3,autoOpen:n.autoOpen};c.dbReadyPromise=new ke(function(e){c.dbReadyResolve=e}),c.openCanceller=new ke(function(e,t){c.cancelOpen=t}),this._state=c,this.name=e,this.on=mt(this,"populate","blocked","versionchange","close",{ready:[ne,V]}),this.on.ready.subscribe=g(this.on.ready.subscribe,function(e){return function(t,n){nr.vip(function(){var a,i=r._state;i.openComplete?(i.dbOpenError||ke.resolve().then(t),n&&e(t)):i.onReadyBeingFired?(i.onReadyBeingFired.push(t),n&&e(t)):(e(t),a=r,n||e(function e(){a.on.ready.unsubscribe(t),a.on.ready.unsubscribe(e)}))})}}),this.Collection=(i=this,pt(At.prototype,function(e,t){this.db=i;var n=ot,r=null;if(t)try{n=t()}catch(o){r=o}var a=e._ctx;e=(t=a.table).hook.reading.fire,this._ctx={table:t,index:a.index,isPrimKey:!a.index||t.schema.primKey.keyPath&&a.index===t.schema.primKey.name,range:n,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:r,or:a.or,valueMapper:e!==Q?e:null}})),this.Table=(o=this,pt(dt.prototype,function(e,t,n){this.db=o,this._tx=n,this.name=e,this.schema=t,this.hook=o._allTables[e]?o._allTables[e].hook:mt(null,{creating:[J,V],reading:[G,Q],updating:[ee,V],deleting:[Z,V]})})),this.Transaction=(s=this,pt(Ut.prototype,function(e,t,n,r,a){var i=this;this.db=s,this.mode=e,this.storeNames=t,this.schema=n,this.chromeTransactionDurability=r,this.idbtrans=null,this.on=mt(this,"complete","error","abort"),this.parent=a||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new ke(function(e,t){i._resolve=e,i._reject=t}),this._completion.then(function(){i.active=!1,i.on.complete.fire()},function(e){var t=i.active;return i.active=!1,i.on.error.fire(e),i.parent?i.parent._reject(e):t&&i.idbtrans&&i.idbtrans.abort(),Xe(e)})})),this.Version=(u=this,pt(mn.prototype,function(e){this.db=u,this._cfg={version:e,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})),this.WhereClause=(l=this,pt(Kt.prototype,function(e,t,n){if(this.db=l,this._ctx={table:e,index:":id"===t?null:t,or:n},this._cmp=this._ascending=lt,this._descending=function(e,t){return lt(t,e)},this._max=function(e,t){return 0<lt(e,t)?e:t},this._min=function(e,t){return lt(e,t)<0?e:t},this._IDBKeyRange=l._deps.IDBKeyRange,!this._IDBKeyRange)throw new W.MissingAPI})),this.on("versionchange",function(e){e.newVersion,r.close({disableAutoOpen:!1})}),this.on("blocked",function(e){!e.newVersion||(e.newVersion,e.oldVersion)}),this._maxKey=Yt(n.IDBKeyRange),this._createTransaction=function(e,t,n,a){return new r.Transaction(e,t,n,r._options.chromeTransactionDurability,a)},this._fireOnBlocked=function(e){r.on("blocked").fire(e),tt.filter(function(e){return e.name===r.name&&e!==r&&!e._state.vcFired}).map(function(t){return t.on("versionchange").fire(e)})},this.use($n),this.use(Zn),this.use(Hn),this.use(Dn),this.use(zn);var h=new Proxy(this,{get:function(e,t,n){if("_vip"===t)return!0;if("table"===t)return function(e){return er(r.table(e),h)};var a=Reflect.get(e,t,n);return a instanceof dt?er(a,h):"tables"===t?a.map(function(e){return er(e,h)}):"_createTransaction"===t?function(){return er(a.apply(this,arguments),h)}:a}});this.vip=h,a.forEach(function(e){return e(r)})}F="undefined"!=typeof Symbol&&"observable"in Symbol?Symbol.observable:"@@observable";var rr,ar=(ir.prototype.subscribe=function(e,t,n){return this._subscribe(e&&"function"!=typeof e?e:{next:e,error:t,complete:n})},ir.prototype[F]=function(){return this},ir);function ir(e){this._subscribe=e}try{rr={indexedDB:r.indexedDB||r.mozIndexedDB||r.webkitIndexedDB||r.msIndexedDB,IDBKeyRange:r.IDBKeyRange||r.webkitIDBKeyRange}}catch(dr){rr={indexedDB:null,IDBKeyRange:null}}function or(e){var t,n=!1,r=new ar(function(r){var a,i=R(e),o=!1,s={},u={},c={get closed(){return o},unsubscribe:function(){o||(o=!0,a&&a.abort(),h&&zt.storagemutated.unsubscribe(f))}};r.start&&r.start(c);var h=!1,d=function(){return Ge(m)},f=function(e){Cn(s,e),In(u,s)&&d()},m=function(){var c,m,p;!o&&rr.indexedDB&&(s={},c={},a&&a.abort(),a=new AbortController,p=function(t){var n=Pe();try{i&&Ue();var r=ze(e,t);return r=i?r.finally($e):r}finally{n&&Ee()}}(m={subscr:c,signal:a.signal,requery:d,querier:e,trans:null}),Promise.resolve(p).then(function(e){n=!0,t=e,o||m.signal.aborted||(s={},function(e){for(var t in e)if(l(e,t))return;return 1}(u=c)||h||(zt(Bt,f),h=!0),Ge(function(){return!o&&r.next&&r.next(e)}))},function(e){n=!1,["DatabaseClosedError","AbortError"].includes(null==e?void 0:e.name)||o||Ge(function(){o||r.error&&r.error(e)})}))};return setTimeout(d,0),c});return r.hasValue=function(){return n},r.getValue=function(){return t},r}var sr=tr;function ur(e){var t=cr;try{cr=!0,zt.storagemutated.fire(e),On(e,!0)}finally{cr=t}}c(sr,t(t({},Y),{delete:function(e){return new sr(e,{addons:[]}).delete()},exists:function(e){return new sr(e,{addons:[]}).open().then(function(e){return e.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(e){try{return n=(t=sr.dependencies).indexedDB,t=t.IDBKeyRange,(gn(n)?Promise.resolve(n.databases()).then(function(e){return e.map(function(e){return e.name}).filter(function(e){return e!==nt})}):yn(n,t).toCollection().primaryKeys()).then(e)}catch(r){return Xe(new W.MissingAPI)}var t,n},defineClass:function(){return function(e){o(this,e)}},ignoreTransaction:function(e){return be.trans?Ve(be.transless,e):e()},vip:bn,async:function(e){return function(){try{var t=Rn(e.apply(this,arguments));return t&&"function"==typeof t.then?t:ke.resolve(t)}catch(n){return Xe(n)}}},spawn:function(e,t,n){try{var r=Rn(e.apply(n,t||[]));return r&&"function"==typeof r.then?r:ke.resolve(r)}catch(a){return Xe(a)}},currentTransaction:{get:function(){return be.trans||null}},waitFor:function(e,t){return t=ke.resolve("function"==typeof e?sr.ignoreTransaction(e):e).timeout(t||6e4),be.trans?be.trans.waitFor(t):t},Promise:ke,debug:{get:function(){return re},set:function(e){ae(e)}},derive:f,extend:o,props:c,override:g,Events:mt,on:zt,liveQuery:or,extendObservabilitySet:Cn,getByKeyPath:x,setByKeyPath:w,delByKeyPath:function(e,t){"string"==typeof t?w(e,t,void 0):"length"in t&&[].map.call(t,function(t){w(e,t,void 0)})},shallowClone:k,deepClone:I,getObjectDiff:Bn,cmp:lt,asap:v,minKey:-1/0,addons:[],connections:tt,errnames:$,dependencies:rr,cache:Tn,semVer:"4.0.11",version:"4.0.11".split(".").map(function(e){return parseInt(e)}).reduce(function(e,t,n){return e+t/Math.pow(10,2*n)})})),sr.maxKey=Yt(sr.dependencies.IDBKeyRange),"undefined"!=typeof dispatchEvent&&"undefined"!=typeof addEventListener&&(zt(Bt,function(e){cr||(e=new CustomEvent(qt,{detail:e}),cr=!0,dispatchEvent(e),cr=!1)}),addEventListener(qt,function(e){e=e.detail,cr||ur(e)}));var lr,cr=!1,hr=function(){};return"undefined"!=typeof BroadcastChannel&&((hr=function(){(lr=new BroadcastChannel(qt)).onmessage=function(e){return e.data&&ur(e.data)}})(),"function"==typeof lr.unref&&lr.unref(),zt(Bt,function(e){cr||lr.postMessage(e)})),"undefined"!=typeof addEventListener&&(addEventListener("pagehide",function(e){if(!tr.disableBfCache&&e.persisted){null!=lr&&lr.close();for(var t=0,n=tt;t<n.length;t++)n[t].close({disableAutoOpen:!1})}}),addEventListener("pageshow",function(e){!tr.disableBfCache&&e.persisted&&(hr(),ur({all:new xn(-1/0,[[]])}))})),ke.rejectionMapper=function(e,t){return!e||e instanceof B||e instanceof TypeError||e instanceof SyntaxError||!e.name||!H[e.name]?e:(t=new H[e.name](t||e.message,e),"stack"in e&&d(t,"stack",{get:function(){return this.inner.stack}}),t)},ae(re),t(tr,Object.freeze({__proto__:null,Dexie:tr,liveQuery:or,Entity:ut,cmp:lt,PropModification:jt,replacePrefix:function(e,t){return new jt({replacePrefix:[e,t]})},add:function(e){return new jt({add:e})},remove:function(e){return new jt({remove:e})},default:tr,RangeSet:xn,mergeRanges:kn,rangesOverlap:jn}),{default:tr}),tr}()),ve.exports)),we=Symbol.for("Dexie"),ke=globalThis[we]||(globalThis[we]=xe);if(xe.semVer!==ke.semVer)throw new Error(`Two different versions of Dexie loaded in the same app: ${xe.semVer} and ${ke.semVer}`);const{liveQuery:je,mergeRanges:_e,rangesOverlap:Ae,RangeSet:Se,cmp:Ce,Entity:Ie,PropModification:Te,replacePrefix:Pe,add:Ee,remove:Ne}=ke;const Oe=new class extends ke{constructor(){super("IlmTabDatabase"),this.version(1).stores({settings:"id",favorites:"id, type, surahNumber, ayahNumber, book, hadithNumber, dateAdded, *tags",tasks:"id, done",cachedContent:"id, type, dateAdded, expiresAt",cachedImages:"id, originalUrl, dateAdded, expiresAt"}).upgrade(e=>e.table("settings").toCollection().modify(e=>{e.background&&e.background.uploadedImages&&(e.background.uploadedImages=e.background.uploadedImages.map(e=>({...e,uploadedAt:e.dateAdded?new Date(e.dateAdded).toISOString():(new Date).toISOString(),originalSize:e.originalSize||0,compressedSize:e.compressedSize||0,dimensions:e.dimensions||{width:0,height:0},compressionRatio:e.compressionRatio||"1.0"})))}))}},Me={id:"main",version:"1.3.0",ayah:{tafsirLanguage:"english",tafsirId:169,textEdition:{language:"en",identifier:"en.asad"},audioEdition:{identifier:"ar.alafasy",englishName:"Mishary Rashid Alafasy"}},search:{translationEdition:"en.sahih"},weather:{enabled:!0,location:{name:"Toronto",country:"Canada",admin1:"Ontario",latitude:43.65107,longitude:-79.347015,timezone:"America/Toronto"},customName:"",timeFormat:"12h",temperatureUnit:"celsius"},hadith:{book:"sahih-bukhari",translationLanguage:"en"},greetings:{enabled:!0,name:"User"},tasks:{enabled:!0},background:{refreshInterval:"newtab",lastRefreshTime:null,currentImageUrl:null,fallbackImageUrl:"/mosque.jpg",imageSource:"category",islamicCategory:"nature",uploadedImages:[],currentUploadedImageIndex:0,blurIntensity:0,opacity:100,imageCache:{images:[],currentIndex:0,lastFetchTime:0,category:""}}};class Ke{static async needsMigration(){try{const e=await Oe.settings.get("main");if(!e)return!0;const t=e.version,n=Me.version;return this.compareVersions(t,n)<0}catch(e){return!0}}static compareVersions(e,t){const n=e.split(".").map(Number),r=t.split(".").map(Number);for(let a=0;a<Math.max(n.length,r.length);a++){const e=n[a]||0,t=r[a]||0;if(e<t)return-1;if(e>t)return 1}return 0}static async runMigrations(){try{await Oe.transaction("rw",[Oe.settings,Oe.favorites,Oe.tasks,Oe.cachedContent,Oe.cachedImages],async e=>{await this.migrateSettings(e),await this.migrateFavorites(e),await this.migrateTasks(e),await this.cleanupExpiredCache(e),await this.optimizeDatabase(e)})}catch(e){throw e}}static async migrateSettings(e){const t=await e.table("settings").get("main");if(!t)return void(await e.table("settings").put(Me));const n=this.deepMergeSettings(t,Me);n.version=Me.version,await this.applyVersionSpecificMigrations(n,t.version),await e.table("settings").put(n)}static async applyVersionSpecificMigrations(e,t){this.compareVersions(t,"1.3.0")<0&&(e.background.blurIntensity||(e.background.blurIntensity=0),e.background.opacity||(e.background.opacity=100),e.background.uploadedImages&&(e.background.uploadedImages=e.background.uploadedImages.map(e=>({id:e.id||Date.now()+Math.random(),url:e.url,name:e.name||"Uploaded Image",uploadedAt:e.uploadedAt||(new Date).toISOString(),originalSize:e.originalSize||0,compressedSize:e.compressedSize||0,dimensions:e.dimensions||{width:0,height:0},compressionRatio:e.compressionRatio||"1.0"}))),void 0===e.greetings.enabled&&(e.greetings.enabled=!0),void 0===e.tasks.enabled&&(e.tasks.enabled=!0))}static deepMergeSettings(e,t){const n={...e};for(const r in t)t.hasOwnProperty(r)&&("object"!=typeof t[r]||null===t[r]||Array.isArray(t[r])?void 0===e[r]&&(n[r]=t[r]):n[r]=this.deepMergeSettings(e[r]||{},t[r]));return n}static async migrateFavorites(e){const t=await e.table("favorites").toArray();for(const n of t){let t=!1;const r={...n};if(r.dateAdded||(r.dateAdded=Date.now(),t=!0),r.tags||(r.tags=[],t=!0),"hadith"===r.type&&r.book){const e={bukhari:"sahih-bukhari",muslim:"sahih-muslim",tirmidhi:"jami-at-tirmidhi",abudawud:"sunan-abu-dawud",nasai:"sunan-an-nasai",ibnmajah:"sunan-ibn-majah"};e[r.book]&&(r.book=e[r.book],t=!0)}t&&await e.table("favorites").put(r)}}static async migrateTasks(e){const t=await e.table("tasks").toArray();for(const n of t){let t=!1;const r={...n};"number"!=typeof r.id&&(r.id=parseInt(r.id)||Date.now(),t=!0),"boolean"!=typeof r.done&&(r.done=!!r.done,t=!0),"string"!=typeof r.text&&(r.text=String(r.text||""),t=!0),t&&await e.table("tasks").put(r)}}static async cleanupExpiredCache(e){const t=Date.now();(await e.table("cachedContent").where("expiresAt").below(t).toArray()).length>0&&await e.table("cachedContent").where("expiresAt").below(t).delete();(await e.table("cachedImages").where("expiresAt").below(t).toArray()).length>0&&await e.table("cachedImages").where("expiresAt").below(t).delete()}static async optimizeDatabase(e){const t=await e.table("favorites").toArray(),n=new Map;for(const i of t)n.has(i.id)?await e.table("favorites").delete(i.id):n.set(i.id,i);const r=await e.table("cachedContent").orderBy("dateAdded").reverse().toArray();if(r.length>100){const t=r.slice(100);for(const n of t)await e.table("cachedContent").delete(n.id)}const a=await e.table("cachedImages").orderBy("dateAdded").reverse().toArray();if(a.length>50){const t=a.slice(50);for(const n of t)await e.table("cachedImages").delete(n.id)}}static async exportDatabase(){const e={version:Me.version,exportDate:(new Date).toISOString(),settings:await Oe.settings.toArray(),favorites:await Oe.favorites.toArray(),tasks:await Oe.tasks.toArray()};return JSON.stringify(e,null,2)}static async importDatabase(e){try{const t=JSON.parse(e);await Oe.transaction("rw",[Oe.settings,Oe.favorites,Oe.tasks],async e=>{await e.table("settings").clear(),await e.table("favorites").clear(),await e.table("tasks").clear(),t.settings&&await e.table("settings").bulkAdd(t.settings),t.favorites&&await e.table("favorites").bulkAdd(t.favorites),t.tasks&&await e.table("tasks").bulkAdd(t.tasks)}),await this.runMigrations()}catch(t){throw t}}static async resetDatabase(){await Oe.transaction("rw",[Oe.settings,Oe.favorites,Oe.tasks,Oe.cachedContent,Oe.cachedImages],async e=>{await e.table("settings").clear(),await e.table("favorites").clear(),await e.table("tasks").clear(),await e.table("cachedContent").clear(),await e.table("cachedImages").clear(),await e.table("settings").put(Me)})}static async getDatabaseStats(){const e={settings:await Oe.settings.count(),favorites:await Oe.favorites.count(),tasks:await Oe.tasks.count(),cachedContent:await Oe.cachedContent.count(),cachedImages:await Oe.cachedImages.count(),totalSize:"Unknown"};try{if("estimate"in navigator.storage){const t=await navigator.storage.estimate();t.usage&&(e.totalSize=this.formatBytes(t.usage))}}catch(t){}return e}static formatBytes(e){if(0===e)return"0 Bytes";const t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["Bytes","KB","MB","GB","TB"][t]}}const Re=()=>{const e=(()=>{const[e,t]=y.useState(null),[n,r]=y.useState(!0),[a,i]=y.useState(null);y.useEffect(()=>{(async()=>{try{r(!0),await Ke.needsMigration()&&await Ke.runMigrations();const e=await Oe.settings.get("main");e?t(e):(await Oe.settings.put({...Me,id:"main"}),t(Me)),i(null)}catch(e){i("Failed to load settings")}finally{r(!1)}})()},[]);const o=y.useCallback(async e=>{try{t(t=>t?{...t,...e}:null);const n=await Oe.settings.get("main"),r=n?{...n,...e}:{...Me,...e,id:"main"};await Oe.settings.put(r)}catch(n){i("Failed to update settings");const e=await Oe.settings.get("main");t(e||null)}},[]),s=y.useCallback(async(t,n)=>{if(!e)return;const r=t.split("."),a={...e};let i=a;for(let e=0;e<r.length-1;e++)i=i[r[e]];i[r[r.length-1]]=n,await o(a)},[e,o]);return{settings:e,loading:n,error:a,updateSettings:o,updateSettingPath:s}})(),t=(()=>{const[e,t]=y.useState([]),[n,r]=y.useState(!0),[a,i]=y.useState(null),o=y.useCallback(async()=>{try{r(!0);const e=await Oe.favorites.toArray();t(e),i(null)}catch(e){i("Failed to load favorites")}finally{r(!1)}},[]);y.useEffect(()=>{o()},[o]);const s=y.useCallback(async e=>{try{const n={...e,dateAdded:Date.now()};t(e=>[...e,n]),await Oe.favorites.put(n)}catch(n){i("Failed to add favorite"),await o()}},[o]),u=y.useCallback(async e=>{try{t(t=>t.filter(t=>t.id!==e)),await Oe.favorites.delete(e)}catch(n){i("Failed to remove favorite"),await o()}},[o]),l=y.useCallback(async(e,t)=>{try{await Oe.favorites.update(e,{note:t}),await o()}catch(n){i("Failed to update favorite note")}},[o]),c=y.useCallback(async e=>{try{const t=e.toLowerCase();return await Oe.favorites.filter(e=>{var n,r,a,i;return((null==(n=e.text)?void 0:n.toLowerCase().includes(t))??!1)||((null==(r=e.englishText)?void 0:r.toLowerCase().includes(t))??!1)||((null==(a=e.note)?void 0:a.toLowerCase().includes(t))??!1)||((null==(i=e.surahName)?void 0:i.toLowerCase().includes(t))??!1)}).toArray()}catch(t){return[]}},[]),h=y.useCallback(t=>e.some(e=>e.id===t),[e]);return{favorites:e,loading:n,error:a,addFavorite:s,removeFavorite:u,updateFavoriteNote:l,searchFavorites:c,isFavorited:h,refresh:o}})(),n=(()=>{const[e,t]=y.useState([]),[n,r]=y.useState(!0),[a,i]=y.useState(null),o=y.useCallback(async()=>{try{r(!0);const e=await Oe.tasks.toArray();t(e),i(null)}catch(e){i("Failed to load tasks")}finally{r(!1)}},[]);y.useEffect(()=>{o()},[o]);const s=y.useCallback(async e=>{try{const t=await Oe.tasks.toArray(),n={id:(t.length>0?Math.max(...t.map(e=>e.id)):0)+1,text:e.text,done:e.done??!1};await Oe.tasks.add(n),await o()}catch(t){i("Failed to add task")}},[o]),u=y.useCallback(async(e,n)=>{try{t(t=>t.map(t=>t.id===e?{...t,...n}:t)),await Oe.tasks.update(e,n)}catch(r){i("Failed to update task"),await o()}},[o]),l=y.useCallback(async e=>{try{t(t=>t.filter(t=>t.id!==e)),await Oe.tasks.delete(e)}catch(n){i("Failed to delete task"),await o()}},[o]),c=y.useCallback(async t=>{const n=e.find(e=>e.id===t);n&&await u(t,{done:!n.done})},[e,u]),h=y.useCallback(()=>{const t=e.length,n=e.filter(e=>e.done).length;return{total:t,completed:n,pending:t-n}},[e]);return{tasks:e,loading:n,error:a,addTask:s,updateTask:u,deleteTask:l,toggleTask:c,getTaskStats:h,refresh:o}})(),r=null!==e.settings&&!e.loading;return{settings:{settings:e.settings,loading:e.loading,error:e.error,updateSettings:e.updateSettings,updateSettingPath:e.updateSettingPath},favorites:{favorites:t.favorites,loading:t.loading,error:t.error,addFavorite:t.addFavorite,removeFavorite:t.removeFavorite,updateFavoriteNote:t.updateFavoriteNote,searchFavorites:t.searchFavorites,isFavorited:t.isFavorited,refresh:t.refresh},tasks:{tasks:n.tasks,loading:n.loading,error:n.error,addTask:n.addTask,updateTask:n.updateTask,deleteTask:n.deleteTask,toggleTask:n.toggleTask,getTaskStats:n.getTaskStats,refresh:n.refresh},isReady:r}},Fe=y.createContext(null),De=({children:e})=>{const n=Re();return t.jsx(Fe.Provider,{value:n,children:e})},Be=()=>{const e=y.useContext(Fe);if(!e)throw new Error("useIndexedDBContext must be used within an IndexedDBProvider");return e},qe={english:[{id:169,name:"Ibn Kathir (Abridged)",author_name:"Hafiz Ibn Kathir"},{id:168,name:"Ma'arif al-Qur'an",author_name:"Mufti Muhammad Shafi"},{id:817,name:"Tazkirul Quran (Maulana Wahiduddin Khan)",author_name:"Maulana Wahid Uddin Khan"}],bengali:[{id:381,name:"Tafsir Fathul Majid",author_name:"AbdulRahman Bin Hasan Al-Alshaikh"},{id:165,name:"Tafsir Ahsanul Bayaan",author_name:"Bayaan Foundation"},{id:166,name:"Tafsir Abu Bakr Zakaria",author_name:"King Fahd Quran Printing Complex"},{id:164,name:"Tafseer ibn Kathir",author_name:"Tawheed Publication"}],arabic:[{id:16,name:"Tafsir Muyassar",author_name:""},{id:93,name:"Al-Tafsir al-Wasit (Tantawi)",author_name:"Waseet"},{id:14,name:"Tafsir Ibn Kathir",author_name:"Hafiz Ibn Kathir"},{id:15,name:"Tafsir al-Tabari",author_name:"Tabari"},{id:90,name:"Al-Qurtubi",author_name:"Qurtubi"},{id:91,name:" Al-Sa'di",author_name:"Saddi"},{id:94,name:"Tafseer Al-Baghawi",author_name:"Baghawy"}],russian:[{id:170,name:"Al-Sa'di",author_name:"Saddi"}],urdu:[{id:157,name:"Fi Zilal al-Quran",author_name:"Sayyid Ibrahim Qutb"},{id:160,name:"Tafsir Ibn Kathir",author_name:"Hafiz Ibn Kathir"},{id:818,name:"Tazkir ul Quran",author_name:"Maulana Wahid Uddin Khan"},{id:159,name:"Bayan ul Quran",author_name:"Dr. Israr Ahmad"}],kurdish:[{id:804,name:"Rebar Kurdish Tafsir",author_name:"Rebar Kurdish Tafsir"}]},ze=()=>t.jsxs(i,{children:[t.jsxs(i,{mb:2,children:[t.jsx(g,{variant:"text",width:"60%",height:28,sx:{mb:.5}}),t.jsx(g,{variant:"text",width:"40%",height:20})]}),t.jsxs(i,{children:[t.jsx(g,{variant:"text",width:"100%",height:24,sx:{mb:1}}),t.jsx(g,{variant:"text",width:"95%",height:24,sx:{mb:1}}),t.jsx(g,{variant:"text",width:"98%",height:24,sx:{mb:1}}),t.jsx(g,{variant:"text",width:"92%",height:24,sx:{mb:1}}),t.jsx(g,{variant:"text",width:"100%",height:24,sx:{mb:1}}),t.jsx(g,{variant:"text",width:"88%",height:24,sx:{mb:1}}),t.jsx(g,{variant:"text",width:"96%",height:24,sx:{mb:1}}),t.jsx(g,{variant:"text",width:"90%",height:24,sx:{mb:1}}),t.jsx(g,{variant:"text",width:"100%",height:24,sx:{mb:1}}),t.jsx(g,{variant:"text",width:"85%",height:24,sx:{mb:1}}),t.jsx(g,{variant:"text",width:"93%",height:24,sx:{mb:1}}),t.jsx(g,{variant:"text",width:"97%",height:24,sx:{mb:1}}),t.jsx(g,{variant:"text",width:"89%",height:24,sx:{mb:1}}),t.jsx(g,{variant:"text",width:"100%",height:24,sx:{mb:1}}),t.jsx(g,{variant:"text",width:"75%",height:24})]})]}),Ue=({open:e,onClose:n,surah:r,ayah:o})=>{var s,u;const{settings:h}=Be(),d=(null==(s=null==h?void 0:h.settings)?void 0:s.ayah)||{},f=d.tafsirId||169,m=d.tafsirLanguage||"english",[p,g]=y.useState(!0),[w,k]=y.useState(null),[j,_]=y.useState(null),A=(null==(u=qe[m])?void 0:u.find(e=>e.id===f))||{name:"Unknown Tafsir",author_name:""};return y.useEffect(()=>{if(!e)return;(async()=>{g(!0),_(null);try{const e=await(async(e={})=>{var t,n;const{tafsirId:r,surah:a,ayah:i}=e;if(!r||!a||!i)throw new Error("Missing tafsirId, surah or ayah parameter");try{const e=await fetch(`https://api.quran.com/api/v4/tafsirs/${r}/by_ayah/${a}:${i}`);if(!e.ok)throw new Error("Failed to fetch tafsir");const o=(await e.json()).tafsir;if(!o||!o.text)throw new Error("Tafsir not found for this ayah");return{tafsir:o.text,tafsirName:(null==(t=o.translated_name)?void 0:t.name)||o.resource_name||null,languageName:(null==(n=o.translated_name)?void 0:n.language_name)||null,ayahKey:`${a}:${i}`}}catch(j){throw new Error(j.message||"Internal server error")}})({tafsirId:f,surah:r,ayah:o});k(e)}catch(e){_(e.message)}finally{g(!1)}})()},[e,r,o,f]),t.jsxs(b,{open:e,onClose:n,maxWidth:"md",fullWidth:!0,PaperProps:{className:"modal-enter"},children:[t.jsxs(v,{children:["Tafsir",t.jsx(l,{onClick:n,sx:{position:"absolute",right:16,top:16},children:t.jsx(c,{})})]}),t.jsxs(x,{dividers:!0,children:[t.jsxs(i,{mb:2,children:[t.jsx(a,{variant:"subtitle1",fontWeight:"bold",children:A.name}),t.jsx(a,{variant:"subtitle2",color:"text.secondary",children:A.author_name})]}),p?t.jsx(ze,{}):j?t.jsx(a,{color:"error",children:j}):w?t.jsx("div",{className:"animate-fade-in",children:t.jsx("div",{dangerouslySetInnerHTML:{__html:w.tafsir},style:{lineHeight:1.6}})}):null]})]})},$e=e=>{const t=Math.floor(e/60),n=Math.floor(e%60);return`${t}:${n<10?"0":""}${n}`},Le=({src:e,onPrev:n,onNext:r,onToggleContinuous:o,isContinuous:s,ayah:u,onFavorite:c})=>{var h;const d=y.useRef(null);w();const[f,m]=y.useState(!1),[p,g]=y.useState(0),[b,v]=y.useState(0),[x,K]=y.useState(!1),{favorites:R}=Be(),F=`ayah-${u.surah.number}-${u.surah.ayahNumberInSurah}`,D=(null==(h=null==R?void 0:R.favorites)?void 0:h.some(e=>e.id===F))||!1;y.useEffect(()=>{const e=d.current;if(!e)return;const t=()=>g(e.duration),n=()=>v(e.currentTime),r=()=>m(!1);return e.addEventListener("loadedmetadata",t),e.addEventListener("timeupdate",n),e.addEventListener("ended",r),()=>{e.removeEventListener("loadedmetadata",t),e.removeEventListener("timeupdate",n),e.removeEventListener("ended",r)}},[]);return t.jsxs(k,{elevation:4,sx:{p:2,width:"100%",maxWidth:1e3,mx:"auto",margin:"2rem auto",backgroundColor:"rgba(255, 255, 255, 0.7)",backdropFilter:"blur(10px)",WebkitBackdropFilter:"blur(10px)",boxShadow:"0 8px 16px rgba(0,0,0,0.12)"},children:[t.jsx("audio",{ref:d,src:e,preload:"metadata"}),t.jsxs(i,{display:"flex",justifyContent:"center",alignItems:"center",gap:1,mb:2,children:[t.jsx(j,{title:"Restart",children:t.jsx(l,{onClick:()=>{const e=d.current;e&&(e.currentTime=0,e.play(),m(!0))},children:t.jsx(_,{})})}),t.jsx(j,{title:f?"Pause":"Play",children:t.jsx(l,{onClick:()=>{const e=d.current;e&&(f?e.pause():e.play(),m(!f))},children:f?t.jsx(A,{}):t.jsx(S,{})})}),t.jsx(j,{title:"Stop",children:t.jsx(l,{onClick:()=>{const e=d.current;e&&(e.pause(),e.currentTime=0,m(!1))},children:t.jsx(C,{})})}),t.jsx(j,{title:s?"Previous Ayah":"Enable continuous mode to navigate",children:t.jsx("span",{children:t.jsx(l,{onClick:n,disabled:!s,children:t.jsx(I,{})})})}),t.jsx(j,{title:"Toggle Continuous Mode",children:t.jsx(l,{onClick:o,color:s?"primary":"default",children:t.jsx(T,{})})}),t.jsx(j,{title:"Next Ayah",children:t.jsx(l,{onClick:r,children:t.jsx(P,{})})}),t.jsx(j,{title:"View Tafsir",children:t.jsx(l,{onClick:()=>K(!0),children:t.jsx(E,{})})}),t.jsx(j,{title:D?"Unfavorite Ayah":"Favorite Ayah",children:t.jsx(l,{onClick:()=>{if(D)null==R||R.removeFavorite(F);else{const t={id:F,type:"ayah",surahNumber:u.surah.number,ayahNumber:u.surah.ayahNumberInSurah,text:u.text,audio:e,note:"",surahName:u.surah.englishNameTranslation,surahArabicName:u.surah.name};null==R||R.addFavorite(t)}},children:D?t.jsx(N,{sx:{color:"red"}}):t.jsx(O,{})})})]}),t.jsxs(i,{display:"flex",alignItems:"center",gap:2,children:[t.jsx(a,{variant:"caption",sx:{minWidth:40},children:$e(b)}),t.jsx(M,{min:0,max:p,value:b,onChange:(e,t)=>{const n=d.current;n&&(n.currentTime=t,v(t))},sx:{flex:1}}),t.jsx(a,{variant:"caption",sx:{minWidth:40},children:$e(p)})]}),t.jsx(Ue,{open:x,onClose:()=>K(!1),surah:u.surah.number,ayah:u.surah.ayahNumberInSurah})]})},We={1:"Al-Fatihah",2:"Al-Baqarah",3:"Ali 'Imran",4:"An-Nisa",5:"Al-Ma'idah",6:"Al-An'am",7:"Al-A'raf",8:"Al-Anfal",9:"At-Tawbah",10:"Yunus",11:"Hud",12:"Yusuf",13:"Ar-Ra'd",14:"Ibrahim",15:"Al-Hijr",16:"An-Nahl",17:"Al-Isra",18:"Al-Kahf",19:"Maryam",20:"Taha",21:"Al-Anbya",22:"Al-Hajj",23:"Al-Mu'minun",24:"An-Nur",25:"Al-Furqan",26:"Ash-Shu'ara",27:"An-Naml",28:"Al-Qasas",29:"Al-'Ankabut",30:"Ar-Rum",31:"Luqman",32:"As-Sajdah",33:"Al-Ahzab",34:"Saba",35:"Fatir",36:"Ya-Sin",37:"As-Saffat",38:"Sad",39:"Az-Zumar",40:"Ghafir",41:"Fussilat",42:"Ash-Shuraa",43:"Az-Zukhruf",44:"Ad-Dukhan",45:"Al-Jathiyah",46:"Al-Ahqaf",47:"Muhammad",48:"Al-Fath",49:"Al-Hujurat",50:"Qaf",51:"Adh-Dhariyat",52:"At-Tur",53:"An-Najm",54:"Al-Qamar",55:"Ar-Rahman",56:"Al-Waqi'ah",57:"Al-Hadid",58:"Al-Mujadila",59:"Al-Hashr",60:"Al-Mumtahanah",61:"As-Saff",62:"Al-Jumu'ah",63:"Al-Munafiqun",64:"At-Taghabun",65:"At-Talaq",66:"At-Tahrim",67:"Al-Mulk",68:"Al-Qalam",69:"Al-Haqqah",70:"Al-Ma'arij",71:"Nuh",72:"Al-Jinn",73:"Al-Muzzammil",74:"Al-Muddaththir",75:"Al-Qiyamah",76:"Al-Insan",77:"Al-Mursalat",78:"An-Naba",79:"An-Nazi'at",80:"'Abasa",81:"At-Takwir",82:"Al-Infitar",83:"Al-Mutaffifin",84:"Al-Inshiqaq",85:"Al-Buruj",86:"At-Tariq",87:"Al-A'la",88:"Al-Ghashiyah",89:"Al-Fajr",90:"Al-Balad",91:"Ash-Shams",92:"Al-Layl",93:"Ad-Duhaa",94:"Ash-Sharh",95:"At-Tin",96:"Al-'Alaq",97:"Al-Qadr",98:"Al-Bayyinah",99:"Az-Zalzalah",100:"Al-'Adiyat",101:"Al-Qari'ah",102:"At-Takathur",103:"Al-'Asr",104:"Al-Humazah",105:"Al-Fil",106:"Quraysh",107:"Al-Ma'un",108:"Al-Kawthar",109:"Al-Kafirun",110:"An-Nasr",111:"Al-Masad",112:"Al-Ikhlas",113:"Al-Falaq",114:"An-Nas"},He=K`
  from { opacity: 0; transform: translateY(10px);}
  to { opacity: 1; transform: translateY(0);}
`,Ye=({ayah:e,onPrev:n,onNext:r,onToggleContinuous:s,isContinuous:u,onFavorite:l})=>{const c=w();return t.jsxs(R,{sx:{width:"60%",maxWidth:1e3,mx:"auto",margin:"2rem auto",borderRadius:2,background:"linear-gradient(to bottom right, rgba(245, 245, 245, 0.7), rgba(255, 255, 255, 0.4))",backdropFilter:"blur(10px)",boxShadow:"inset 0 0 10px rgba(0,0,0,0.05), 0 8px 30px rgba(0, 0, 0, 0.15)",transition:"transform 0.3s ease, box-shadow 0.3s ease","&:hover":{transform:"translateY(-6px)",boxShadow:"0 20px 40px rgba(0,0,0,0.2)"},animation:`${He} 0.6s ease forwards`,overflow:"visible",minHeight:"400px"},children:[t.jsxs(i,{sx:{background:`linear-gradient(90deg, ${c.palette.primary.light} 0%, ${c.palette.primary.main} 100%)`,borderRadius:"8px 8px 0 0",padding:"12px 20px",display:"flex",alignItems:"center",justifyContent:"space-between",color:"#fff",fontWeight:700,fontSize:"1.3rem"},children:[t.jsxs(i,{children:["Surah ",e.surah.number,": ",e.surah.englishNameTranslation," ",t.jsxs(a,{component:"span",sx:{fontWeight:"normal",fontSize:"1rem",opacity:.8,marginLeft:1},children:["(",e.surah.name,"  ",We[e.surah.number],")"]}),t.jsxs(a,{variant:"body2",sx:{mt:.5,color:"#eee"},children:["Ayah ",e.surah.ayahNumberInSurah," of ",e.surah.numberOfAyahs]})]}),t.jsx(o,{label:e.surah.revelationType,color:"secondary",size:"small",sx:{fontWeight:700,letterSpacing:"0.06em",textTransform:"uppercase",backgroundColor:c.palette.secondary.main,color:"#fff",fontSize:"0.75rem"}})]}),t.jsxs(F,{sx:{paddingTop:3,paddingBottom:3,position:"relative"},children:[t.jsx(i,{sx:{fontSize:{xs:"1.6rem",sm:"1.9rem"},fontFamily:'"Scheherazade New", serif',direction:"rtl",textAlign:"right",color:"#111827",marginBottom:2,lineHeight:1.6,userSelect:"text",whiteSpace:"pre-line"},textAlign:"center",children:e.arabicText}),t.jsx(D,{sx:{marginBottom:2}}),t.jsx(a,{variant:"body1",sx:{fontSize:{xs:"1rem",sm:"1.15rem"},color:"#374151",fontStyle:"italic",lineHeight:1.4,whiteSpace:"pre-line"},textAlign:"center",children:e.text}),t.jsxs(a,{variant:"caption",color:"text.secondary",sx:{fontWeight:"medium",marginTop:2,display:"block"},textAlign:"center",children:["Translation by ",e.editionName]}),t.jsxs(a,{variant:"body2",sx:{marginTop:1,fontWeight:500,color:e.sajda?"success.main":"text.secondary"},textAlign:"center",children:["Sajdah Tilawah: ",e.sajda?"Yes":"No"]})]}),t.jsx(Le,{src:e.audio.main,onPrev:n,onNext:r,onToggleContinuous:s,isContinuous:u,ayah:e,onFavorite:l})]})},Ve=K`
  from { opacity: 0; transform: translateY(10px);}
  to { opacity: 1; transform: translateY(0);}
`,Qe=({hadith:e,onPrev:n,onNext:r,onToggleContinuous:s,isContinuous:u,onFavorite:c})=>{var h,d,f,m,p,g,b,v;const x=w(),{favorites:k,settings:_}=Be(),[A,S]=y.useState({text:(null==(h=e.text)?void 0:h.english)||"",narrator:(null==(d=e.narrator)?void 0:d.english)||"",heading:(null==(f=e.heading)?void 0:f.english)||"",chapter:(null==(m=e.chapter)?void 0:m.english)||"",arabicText:(null==(p=e.text)?void 0:p.arabic)||"",number:e.number||"",book:e.book||"",status:e.status||""});y.useEffect(()=>{var t,n,r;const a=(null==(n=null==(t=null==_?void 0:_.settings)?void 0:t.hadith)?void 0:n.translationLanguage)||"en",i=e=>{if(!e)return"";switch(a){case"ur":case"urdu":return e.urdu||e.english||"";default:return e.english||e.urdu||""}};S({text:i(e.text),narrator:i(e.narrator),heading:i(e.heading),chapter:i(e.chapter),arabicText:(null==(r=e.text)?void 0:r.arabic)||"",number:e.number||"",book:e.book||"",status:e.status||""})},[e,null==(b=null==(g=null==_?void 0:_.settings)?void 0:g.hadith)?void 0:b.translationLanguage]);const C=`hadith-${e.bookSlug}-${e.number}`,E=(null==(v=null==k?void 0:k.favorites)?void 0:v.some(e=>e.id===C))||!1;return t.jsxs(R,{sx:{width:"60%",maxWidth:1e3,mx:"auto",margin:"2rem auto",borderRadius:2,background:"linear-gradient(to bottom right, rgba(245, 245, 245, 0.7), rgba(255, 255, 255, 0.4))",backdropFilter:"blur(10px)",boxShadow:"inset 0 0 10px rgba(0,0,0,0.05), 0 8px 30px rgba(0, 0, 0, 0.15)","&:hover":{transform:"translateY(-6px)",boxShadow:"0 20px 40px rgba(0,0,0,0.2)"},animation:`${Ve} 0.6s ease forwards`,minHeight:"450px"},children:[t.jsxs(i,{sx:{background:`linear-gradient(90deg, ${x.palette.primary.light} 0%, ${x.palette.primary.main} 100%)`,borderRadius:"8px 8px 0 0",padding:"12px 20px",display:"flex",alignItems:"center",justifyContent:"space-between",color:"#fff",fontWeight:700,fontSize:"1.3rem"},children:[t.jsxs(i,{children:[e.book,t.jsxs(a,{component:"span",sx:{fontWeight:"normal",fontSize:"1rem",opacity:.8,marginLeft:1},children:["- Chapter ",e.chapter.chapterNumber,": ",A.chapter]})]}),t.jsx(o,{label:e.status,color:"success",size:"small",sx:{fontWeight:700,letterSpacing:"0.06em",textTransform:"uppercase",backgroundColor:x.palette.success.main,color:"#fff",fontSize:"0.75rem"}})]}),t.jsxs(F,{sx:{paddingTop:3,paddingBottom:3},children:[t.jsx(a,{variant:"subtitle2",textAlign:"center",sx:{fontWeight:500,marginBottom:1},children:A.narrator}),t.jsx(i,{sx:{fontSize:{xs:"1.5rem",sm:"1.7rem"},fontFamily:'"Scheherazade New", serif',direction:"rtl",textAlign:"right",color:"#111827",marginBottom:2,lineHeight:1.6,userSelect:"text",whiteSpace:"pre-line"},textAlign:"center",children:A.arabicText}),t.jsx(D,{sx:{marginBottom:2}}),t.jsx(a,{variant:"body1",textAlign:"center",sx:{fontSize:{xs:"1rem",sm:"1.15rem"},color:"#374151",fontStyle:"italic",whiteSpace:"pre-line",lineHeight:1.5},children:A.text}),t.jsxs(a,{variant:"caption",textAlign:"center",display:"block",sx:{mt:2,color:"text.primary"},children:["Hadith #",e.number," from ",e.writer]}),t.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mt:3},children:[t.jsx(l,{onClick:n,children:t.jsx(I,{})}),t.jsx(j,{title:"Toggle Continuous Mode",children:t.jsx(l,{onClick:s,color:u?"primary":"default",children:t.jsx(T,{})})}),t.jsx(l,{onClick:()=>{if(E)null==k||k.removeFavorite(C);else{const t={id:C,type:"hadith",book:e.bookSlug,bookDisplayName:e.book,hadithNumber:e.number,englishText:e.text.english||"",note:""};null==k||k.addFavorite(t)}},children:E?t.jsx(N,{sx:{color:"red"}}):t.jsx(O,{})}),t.jsx(l,{onClick:r,children:t.jsx(P,{})})]})]})]})},Ge={morning:[e=>`Assalamu Alaikum, ${e}! May your morning be filled with barakah `,e=>`Good morning, ${e}! Begin your day with Bismillah `,e=>`Rise and shine, ${e}! May Allah bless your day `,e=>`Assalamu Alaikum, ${e}! Today is a gift from Allah `],afternoon:[e=>`May your afternoon be filled with peace and barakah, ${e} `,e=>`Hello ${e}, stay grateful and patient this afternoon `,e=>`${e}, keep going  Allah is with those who persevere `,e=>`Stay strong, ${e}! Every challenge brings growth `],evening:[e=>`Good evening, ${e}! Reflect and remember Allah `,e=>`Good evening, ${e}! May Allah's light guide you through the night `,e=>`Assalamu Alaikum, ${e}. Wind down with dhikr `,e=>`Alhamdulillah for today, ${e}! Make it count `],night:[e=>`Good night, ${e}. May Allah grant you restful sleep `,e=>`Sleep well, ${e}! Dont forget your evening du'as `,e=>`${e}, end your day with gratitude and tawakkul `,e=>`${e}, trust Allah with tomorrow's blessings `]},Xe=({name:e="Friend"})=>{const[n,r]=y.useState(0),[o,s]=y.useState(!0),u=(()=>{const e=(new Date).getHours();return e>=5&&e<12?"morning":e>=12&&e<17?"afternoon":e>=17&&e<21?"evening":"night"})(),l=Ge[u];y.useEffect(()=>{const e=setInterval(()=>{s(!1),setTimeout(()=>{r(e=>(e+1)%l.length),s(!0)},500)},1e4);return()=>clearInterval(e)},[l.length]);const c=l[n](e);return t.jsx(i,{textAlign:"center",mt:5,mb:5,sx:{width:"100%",maxWidth:"min(90vw, 1000px)",mx:"auto",px:2},children:t.jsx(B,{in:o,timeout:500,children:t.jsx(a,{variant:"h4",sx:{fontWeight:600,color:"white",fontFamily:"'Poppins', 'Inter', 'Segoe UI', sans-serif",userSelect:"none",lineHeight:1.4,textAlign:"center",fontSize:{xs:"1.5rem",sm:"2rem",md:"2.25rem"},letterSpacing:"0.02em",whiteSpace:"normal",textShadow:"3px 3px 6px rgba(0, 0, 0, 0.7)",minHeight:"3.5rem",display:"flex",alignItems:"center",justifyContent:"center"},children:c})})})},Je=()=>{const{tasks:e}=Be(),[n,r]=y.useState(""),[o,s]=y.useState(!1),[c,h]=y.useState(!1),[d,f]=y.useState(null),[m,p]=y.useState(""),g=(null==e?void 0:e.tasks)||[];c||g.slice(0,3);const b=g.filter(e=>e.done).length,v=y.useCallback(()=>{n.trim()&&(null==e||e.addTask({text:n.trim(),done:!1}),r(""))},[n,e]),x=y.useCallback(t=>{const n=g.find(e=>e.id===t);n&&(null==e||e.updateTask(t,{done:!n.done}))},[g,e]),w=y.useCallback(t=>{null==e||e.deleteTask(t)},[e]),k=y.useCallback((e,t)=>{f(e),p(t)},[]),_=y.useCallback(()=>{m.trim()&&(null==e||e.updateTask(d,{text:m.trim()}),f(null),p(""))},[m,d,e]);return t.jsxs(i,{sx:{display:"relative",justifyContent:"space-between",alignItems:"center",px:2,py:1,width:"60%",maxWidth:1e3,mx:"auto",background:"linear-gradient(to bottom right, rgba(245, 245, 245, 0.7), rgba(255, 255, 255, 0.4))",backdropFilter:"blur(10px)",boxShadow:"inset 0 0 10px rgba(0,0,0,0.05), 0 8px 30px rgba(0, 0, 0, 0.15)",borderRadius:2,color:"#111827",userSelect:"none",animation:"fadeInUp 0.7s ease forwards"},children:[t.jsxs(i,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",cursor:"pointer",userSelect:"none",py:.5},onClick:()=>s(e=>!e),children:[t.jsxs(a,{variant:"subtitle1",sx:{fontWeight:600,color:"black",fontSize:"1rem"},children:["Your Tasks (",b,"/",g.length,")"]}),o?t.jsx(q,{}):t.jsx(z,{})]}),t.jsx(u,{in:o,timeout:300,children:t.jsxs(i,{sx:{mt:1,bgcolor:"rgba(255,255,255,0.35)",backdropFilter:"blur(8px)",p:2,borderRadius:2,boxShadow:"0 6px 20px rgba(0, 0, 0, 0.1)",color:"#111827"},className:"expand-enter",children:[t.jsxs(i,{sx:{display:"flex",gap:1,mb:1},children:[t.jsx(U,{fullWidth:!0,placeholder:"Add new task",size:"small",value:n,onChange:e=>r(e.target.value),onKeyDown:e=>"Enter"===e.key&&v()}),t.jsx(j,{title:"Add task",children:t.jsx(l,{onClick:v,children:t.jsx($,{})})})]}),t.jsxs(L,{dense:!0,children:[g.slice(0,3).map(({id:e,text:n,done:r})=>t.jsxs(W,{sx:{px:.5,py:0,display:"flex",alignItems:"center"},className:"list-item-enter",children:[t.jsx(H,{checked:r,onChange:()=>x(e),sx:{mr:1}}),d===e?t.jsx(U,{fullWidth:!0,value:m,onChange:e=>p(e.target.value),onKeyDown:e=>{"Enter"===e.key?(e.preventDefault(),_()):"Escape"===e.key&&(f(null),p(""))},onBlur:_,size:"small",autoFocus:!0}):t.jsx(Y,{primary:n,sx:{textDecoration:r?"line-through":"none",color:r?"gray":"black"}}),d===e?t.jsx(l,{onClick:_,size:"small",children:t.jsx(V,{fontSize:"small"})}):t.jsx(l,{onClick:()=>k(e,n),size:"small",children:t.jsx(Q,{fontSize:"small"})}),t.jsx(l,{onClick:()=>w(e),size:"small",children:t.jsx(G,{fontSize:"small"})})]},e)),t.jsx(u,{in:c,timeout:300,children:t.jsx(i,{className:"expand-enter",children:g.slice(3).map(({id:e,text:n,done:r})=>t.jsxs(W,{sx:{px:.5,py:0,display:"flex",alignItems:"center"},className:"list-item-enter",children:[t.jsx(H,{checked:r,onChange:()=>x(e),sx:{mr:1}}),d===e?t.jsx(U,{fullWidth:!0,value:m,onChange:e=>p(e.target.value),onKeyDown:e=>{"Enter"===e.key?(e.preventDefault(),_()):"Escape"===e.key&&(f(null),p(""))},onBlur:_,size:"small",autoFocus:!0}):t.jsx(Y,{primary:n,sx:{textDecoration:r?"line-through":"none",color:r?"gray":"black"}}),d===e?t.jsx(l,{onClick:_,size:"small",children:t.jsx(V,{fontSize:"small"})}):t.jsx(l,{onClick:()=>k(e,n),size:"small",children:t.jsx(Q,{fontSize:"small"})}),t.jsx(l,{onClick:()=>w(e),size:"small",children:t.jsx(G,{fontSize:"small"})})]},e))})})]}),g.length>3&&t.jsx(i,{textAlign:"center",mt:1,children:t.jsxs(l,{onClick:()=>h(e=>!e),size:"small",className:"btn-smooth",sx:{color:"black"},"aria-label":c?"Show less tasks":"Show more tasks",children:[t.jsx(i,{className:"icon-smooth",children:c?t.jsx(q,{}):t.jsx(z,{})}),t.jsx(a,{variant:"caption",sx:{ml:.5},children:c?"Show Less":"Show More"})]})})]})})]})},Ze={0:"sun",1:"sun",2:"cloud",3:"cloud",45:"cloud-rain",48:"cloud-rain",51:"cloud-rain",53:"cloud-rain",55:"cloud-rain",56:"cloud-rain",57:"cloud-rain",61:"cloud-rain",63:"cloud-rain",65:"cloud-rain",66:"cloud-rain",67:"cloud-rain",71:"cloud-snow",73:"cloud-snow",75:"cloud-snow",77:"cloud-snow",80:"cloud-rain",81:"cloud-rain",82:"cloud-rain",85:"cloud-snow",86:"cloud-snow",95:"cloud-lightning",96:"cloud-lightning",99:"cloud-lightning"},et={0:"Clear sky",1:"Mainly clear",2:"Partly cloudy",3:"Overcast",45:"Fog",48:"Depositing rime fog",51:"Light drizzle",53:"Moderate drizzle",55:"Heavy drizzle",56:"Light freezing drizzle",57:"Heavy freezing drizzle",61:"Light rain",63:"Moderate rain",65:"Heavy rain",66:"Light freezing rain",67:"Heavy freezing rain",71:"Light snow",73:"Moderate snow",75:"Heavy snow",77:"Snow grains",80:"Light rain showers",81:"Moderate rain showers",82:"Heavy rain showers",85:"Light snow showers",86:"Heavy snow showers",95:"Thunderstorm",96:"Thunderstorm with light hail",99:"Thunderstorm with heavy hail"},tt=e=>{const n={fontSize:48,animation:"pulse 3s infinite",filter:"drop-shadow(0 0 5px rgba(0,0,0,0.2))"};switch(Ze[e]||"sun"){case"sun":default:return t.jsx(J,{sx:{...n,color:"#fbc02d"}});case"cloud":return t.jsx(ne,{sx:{...n,color:"#90a4ae"}});case"cloud-rain":return t.jsx(te,{sx:{...n,color:"#4fc3f7"}});case"cloud-snow":return t.jsx(ee,{sx:{...n,color:"#81d4fa"}});case"cloud-lightning":return t.jsx(Z,{sx:{...n,color:"#f44336"}})}},nt=()=>{var e;const{settings:n}=Be(),r=(null==(e=null==n?void 0:n.settings)?void 0:e.weather)||{},o=r.location||{latitude:0,longitude:0,name:"Unknown",timezone:"UTC"},s=r.customName||"",u=r.timeFormat||"24h",l=r.temperatureUnit||"celsius",[c,h]=y.useState(null),[d,f]=y.useState(!0),[m,p]=y.useState(null),[g,b]=y.useState(null),[v,x]=y.useState(!0),[w,k]=y.useState(null),[j,_]=y.useState(new Date),[A,S]=y.useState("UTC");y.useEffect(()=>{(async()=>{var e;const{latitude:t,longitude:n}=o;f(!0),p(null);try{const r=`https://api.open-meteo.com/v1/forecast?latitude=${t}&longitude=${n}&current_weather=true`,a=await he.get(r);if(!(null==(e=a.data)?void 0:e.current_weather))throw new Error("Weather data not available");{const e=a.data.current_weather.weathercode;h({tempC:a.data.current_weather.temperature,weatherCode:e,windSpeedKph:a.data.current_weather.windspeed}),p(null)}}catch(r){p("Unable to load weather data"),h(null)}finally{f(!1)}})(),(async()=>{const{latitude:e,longitude:t}=o;x(!0),k(null);try{const n=await fetch(`https://api.aladhan.com/v1/gToH?latitude=${e}&longitude=${t}&method=2`),r=await n.json();if(200!==r.code)throw new Error("Hijri date not available");b(r.data.hijri),k(null)}catch(n){k("Unable to load Islamic date"),b(null)}finally{x(!1)}})()},[o]),y.useEffect(()=>{o.timezone&&S(o.timezone)},[o]),y.useEffect(()=>{const e=setInterval(()=>{_(new Date)},1e3);return()=>clearInterval(e)},[]);const C="12h"===u,I="fahrenheit"===l,T=new Intl.DateTimeFormat(void 0,{hour:"2-digit",minute:"2-digit",hour12:C,timeZone:A}).format(j),P=j.toLocaleDateString(void 0,{weekday:"long",month:"long",day:"numeric",year:"numeric"});return t.jsxs(t.Fragment,{children:[t.jsx("style",{children:"\n        @keyframes pulse {\n          0%, 100% { transform: scale(1); filter: drop-shadow(0 0 5px rgba(0,0,0,0.2)); }\n          50% { transform: scale(1.1); filter: drop-shadow(0 0 15px rgba(0,0,0,0.35)); }\n        }\n        @keyframes fadeInUp {\n          from { opacity: 0; transform: translateY(12px); }\n          to { opacity: 1; transform: translateY(0); }\n        }\n      "}),t.jsxs(i,{sx:{display:"flex",flexDirection:{xs:"column",sm:"row"},justifyContent:"space-between",alignItems:"center",gap:3,px:3,py:3,width:"60%",maxWidth:1e3,mx:"auto",background:"linear-gradient(to bottom right, rgba(245, 245, 245, 0.7), rgba(255, 255, 255, 0.4))",backdropFilter:"blur(10px)",boxShadow:"inset 0 0 10px rgba(0,0,0,0.05), 0 8px 30px rgba(0, 0, 0, 0.15)",borderRadius:2,color:"#111827",userSelect:"none",animation:"fadeInUp 0.7s ease forwards"},children:[t.jsxs(i,{sx:{flex:1,textAlign:{xs:"center",sm:"left"}},children:[t.jsx(a,{variant:"h3",sx:{fontWeight:600,mb:.5},children:T}),v?t.jsx(X,{size:24,sx:{color:"#444"}}):w?t.jsx(a,{variant:"body2",sx:{fontWeight:500,color:"#ef4444",backgroundColor:"rgba(239, 68, 68, 0.1)",padding:"4px 8px",borderRadius:1,fontSize:"0.875rem"},children:w}):g?t.jsxs(a,{variant:"body",sx:{fontWeight:500,color:"#374151"},children:[g.weekday.en,", ",g.day," ",g.month.en," ",g.year," AH"]}):null,t.jsx(a,{variant:"body1",sx:{fontWeight:500,color:"#374151"},children:P})]}),t.jsx(i,{sx:{flexShrink:0,display:"flex",alignItems:"center",gap:2,backgroundColor:"rgba(255, 255, 255, 0.35)",backdropFilter:"blur(8px)",borderRadius:3,p:2,minWidth:180,boxShadow:"0 6px 20px rgba(0, 0, 0, 0.1)",animation:"fadeInUp 1s ease forwards",color:"#111827"},children:d?t.jsx(X,{size:30,sx:{color:"#444"}}):m?t.jsxs(i,{sx:{textAlign:"center",width:"100%"},children:[t.jsx(a,{variant:"body2",sx:{fontWeight:500,color:"#ef4444",backgroundColor:"rgba(239, 68, 68, 0.1)",padding:"8px 12px",borderRadius:1,fontSize:"0.875rem"},children:m}),t.jsx(a,{variant:"subtitle2",sx:{fontWeight:600,mt:1},children:s||o.name})]}):c?t.jsxs(t.Fragment,{children:[tt(c.weatherCode),t.jsxs(i,{children:[t.jsx(a,{variant:"subtitle1",sx:{fontWeight:600},children:s||o.name}),t.jsx(a,{variant:"h5",sx:{fontWeight:"bold",lineHeight:1},children:(E=c.tempC,I?`${Math.round(1.8*E+32)}F`:`${Math.round(E)}C`)}),t.jsx(a,{variant:"body2",sx:{opacity:.7},children:et[c.weatherCode]||"Unknown"})]})]}):null})]})]});var E},rt=()=>{const e=w();return t.jsxs(R,{sx:{width:"60%",maxWidth:1e3,mx:"auto",margin:"2rem auto",borderRadius:2,backgroundColor:"rgba(255, 255, 255, 0.4)",backdropFilter:"blur(10px)",boxShadow:"0 8px 30px rgba(0, 0, 0, 0.15)",overflow:"visible",minHeight:"400px"},children:[t.jsxs(i,{sx:{background:`linear-gradient(90deg, ${e.palette.primary.light} 0%, ${e.palette.primary.main} 100%)`,borderRadius:"8px 8px 0 0",padding:"12px 20px",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[t.jsxs(i,{sx:{flex:1},children:[t.jsx(g,{variant:"text",width:"70%",height:32,sx:{bgcolor:"rgba(255, 255, 255, 0.3)"}}),t.jsx(g,{variant:"text",width:"50%",height:20,sx:{bgcolor:"rgba(255, 255, 255, 0.2)",mt:.5}})]}),t.jsx(g,{variant:"rounded",width:80,height:24,sx:{bgcolor:"rgba(255, 255, 255, 0.3)"}})]}),t.jsxs(F,{sx:{paddingTop:3,paddingBottom:3},children:[t.jsxs(i,{sx:{textAlign:"center",mb:2},children:[t.jsx(g,{variant:"text",width:"90%",height:48,sx:{mx:"auto",mb:1}}),t.jsx(g,{variant:"text",width:"75%",height:48,sx:{mx:"auto",mb:1}}),t.jsx(g,{variant:"text",width:"85%",height:48,sx:{mx:"auto"}})]}),t.jsx(g,{variant:"rectangular",width:"100%",height:1,sx:{mb:2}}),t.jsxs(i,{sx:{textAlign:"center",mb:2},children:[t.jsx(g,{variant:"text",width:"95%",height:24,sx:{mx:"auto",mb:1}}),t.jsx(g,{variant:"text",width:"88%",height:24,sx:{mx:"auto",mb:1}}),t.jsx(g,{variant:"text",width:"92%",height:24,sx:{mx:"auto"}})]}),t.jsxs(i,{sx:{textAlign:"center",mt:2},children:[t.jsx(g,{variant:"text",width:"40%",height:16,sx:{mx:"auto",mb:1}}),t.jsx(g,{variant:"text",width:"30%",height:20,sx:{mx:"auto"}})]})]}),t.jsxs(i,{sx:{backgroundColor:"rgba(248, 250, 252, 0.8)",borderRadius:"0 0 8px 8px",padding:"16px 24px",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[t.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:1},children:[t.jsx(g,{variant:"circular",width:40,height:40}),t.jsx(g,{variant:"circular",width:48,height:48}),t.jsx(g,{variant:"circular",width:40,height:40})]}),t.jsx(i,{sx:{flex:1,mx:3},children:t.jsx(g,{variant:"rounded",width:"100%",height:6})}),t.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:1},children:[t.jsx(g,{variant:"circular",width:40,height:40}),t.jsx(g,{variant:"circular",width:40,height:40})]})]})]})},at=()=>{const e=w();return t.jsxs(R,{sx:{width:"60%",maxWidth:1e3,mx:"auto",margin:"2rem auto",borderRadius:2,backgroundColor:"rgba(255, 255, 255, 0.4)",backdropFilter:"blur(10px)",boxShadow:"0 8px 30px rgba(0, 0, 0, 0.15)",minHeight:"450px"},children:[t.jsxs(i,{sx:{background:`linear-gradient(90deg, ${e.palette.primary.light} 0%, ${e.palette.primary.main} 100%)`,borderRadius:"8px 8px 0 0",padding:"12px 20px",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[t.jsxs(i,{sx:{flex:1},children:[t.jsx(g,{variant:"text",width:"60%",height:32,sx:{bgcolor:"rgba(255, 255, 255, 0.3)"}}),t.jsx(g,{variant:"text",width:"80%",height:20,sx:{bgcolor:"rgba(255, 255, 255, 0.2)",mt:.5}})]}),t.jsx(g,{variant:"rounded",width:70,height:24,sx:{bgcolor:"rgba(255, 255, 255, 0.3)"}})]}),t.jsxs(F,{sx:{paddingTop:3,paddingBottom:3},children:[t.jsx(i,{sx:{textAlign:"center",mb:2},children:t.jsx(g,{variant:"text",width:"50%",height:20,sx:{mx:"auto"}})}),t.jsxs(i,{sx:{textAlign:"center",mb:2},children:[t.jsx(g,{variant:"text",width:"95%",height:44,sx:{mx:"auto",mb:1}}),t.jsx(g,{variant:"text",width:"88%",height:44,sx:{mx:"auto",mb:1}}),t.jsx(g,{variant:"text",width:"92%",height:44,sx:{mx:"auto",mb:1}}),t.jsx(g,{variant:"text",width:"78%",height:44,sx:{mx:"auto"}})]}),t.jsx(g,{variant:"rectangular",width:"100%",height:1,sx:{mb:2}}),t.jsxs(i,{sx:{textAlign:"center",mb:2},children:[t.jsx(g,{variant:"text",width:"98%",height:24,sx:{mx:"auto",mb:1}}),t.jsx(g,{variant:"text",width:"94%",height:24,sx:{mx:"auto",mb:1}}),t.jsx(g,{variant:"text",width:"96%",height:24,sx:{mx:"auto",mb:1}}),t.jsx(g,{variant:"text",width:"85%",height:24,sx:{mx:"auto"}})]}),t.jsx(i,{sx:{textAlign:"center",mt:2},children:t.jsx(g,{variant:"text",width:"45%",height:16,sx:{mx:"auto"}})}),t.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mt:3},children:[t.jsx(g,{variant:"circular",width:40,height:40}),t.jsx(g,{variant:"circular",width:40,height:40}),t.jsx(g,{variant:"circular",width:40,height:40}),t.jsx(g,{variant:"circular",width:40,height:40})]})]})]})},it=[{id:1,name:"Sahih Bukhari",writer:"Imam Bukhari",slug:"sahih-bukhari",hadithsCount:7276,chaptersCount:99},{id:2,name:"Sahih Muslim",writer:"Imam Muslim",slug:"sahih-muslim",hadithsCount:7564,chaptersCount:56},{id:4,name:"Jami' Al-Tirmidhi",writer:"Abu `Isa Muhammad at-Tirmidhi",slug:"al-tirmidhi",hadithsCount:3956,chaptersCount:50},{id:5,name:"Sunan Abu Dawood",writer:"Imam Abu Dawud Sulayman ibn al-Ash'ath as-Sijistani",slug:"abu-dawood",hadithsCount:5274,chaptersCount:43},{id:6,name:"Sunan Ibn-e-Majah",writer:"Imam Muhammad bin Yazid Ibn Majah al-Qazvini",slug:"ibn-e-majah",hadithsCount:4341,chaptersCount:39},{id:7,name:"Sunan An-Nasa'i",writer:"Imam Ahmad an-Nasa'i",slug:"sunan-nasai",hadithsCount:5761,chaptersCount:52},{id:8,name:"Mishkat Al-Masabih",writer:"Imam Khatib at-Tabrizi",slug:"mishkat",hadithsCount:6293,chaptersCount:29}],ot=[{surahNumber:1,surahName:"Al-Fatiha",ayahNumber:1,arabicText:"\ufeff   ",translation:{author:"Muhammad Asad",text:"In the name of God, The Most Gracious, The Dispenser of Grace:"},recitation:{reciter:"Mishary Rashid Alafasy",audioUrl:"https://cdn.islamic.network/quran/audio/128/ar.alafasy/1.mp3"}},{surahNumber:112,surahName:"Al-Ikhlas",ayahNumber:1,arabicText:"       ",translation:{author:"Muhammad Asad",text:'SAY: "He is the One God:'},recitation:{reciter:"Mishary Rashid Alafasy",audioUrl:"https://cdn.islamic.network/quran/audio/128/ar.alafasy/6222.mp3"}},{surahNumber:112,surahName:"Al-Ikhlas",ayahNumber:2,arabicText:" ",translation:{author:"Muhammad Asad",text:'"God the Eternal, the Uncaused Cause of All Being.'},recitation:{reciter:"Mishary Rashid Alafasy",audioUrl:"https://cdn.islamic.network/quran/audio/128/ar.alafasy/6223.mp3"}},{surahNumber:113,surahName:"Al-Falaq",ayahNumber:1,arabicText:"       ",translation:{author:"Muhammad Asad",text:'SAY: "I seek refuge with the Sustainer of the rising dawn,'},recitation:{reciter:"Mishary Rashid Alafasy",audioUrl:"https://cdn.islamic.network/quran/audio/128/ar.alafasy/6226.mp3"}},{surahNumber:114,surahName:"An-Nas",ayahNumber:1,arabicText:"       ",translation:{author:"Muhammad Asad",text:'SAY: "I seek refuge with the Sustainer of men,'},recitation:{reciter:"Mishary Rashid Alafasy",audioUrl:"https://cdn.islamic.network/quran/audio/128/ar.alafasy/6231.mp3"}},{surahNumber:2,surahName:"Al-Baqarah",ayahNumber:21,arabicText:"          ",translation:{author:"Muhammad Asad",text:"O MANKIND! Worship your Sustainer, who has created you and those who lived before you, so that you might remain conscious of Him"},recitation:{reciter:"Mishary Rashid Alafasy",audioUrl:"https://cdn.islamic.network/quran/audio/128/ar.alafasy/28.mp3"}},{surahNumber:103,surahName:"Al-Asr",ayahNumber:1,arabicText:"    ",translation:{author:"Muhammad Asad",text:"CONSIDER the flight of time!"},recitation:{reciter:"Mishary Rashid Alafasy",audioUrl:"https://cdn.islamic.network/quran/audio/128/ar.alafasy/6177.mp3"}},{surahNumber:103,surahName:"Al-Asr",ayahNumber:2,arabicText:"   ",translation:{author:"Muhammad Asad",text:"Verily, man is bound to lose himself"},recitation:{reciter:"Mishary Rashid Alafasy",audioUrl:"https://cdn.islamic.network/quran/audio/128/ar.alafasy/6178.mp3"}}],st=[{number:"1",book:"Sahih Bukhari",volume:"1",writer:"Imam Bukhari",bookSlug:"sahih-bukhari",narrator:{english:"Narrated 'Umar bin Al-Khattab (May Allah be pleased with him):",urdu:"                                                                                                           "},text:{english:'I heard Allah\'s Messenger () saying, "The reward of deeds depends upon the intentions and every person will get the reward according to what he has intended. So whoever emigrated for worldly benefits or for a woman to marry, his emigration was for what he emigrated for."',urdu:"                                     (   )                                        ",arabic:'                                                 "                        ".'},heading:{english:"How the Divine Revelation started being revealed to Allah's Messenger (peace be upon him)",urdu:"              ( ):                        ( )     ",arabic:"          "},chapter:{chapterNumber:"1",english:"Revelation",urdu:"   ",arabic:"  "},status:"Sahih"},{number:"16",book:"Sahih Muslim",volume:"1",writer:"Imam Muslim",bookSlug:"sahih-muslim",narrator:{english:"Harmalah bin Yahy bin Abd Allah bin Harmalah bin Imrn at-Tujb narrated to me, he said Ibn Wahb narrated to us, he said Ab Shurayh narrated to me that he heard Sharhl bin Yazd saying 'Muslim bin Yasr informed me that he heard Ab Hurayrah    saying:",urdu:"   '        '   '      :                     "},text:{english:"The Messenger of Allah, peace and blessings of Allah upon him, said: 'There will be in the end of time charlatan liars coming to you with narrations that you nor your fathers heard, so beware of them lest they misguide you and cause you tribulations'.'",urdu:"    : ''   (  )  (   )                           (  )               ' '",arabic:"            :    :         :         :       :                     "},heading:{english:null,urdu:null,arabic:null},chapter:{chapterNumber:"0",english:"Introduction",urdu:"",arabic:" "},status:"Sahih"},{number:"2",book:"Sahih Bukhari",volume:"1",writer:"Imam Bukhari",bookSlug:"sahih-bukhari",narrator:{english:"Narrated Abu Huraira (May Allah be pleased with him):",urdu:"       "},text:{english:'The Prophet () said, "Religion is very easy and whoever overburdens himself in his religion will not be able to continue in that way. So you should not be extremists, but try to be near to perfection and receive the good tidings that you will be rewarded."',urdu:"      : '                          ( )             '",arabic:"           "},heading:{english:"Religion is easy",urdu:"  ",arabic:" "},chapter:{chapterNumber:"1",english:"Faith",urdu:"",arabic:" "},status:"Sahih"},{number:"6",book:"Sahih Bukhari",volume:"1",writer:"Imam Bukhari",bookSlug:"sahih-bukhari",narrator:{english:"Narrated Abdullah ibn Amr (May Allah be pleased with him):",urdu:"        "},text:{english:'The Prophet () said, "A Muslim is the one who avoids harming Muslims with his tongue and hands. And a Muhajir (emigrant) is the one who gives up (abandons) all what Allah has forbidden."',urdu:"      : '                             '",arabic:"             "},heading:{english:"The Muslim is the one who avoids harming Muslims",urdu:"       ",arabic:"      "},chapter:{chapterNumber:"1",english:"Faith",urdu:"",arabic:" "},status:"Sahih"},{number:"25",book:"Sahih Muslim",volume:"1",writer:"Imam Muslim",bookSlug:"sahih-muslim",narrator:{english:"Narrated Abu Huraira (May Allah be pleased with him):",urdu:"       "},text:{english:'The Messenger of Allah () said: "When the son of Adam dies, his deeds come to an end, except for three: ongoing charity, knowledge that is benefited from, and a righteous child who prays for him."',urdu:"       : '                :                  '",arabic:"                     "},heading:{english:"Deeds that continue after death",urdu:"      ",arabic:"    "},chapter:{chapterNumber:"14",english:"Wills and Testaments",urdu:"",arabic:" "},status:"Sahih"},{number:"34",book:"Sahih Bukhari",volume:"1",writer:"Imam Bukhari",bookSlug:"sahih-bukhari",narrator:{english:"Narrated Abu Said Al-Khudri (May Allah be pleased with him):",urdu:"        "},text:{english:'I heard the Prophet () saying, "Whoever amongst you sees a wrong action, then let him change it with his hand; if he cannot, then with his tongue; if he cannot, then with his heart - and that is the weakest of faith."',urdu:"          : '                                       '",arabic:"                "},heading:{english:"Enjoining good and forbidding evil",urdu:"     ",arabic:"    "},chapter:{chapterNumber:"1",english:"Faith",urdu:"",arabic:" "},status:"Sahih"}],ut=(e,t=8e3)=>Promise.race([fetch(e),new Promise((e,n)=>setTimeout(()=>n(new Error("Request timeout")),t))]),lt=async(e={})=>{try{const{text_edition:t="en.asad",audio_edition:n="ar.alafasy",surah:r,ayah:a}=e;let i;if(r&&a)i=`${r}:${a}`;else{i=Math.floor(6236*Math.random())+1}const o=await(async(e,t,n)=>{var r,a,i;try{const[r,a]=await Promise.all([ut(`http://api.alquran.cloud/v1/ayah/${e}/${t}`),ut(`http://api.alquran.cloud/v1/ayah/${e}/${n}`)]);if(r.ok&&a.ok){const e=await r.json(),t=await a.json(),n=e.data,i=t.data;return{number:n.number,text:n.text,arabicText:i.text,editionName:n.edition.englishName,sajda:n.sajda,surah:{number:n.surah.number,name:n.surah.name,englishNameTranslation:n.surah.englishNameTranslation,numberOfAyahs:n.surah.numberOfAyahs,ayahNumberInSurah:n.numberInSurah,revelationType:n.surah.revelationType},audio:{main:i.audio,secondary:i.audioSecondary}}}}catch(s){}try{let t,n;if("string"==typeof e&&e.includes(":"))[t,n]=e.split(":").map(Number);else{const r=parseInt(e);t=Math.min(Math.floor(r/50)+1,114),n=Math.max(1,r%50||1)}const o=await ut(`https://api.quran.com/api/v4/verses/by_key/${t}:${n}?translations=20&audio=7`);if(o.ok){const e=(await o.json()).verse;return{number:e.id,text:(null==(a=null==(r=e.translations)?void 0:r[0])?void 0:a.text)||"Translation not available",arabicText:e.text_uthmani||e.text_simple,editionName:"Fallback Translation",sajda:!1,surah:{number:t,name:`Surah ${t}`,englishNameTranslation:`Chapter ${t}`,numberOfAyahs:50,ayahNumberInSurah:n,revelationType:"Unknown"},audio:{main:(null==(i=e.audio)?void 0:i.url)||"",secondary:""}}}}catch(s){}const o=ot[Math.floor(Math.random()*ot.length)];return{number:o.ayahNumber,text:o.translation.text,arabicText:o.arabicText,editionName:o.translation.author,sajda:!1,surah:{number:o.surahNumber,name:o.surahName,englishNameTranslation:o.surahName,numberOfAyahs:10,ayahNumberInSurah:o.ayahNumber,revelationType:"Meccan"},audio:{main:o.recitation.audioUrl,secondary:o.recitation.audioUrl.replace("128","64")}}})(i,t,n);return o}catch(t){throw new Error(t.message||"Internal server error")}},ct=[{slug:"sahih-bukhari",total:7276},{slug:"sahih-muslim",total:7564},{slug:"al-tirmidhi",total:3956},{slug:"abu-dawood",total:5274},{slug:"ibn-e-majah",total:4341},{slug:"sunan-nasai",total:5761},{slug:"mishkat",total:6293},{slug:"musnad-ahmad",total:0},{slug:"al-silsila-sahiha",total:0}],ht="sahih-bukhari",dt=async(e,t)=>{var n,r;try{const a=`https://hadithapi.com/api/hadiths/?apiKey=$2y$10$J1BiN6U0xUa2Hp42HdsZgOcvVwc8lOPvEKEgdhqG7F1dsXjPbjka&hadithNumber=${t}&book=${e}&status=Sahih`,i=await((e,t=1e4)=>Promise.race([fetch(e,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"},mode:"cors",credentials:"omit"}),new Promise((e,n)=>setTimeout(()=>n(new Error("Request timeout")),t))]))(a,8e3),o=await i.json();if(i.ok&&(null==(r=null==(n=o.hadiths)?void 0:n.data)?void 0:r[0])){const e=o.hadiths.data[0];return{number:e.hadithNumber,book:e.book.bookName,volume:e.volume,writer:e.book.writerName,bookSlug:e.bookSlug,narrator:{english:e.englishNarrator,urdu:e.urduNarrator},text:{english:e.hadithEnglish,urdu:e.hadithUrdu,arabic:e.hadithArabic},heading:{english:e.headingEnglish,urdu:e.headingUrdu,arabic:e.headingArabic},chapter:{chapterNumber:e.chapter.chapterNumber,english:e.chapter.chapterEnglish,urdu:e.chapter.chapterUrdu,arabic:e.chapter.chapterArabic},status:e.status}}}catch(i){}const a=Math.floor(Math.random()*st.length);return st[a]};function ft(e,t={}){if(!e)return null;if(e.startsWith("/")||!e.includes("://"))return e;const{quality:n=85,width:r=null,height:a=null,fit:i="crop",format:o="auto"}=t;try{const t=new URL(e);t.searchParams.set("q",String(n));const s=r||function(e=1920,t=1){let n=e*t;return n=Math.max(n,1920),n=Math.min(n,3840),n=240*Math.ceil(n/240),n}(window.innerWidth,window.devicePixelRatio||1);return t.searchParams.set("w",String(s)),a&&t.searchParams.set("h",String(a)),t.searchParams.set("fit",i),t.searchParams.set("fm",o),t.searchParams.set("auto","enhance"),t.toString()}catch(s){return e}}const mt="CmH0hk3YgDGkNbMvPBhbNL8n23lQwrNnrneWYr-lVlc",pt=()=>{const{settings:e}=Be(),[t,n]=y.useState(null),[r,a]=y.useState(!0),[i,o]=y.useState(null),[s,u]=y.useState(!1),[l,c]=y.useState(!1),h=y.useRef(!1),d=y.useRef(null),f=y.useRef(null),m=y.useRef(!1),p=((null==e?void 0:e.settings)||{}).background||{},g=p.imageSource||"category",b=p.islamicCategory||"nature",v=p.refreshInterval||"newtab",x=p.lastRefreshTime||0,w=p.imageCache||{images:[],currentIndex:0,lastFetchTime:0,category:""},k=p.uploadedImages||[],j=p.currentUploadedImageIndex||0,_={id:"fallback",url:"/mosque.jpg",authorName:"IlmTab",authorLink:"#",fetchedAt:Date.now()},A=()=>{if("newtab"===v)return!0;const e=Date.now()-x;switch(v){case"hourly":return e>36e5;case"daily":return e>864e5;case"weekly":return e>6048e5;default:return!0}},S=t=>{null==e||e.updateSettings({background:{...p,...t}})},C=()=>{n(_),u(!0),S({isUsingFallback:!0,currentImageUrl:ft(_.url),lastRefreshTime:Date.now()})},I=async e=>{try{const t={nature:"nature,landscape,mountains,sky,peaceful",architecture:"mosque,islamic architecture,minaret,dome",calligraphy:"quran, arabic calligraphy,",geometric:"islamic pattern,islamic geometric,mandala,islamic symmetry"},n=t[e]||t.nature,r=await he.get("https://api.unsplash.com/photos/random",{params:{query:n,orientation:"landscape",count:5},headers:{Authorization:`Client-ID ${mt}`},timeout:1e4});if(r.data&&Array.isArray(r.data)){const e=r.data.map(e=>({id:e.id,url:e.urls.raw,authorName:e.user.name,authorLink:`${e.user.links.html}?utm_source=ilmtab&utm_medium=referral`,fetchedAt:Date.now(),downloadLocation:e.links.download_location}));return e.forEach(async e=>{if(e.downloadLocation)try{await he.get(e.downloadLocation,{headers:{Authorization:`Client-ID ${mt}`},timeout:5e3})}catch(t){}}),e}throw new Error("Invalid API response")}catch(t){return[_]}},T=async()=>{if(!h.current){h.current=!0,a(!0);try{"upload"===g?(async()=>{if(0===k.length)return void C();if(A()){const t=(j+1)%k.length,r=k[t];c(!0);try{await new Promise((e,t)=>{const n=new Image;n.onload=()=>{e()},n.onerror=()=>{e()},setTimeout(()=>{e()},3e3),n.src=r.url}),S({currentUploadedImageIndex:t,lastRefreshTime:Date.now(),isUsingFallback:!1,currentImageUrl:ft(r.url)}),n({id:r.id,url:r.url,authorName:"Your Upload",authorLink:"#",fetchedAt:Date.now()}),u(!1)}catch(e){S({currentUploadedImageIndex:t,lastRefreshTime:Date.now(),isUsingFallback:!1,currentImageUrl:ft(r.url)}),n({id:r.id,url:r.url,authorName:"Your Upload",authorLink:"#",fetchedAt:Date.now()}),u(!1)}finally{c(!1)}}else{const e=k[j];e?(n({id:e.id,url:e.url,authorName:"Your Upload",authorLink:"#",fetchedAt:Date.now()}),u(!1)):C()}})():await(async()=>{var e,t,r,a;try{if(0===w.images.length||w.category!==b){const t=await I(b),r=1===t.length&&"fallback"===t[0].id,a={images:t,currentIndex:0,lastFetchTime:Date.now(),category:b};S({imageCache:a,currentImageUrl:ft(null==(e=t[0])?void 0:e.url),lastRefreshTime:Date.now(),isUsingFallback:r}),n(t[0]),u(r)}else if(A()){const e=(w.currentIndex+1)%w.images.length,i=w.images[e];if(e===w.images.length-2&&"fallback"!==(null==(t=w.images[0])?void 0:t.id)){const t=await I(b);if("fallback"!==(null==(r=t[0])?void 0:r.id)){const r=[...w.images.slice(-3),...t],i={images:r,currentIndex:e>=w.images.length-1?3:e,lastFetchTime:Date.now(),category:b};S({imageCache:i,currentImageUrl:ft(null==(a=r[i.currentIndex])?void 0:a.url),lastRefreshTime:Date.now(),isUsingFallback:!1}),n(r[i.currentIndex]),u(!1)}else C()}else{const t="fallback"===(null==i?void 0:i.id);S({imageCache:{...w,currentIndex:e},currentImageUrl:ft(null==i?void 0:i.url),lastRefreshTime:Date.now(),isUsingFallback:t}),n(i),u(t)}}else{const e=w.images[w.currentIndex],t="fallback"===(null==e?void 0:e.id);n(e),u(t)}}catch(i){C()}})()}catch(e){C()}finally{a(!1),h.current=!1}}};y.useEffect(()=>{if(null==t?void 0:t.url){const e=function(e){if(!e)return null;if(e.startsWith("/")||!e.includes("://"))return null;try{const t=new URL(e);return t.searchParams.set("w","40"),t.searchParams.set("h","30"),t.searchParams.set("q","20"),t.searchParams.set("blur","200"),t.searchParams.set("fm","jpg"),t.toString()}catch(t){return null}}(t.url);e&&o(e)}},[t]),y.useEffect(()=>{if("category"===g&&w.images.length>0&&!s){const e=(w.currentIndex+1)%w.images.length,t=w.images[e];if(t&&t.url){d.current&&(d.current.onload=null,d.current.onerror=null),d.current=new Image;const e=ft(t.url);d.current.onload=()=>{},d.current.src=e}}},[w.currentIndex,w.images,g,s]),y.useEffect(()=>{if("upload"===g&&k.length>1&&!s){const e=(j+1)%k.length,t=k[e];t&&t.url&&(f.current&&(f.current.onload=null,f.current.onerror=null),f.current=new Image,f.current.onload=()=>{},f.current.onerror=()=>{},f.current.src=t.url)}},[j,k,g,s]),y.useEffect(()=>{(null==e?void 0:e.settings)&&!m.current&&(m.current=!0,T())},[null==e?void 0:e.settings]),y.useEffect(()=>{m.current&&T()},[g,b,k.length]);const P=y.useRef(k.length);return y.useEffect(()=>{m.current&&"upload"===g&&0===k.length&&P.current>0&&S({imageSource:"category"}),P.current=k.length},[k.length,g]),{currentImage:t,loading:r,placeholderUrl:i,isUsingFallback:s,isTransitioning:l,cacheInfo:{totalImages:"upload"===g?k.length:w.images.length,currentIndex:"upload"===g?j:w.currentIndex,category:w.category,lastFetchTime:w.lastFetchTime,imageSource:g}}},yt=y.lazy(()=>fe(()=>import("./FavoritesModal-CLch8tIR.js"),__vite__mapDeps([0,1,2,3]))),gt=y.lazy(()=>fe(()=>import("./SettingsModal-BIkqhNf6.js"),__vite__mapDeps([4,1,2,3]))),bt=y.lazy(()=>fe(()=>import("./QuranSearch-DC1niB5n.js"),__vite__mapDeps([5,1,2,3])));function vt(){var e,n;const[r,a]=y.useState(null),[o,s]=y.useState(null),[u,c]=y.useState(!0),[h,d]=y.useState(!1),[f,m]=y.useState(null),[p,g]=y.useState(null),[b,v]=y.useState(!0),[x,w]=y.useState(!1),[k,_]=y.useState(""),[A,S]=y.useState(""),[C,I]=y.useState(null),[T,P]=y.useState(null),[E,O]=y.useState(!1),[M,K]=y.useState(!1),[R,F]=y.useState(null),[D,B]=y.useState(null),[q,z]=y.useState("ayah"),[U,$]=y.useState(!1),[L,W]=y.useState(!1),[H,Y]=y.useState(!1),[V,Q]=y.useState(!1),[G,X]=y.useState(!1),[J,Z]=y.useState(null),{settings:ee,favorites:te}=Be(),{currentImage:ne,isUsingFallback:ue}=pt();y.useRef(!1);const le=(null==ee?void 0:ee.settings)||{},ce=le.ayah||{},he=le.hadith||{},de=le.weather||{},fe=le.greetings||{},me=le.tasks||{},pe=le.background||{},ye=(null==(e=ce.textEdition)?void 0:e.identifier)||"en.asad",be=(null==(n=ce.audioEdition)?void 0:n.identifier)||"ar.alafasy",ve=he.book||"sahih-bukhari",xe=de.enabled||!1,we=fe.enabled||!1,ke=fe.name||"",je=me.enabled||!1;null==pe||pe.refreshInterval,null==pe||pe.lastRefreshTime,null==pe||pe.currentImageUrl;const _e=(null==pe?void 0:pe.imageSource)||"category";null==pe||pe.islamicCategory,null==pe||pe.uploadedImages,null==pe||pe.currentUploadedImageIndex;y.useEffect(()=>{if(null==ne?void 0:ne.url){(async e=>{if(!x&&p!==e){w(!0);try{await new Promise(t=>{const n=new Image,r=()=>{n.onload=null,n.onerror=null,t()};n.onload=r,n.onerror=r,setTimeout(r,3e3),n.src=e}),g(e)}catch(t){g(e)}finally{w(!1)}}})(ft(ne.url)),_(ne.authorName),S(ne.authorLink),v(!1)}},[ne]);const Ae=async(e=null,t=null)=>{try{c(!0);const n={text_edition:ye,audio_edition:be};e&&t&&(n.surah=e,n.ayah=t);const r=await lt(n);a(r),I(r.surah.number),P(r.surah.ayahNumberInSurah),m(null)}catch(n){m("Failed to fetch ayah")}finally{c(!1)}},Se=async(e=null,t=null)=>{try{d(!0);const n={book:e||ve};t&&(n.hadithNumber=t);const r=await(async(e={})=>{try{const{book:t=ht,hadithNumber:n}=e,r=ct.find(e=>e.slug===t);if(!r||0===r.total)throw new Error("Unsupported or empty hadith book.");const a=n?parseInt(n):Math.floor(Math.random()*r.total)+1;return await dt(r.slug,a)}catch(t){throw new Error(t.message||"Internal server error")}})(n);s(r),F(Number(r.number)),m(null)}catch(n){m("Failed to fetch hadith")}finally{d(!1)}};y.useEffect(()=>{Ae()},[]),y.useEffect(()=>{const e=setTimeout(()=>{Q(!0)},1e3);return()=>clearTimeout(e)},[]),y.useEffect(()=>{null!=C&&null!=T&&Ae(C,T)},[ye,be]),y.useEffect(()=>{{const e=it.find(e=>e.slug===ve);if(e){B(e.hadithsCount);const t=Math.floor(Math.random()*e.hadithsCount)+1;F(t),Se(ve,t)}}},[ve]);const Ce=["ayah","hadith"],Ie={backgroundImage:p?`url(${p})`:"none",backgroundSize:"cover",backgroundPosition:"center",transition:"opacity 1s ease-in-out",minHeight:"100vh",paddingTop:"1rem",position:"relative",backgroundColor:p?"transparent":"#2a2a2a",opacity:p?1:0},Te=e=>V?"page-load-complete":`page-load-stagger-${e}`,Pe=()=>G?"next"===J?"view-slide-in-right":"prev"===J?"view-slide-in-left":"view-cross-fade":"view-cross-fade";return t.jsxs(t.Fragment,{children:[t.jsx(re,{}),t.jsxs("div",{style:Ie,className:(()=>{const e=["page-load-background"];return b?e.push("background-loading"):e.push("background-ready"),p?e.push("background-crossfade"):e.push("background-initial"),e.join(" ")})(),children:[p&&t.jsx("div",{style:{position:"absolute",inset:0,backgroundColor:"rgba(0, 0, 0, 0.4)",zIndex:0}}),t.jsxs(i,{sx:{minHeight:"calc(100vh - 1rem)",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",px:2,py:1,position:"relative",zIndex:1},children:[f&&t.jsx(i,{sx:{position:"fixed",top:20,left:"50%",transform:"translateX(-50%)",zIndex:2e3,width:"90%",maxWidth:"500px"},children:t.jsx(ge,{error:f,onDismiss:()=>m(null),showDetails:!1})}),t.jsxs(i,{sx:{backgroundColor:"rgba(255, 255, 255, 0.4)",backdropFilter:"blur(10px)",boxShadow:"0 8px 30px rgba(0, 0, 0, 0.15)",borderRadius:"20px",px:2,py:.5,mb:2,display:"flex",alignItems:"center"},className:Te(1),children:[t.jsx(l,{onClick:()=>{if(G)return;X(!0),Z("prev");const e=(Ce.indexOf(q)-1+Ce.length)%Ce.length;setTimeout(()=>{z(Ce[e]),setTimeout(()=>{X(!1),Z(null)},400)},150)},size:"small",sx:{color:"#374151"},children:t.jsx(ae,{fontSize:"small"})}),t.jsx("span",{style:{color:"#374151",fontSize:"0.9rem",fontWeight:500,letterSpacing:"0.5px",fontFamily:"Inter, Roboto, sans-serif",margin:"0 8px",userSelect:"none"},children:"ayah"===q?"Ayah Mode":"Hadith Mode"}),t.jsx(l,{onClick:()=>{if(G)return;X(!0),Z("next");const e=(Ce.indexOf(q)+1)%Ce.length;setTimeout(()=>{z(Ce[e]),setTimeout(()=>{X(!1),Z(null)},400)},150)},size:"small",sx:{color:"#374151"},children:t.jsx(ie,{fontSize:"small"})})]}),t.jsxs(i,{sx:{width:"100%",maxWidth:"900px",mx:"auto"},className:"view-transition-container",children:["ayah"===q&&t.jsx("div",{className:`${Te(2)} ${Pe()}`,children:u?t.jsx(rt,{}):r?t.jsx("div",{className:"animate-fade-in",children:t.jsx(Ye,{ayah:r,onNext:()=>{E&&C&&T?Ae(C,T+1):Ae()},onPrev:()=>{E&&C&&T>1&&Ae(C,T-1)},onToggleContinuous:()=>O(e=>!e),isContinuous:E})}):null}),"hadith"===q&&t.jsx("div",{className:`${Te(2)} ${Pe()}`,children:h?t.jsx(at,{}):o?t.jsx("div",{className:"animate-fade-in",children:t.jsx(Qe,{hadith:o,onNext:()=>{if(M&&R&&D&&R<D){const e=R+1;F(e),Se(ve,e)}else Se()},onPrev:()=>{if(M&&R>1){const e=R-1;F(e),Se(ve,e)}},onToggleContinuous:()=>K(e=>!e),isContinuous:M})}):null}),xe&&t.jsx("div",{className:Te(3),children:t.jsx(nt,{})}),we&&t.jsx("div",{className:Te(4),children:t.jsx(Xe,{name:ke})}),je&&t.jsx("div",{className:Te(5),children:t.jsx(Je,{})})]})]}),t.jsxs(i,{sx:{position:"fixed",bottom:10,left:10,display:"flex",gap:1,zIndex:1500},className:Te(6),children:[t.jsx(j,{title:"Favorites",children:t.jsx(l,{size:"large",className:"btn-smooth",sx:{backgroundColor:"#fff",boxShadow:2,"&:hover":{backgroundColor:"#eee"}},onClick:()=>$(!0),children:t.jsx(N,{color:"error",className:"icon-smooth"})})}),t.jsx(j,{title:"Settings",children:t.jsx(l,{size:"large",className:"btn-smooth",sx:{backgroundColor:"#fff",boxShadow:2,"&:hover":{backgroundColor:"#eee"}},onClick:()=>W(!0),children:t.jsx(oe,{className:"icon-smooth"})})}),t.jsx(j,{title:"Search Quran",children:t.jsx(l,{size:"large",className:"btn-smooth",sx:{backgroundColor:"#fff",boxShadow:2,"&:hover":{backgroundColor:"#eee"}},onClick:()=>Y(!0),children:t.jsx(se,{color:"primary",className:"icon-smooth"})})}),t.jsx(y.Suspense,{fallback:t.jsx("div",{}),children:t.jsx(yt,{open:U,onClose:()=>$(!1),favorites:(null==te?void 0:te.favorites)||[],onUpdateNote:(e,t)=>{null==te||te.updateFavoriteNote(e,t)},onDeleteFavorite:e=>{null==te||te.removeFavorite(e)},onNavigateToFavorite:e=>{"ayah"===e.type?(z("ayah"),Ae(e.surahNumber,e.ayahNumber)):"hadith"===e.type&&(z("hadith"),Se(e.book,e.hadithNumber))}})}),t.jsx(y.Suspense,{fallback:t.jsx("div",{}),children:t.jsx(gt,{open:L,onClose:()=>W(!1)})})]}),H&&t.jsx(y.Suspense,{fallback:t.jsx("div",{}),children:t.jsx(bt,{onSelectAyah:(e,t)=>{z("ayah"),Ae(e,t)},onClose:()=>Y(!1)})}),p&&!ue&&"IlmTab"!==k&&"upload"!==_e&&t.jsxs("div",{style:{position:"fixed",bottom:10,right:10,color:"white",backgroundColor:"rgba(0, 0, 0, 0.4)",padding:"4px 8px",borderRadius:"4px",fontSize:"0.8rem",fontFamily:"Arial, sans-serif",zIndex:1e3,userSelect:"none"},children:["Photo by"," ",t.jsx("a",{href:A,target:"_blank",rel:"noopener noreferrer",style:{color:"#ddd",textDecoration:"underline"},children:k})," ","on"," ",t.jsx("a",{href:"https://unsplash.com",target:"_blank",rel:"noopener noreferrer",style:{color:"#ddd",textDecoration:"underline"},children:"Unsplash"})]})]})]})}const xt=()=>t.jsx(De,{children:t.jsx(vt,{})});ye.createRoot(document.getElementById("root")).render(t.jsx(xt,{}));export{pt as a,qe as b,it as h,We as t,Be as u};
